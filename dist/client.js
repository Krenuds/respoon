"use strict";(()=>{var Mn=Object.defineProperty;var fl=Object.getOwnPropertyDescriptor;var bl=Object.getOwnPropertyNames;var kl=Object.prototype.hasOwnProperty;var Pr=(e,t)=>()=>(e&&(t=e(e=0)),t);var vl=(e,t)=>{for(var r in t)Mn(e,r,{get:t[r],enumerable:!0})},Cl=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of bl(t))!kl.call(e,o)&&o!==r&&Mn(e,o,{get:()=>t[o],enumerable:!(n=fl(t,o))||n.enumerable});return e};var xl=e=>Cl(Mn({},"__esModule",{value:!0}),e);function ui(){return Bt||(typeof IsDuplicityVersion<"u"&&IsDuplicityVersion?Bt=IsDuplicityVersion()?"server":"client":typeof window<"u"?Bt="nui":Bt="server",Bt)}function Sl(){if(tt)return tt;if(ui()==="nui")return tt="info",tt;try{if(typeof GetConvar<"u"&&GetConvar){let t=GetConvar("respoon_log_level","info");tt=t in Ln?t:"info"}else tt="info"}catch{tt="info"}return tt}function Vr(e){return Ln[e]>=Ln[Sl()]}function Fr(e,t,r,n,o=!0){let a=o?Tl[e]:"",l=`${t?`${a}[${t}]${o?"^0":""} `:""}${r}`;if(n&&Object.keys(n).length>0)try{l+=" "+JSON.stringify(n)}catch{l+=" [data]"}return l}function m(e){let r=ui()!=="nui",n=e??null;return{debug(o,a){Vr("debug")&&(console.log(Fr("debug",n,o,a,r)),rt&&rt("debug",n,o,a))},info(o,a){Vr("info")&&(console.log(Fr("info",n,o,a,r)),rt&&rt("info",n,o,a))},warn(o,a){Vr("warn")&&(console.warn(Fr("warn",n,o,a,r)),rt&&rt("warn",n,o,a))},error(o,a,i){Vr("error")&&(console.error(Fr("error",n,o,a,r)),i&&console.error(i),rt&&rt("error",n,o,a))}}}var Ln,Tl,Bt,tt,rt,mi=Pr(()=>{"use strict";Ln={debug:0,info:1,warn:2,error:3},Tl={debug:"^5",info:"^2",warn:"^3",error:"^1"},Bt=null,tt=null,rt=null});function nt(e){return e*wl}function Bn(e){return e*El}function pi(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}}function Pl(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function gi(e,t){return Pl(pi(t,e))}function Gt(e){let t=nt(e.x),r=nt(e.z),n={x:-Math.sin(r)*Math.cos(t),y:Math.cos(r)*Math.cos(t),z:Math.sin(t)},o={x:Math.cos(r),y:Math.sin(r),z:0};return{forward:n,right:o,up:{x:0,y:0,z:1}}}function ot(e,t,r){return Math.min(Math.max(e,t),r)}function Gn(e){let t=Math.cos(nt(e.x)),r=Math.sin(nt(e.x)),n=Math.cos(nt(e.y)),o=Math.sin(nt(e.y)),a=Math.cos(nt(e.z)),i=Math.sin(nt(e.z));return[[a*n-i*r*o,-i*t,a*o+i*r*n],[i*n+a*r*o,a*t,i*o-a*r*n],[-t*o,r,t*n]]}function yi(e){return[[e[0][0],e[1][0],e[2][0]],[e[0][1],e[1][1],e[2][1]],[e[0][2],e[1][2],e[2][2]]]}function Al(e,t){return{x:e[0][0]*t.x+e[0][1]*t.y+e[0][2]*t.z,y:e[1][0]*t.x+e[1][1]*t.y+e[1][2]*t.z,z:e[2][0]*t.x+e[2][1]*t.y+e[2][2]*t.z}}function Il(e,t){let r=[[0,0,0],[0,0,0],[0,0,0]];for(let n=0;n<3;n++)for(let o=0;o<3;o++)r[n][o]=e[n][0]*t[0][o]+e[n][1]*t[1][o]+e[n][2]*t[2][o];return r}function Nl(e){let t=ot(e[2][1],-1,1),r=Math.asin(t),n,o;return Math.abs(t)>.9999?(n=0,o=Math.atan2(e[1][0],e[0][0])):(n=Math.atan2(-e[2][0],e[2][2]),o=Math.atan2(-e[0][1],e[1][1])),{x:Bn(r),y:Bn(n),z:Bn(o)}}function hi(e,t,r){let n=pi(e,t),o=Gn(r),a=yi(o);return Al(a,n)}function fi(e,t){let r=Gn(e),n=Gn(t),o=yi(n),a=Il(o,r);return Nl(a)}var wl,El,Nm,bt=Pr(()=>{"use strict";wl=Math.PI/180,El=180/Math.PI,Nm=Math.PI*2});var k=Pr(()=>{"use strict";mi();bt()});var sl={};vl(sl,{discardRecording:()=>hu,enterRockstarEditor:()=>Na,isRecording:()=>fu,startRecording:()=>gu,stopAndSaveRecording:()=>yu});function gu(){En.info("Starting recording"),StartRecording(1),Zt=!0}function yu(){Zt&&(En.info("Stopping recording and saving clip"),StartRecording(0),StopRecordingAndSaveClip(),Zt=!1)}function hu(){Zt&&(En.info("Discarding recording"),StopRecordingAndDiscardClip(),Zt=!1)}function fu(){return Zt}function Na(){En.info("Entering Rockstar Editor"),NetworkSessionLeaveSinglePlayer(),ActivateRockstarEditor()}var En,Zt,Ra=Pr(()=>{"use strict";k();En=m("Recording"),Zt=!1});var Ar={engine:-1,brakes:-1,transmission:-1,suspension:-1,armor:-1,turbo:!1,xenon:!1,tyreSmoke:!1,tyreSmokeColor:null,customTires:!1,spoiler:-1,frontBumper:-1,rearBumper:-1,sideSkirt:-1,exhaust:-1,frame:-1,grille:-1,hood:-1,fender:-1,rightFender:-1,roof:-1,wheels:-1,rearWheels:-1,horn:-1,plateHolder:-1,vanityPlate:-1,trim:-1,ornaments:-1,dashboard:-1,dial:-1,doorSpeaker:-1,seats:-1,steeringWheel:-1,columnShifterLevers:-1,plaques:-1,speakers:-1,trunk:-1,hydraulics:-1,engineBlock:-1,airFilter:-1,struts:-1,archCover:-1,aerials:-1,trim2:-1,tank:-1,windows:-1,livery:-1},Ir={engine:0,brakes:0,transmission:0,suspension:0,armor:0,spoiler:0,frontBumper:0,rearBumper:0,sideSkirt:0,exhaust:0,frame:0,grille:0,hood:0,fender:0,rightFender:0,roof:0,wheels:0,rearWheels:0,horn:0,plateHolder:0,vanityPlate:0,trim:0,ornaments:0,dashboard:0,dial:0,doorSpeaker:0,seats:0,steeringWheel:0,columnShifterLevers:0,plaques:0,speakers:0,trunk:0,hydraulics:0,engineBlock:0,airFilter:0,struts:0,archCover:0,aerials:0,trim2:0,tank:0,windows:0,livery:0},Dn={class:0,className:"Unknown",health:1e3,engineHealth:1e3,bodyHealth:1e3,isEngineRunning:!1,doorCount:4,hitBoneIndex:null,hitBoneName:null,primaryColor:null,secondaryColor:null,primaryColorIndex:0,secondaryColorIndex:0,isCustomPrimary:!1,isCustomSecondary:!1,pearlColor:0,wheelColor:0,mods:{...Ar},modLevelCounts:{...Ir},neonEnabled:[!1,!1,!1,!1],neonColor:null,extras:[],livery:-1,livery2:-1,roofLivery:-1,liveryCount:0,traditionalLiveryCount:0,modLiveryCount:0,wheelType:0,wheelCount:4,tyreHealth:[],tyreBurst:[],wheelModNames:void 0,doorStates:[],windowStates:[],plateText:"",plateStyle:0,windowTint:0,dirtLevel:0,enveffScale:0,lockStatus:1,roofState:null,isConvertible:!1,fuelLevel:100,xenonColor:-1,configFlags:{flags:{}},locked:!0,engineOn:!1,tyreSmokeColor:null},li={flags:{}},ci={taskHash:null,taskName:null,isInScenario:!1,movementClipset:null,isSprinting:!1,isRunning:!1,isWalking:!1,isStill:!0,isPlayingAnim:!1,animDict:null,animName:null,animTime:null,taskStage:null,taskStatus:null,blockingEvents:!1,specificTaskType:null,activeTasks:[]},Vn={health:200,maxHealth:200,armour:0,isDead:!1,isPlayer:!1,playerId:null,hitBoneIndex:null,hitBoneName:null,drawables:[],props:[],headBlend:null,faceFeatures:[],hairColor:0,hairHighlight:0,eyeColor:0,headOverlays:[],isInVehicle:!1,vehicleHandle:null,vehicleSeat:null,isOnFoot:!0,isSwimming:!1,isFalling:!1,isClimbing:!1,isRagdoll:!1,isShooting:!1,isAiming:!1,currentWeapon:null,relationshipGroup:0,combatMovement:0,combatRange:1,combatAbility:1,alertness:0,accuracy:50,configFlags:{...li},animationState:{...ci},animation:null,weaponHash:null,blockEvents:!0,taskState:null,faction:null};function Fn(e){if(!e||typeof e!="object")return!1;let t=e;return typeof t.x=="number"&&typeof t.y=="number"&&typeof t.z=="number"}function ft(e){if(!e||typeof e!="object")return!1;let t=e;return typeof t.parentUuid=="string"&&typeof t.boneIndex=="number"&&Fn(t.offset)&&Fn(t.rotation)}var rr=["alpha","visible","collision","frozen","invincible","lodDistance"];function Nr(e){return rr.includes(e)}var Rr={0:"none",1:"ped",2:"vehicle",3:"object"},Mr={0:"unknown",1:"random_permanent",2:"random_parked",3:"random_patrol",4:"random_scenario",5:"random_ambient",6:"permanent",7:"mission",8:"replay",9:"cache",10:"tool"};var Dr={animationState:{throttleMs:500,entityTypes:["ped"]},configFlags:{throttleMs:1e3,entityTypes:["ped","vehicle"]},drawables:{throttleMs:2e3,entityTypes:["ped"]},vehicleState:{throttleMs:500,entityTypes:["vehicle"]}};var Lt={RESPECT:0,LIKE:1,NEUTRAL:2,DISLIKE:3,HATE:5},On={1:Lt.RESPECT,2:Lt.LIKE,3:Lt.NEUTRAL,4:Lt.DISLIKE,5:Lt.HATE};var di="0.06";k();var bi=!1;function Or(e){bi=e}function kt(){return bi}function g(e,t){SendNUIMessage({action:e,payload:t,timestamp:Date.now()})}function Ue(e){return Array.isArray(e)?{x:e[0],y:e[1],z:e[2]}:{x:e.x,y:e.y,z:e.z}}k();k();var Hn={0:"Compacts",1:"Sedans",2:"SUVs",3:"Coupes",4:"Muscle",5:"Sports Classics",6:"Sports",7:"Super",8:"Motorcycles",9:"Off-road",10:"Industrial",11:"Utility",12:"Vans",13:"Cycles",14:"Boats",15:"Helicopters",16:"Planes",17:"Service",18:"Emergency",19:"Military",20:"Commercial",21:"Trains",22:"Open Wheel"},T={0:"Spoilers",1:"Front Bumper",2:"Rear Bumper",3:"Side Skirt",4:"Exhaust",5:"Frame",6:"Grille",7:"Hood",8:"Fender",9:"Right Fender",10:"Roof",11:"Engine",12:"Brakes",13:"Transmission",14:"Horns",15:"Suspension",16:"Armor",17:"Unknown 17",18:"Turbo",19:"Unknown 19",20:"Tire Smoke",21:"Unknown 21",22:"Xenon Headlights",23:"Front Wheels",24:"Back Wheels",25:"Plate Holder",26:"Vanity Plates",27:"Trim Design",28:"Ornaments",29:"Dashboard",30:"Dial Design",31:"Door Speaker",32:"Seats",33:"Steering Wheel",34:"Shifter Leavers",35:"Plaques",36:"Speakers",37:"Trunk",38:"Hydraulics",39:"Engine Block",40:"Air Filter",41:"Struts",42:"Arch Cover",43:"Aerials",44:"Trim",45:"Tank",46:"Windows",47:"Unknown 47",48:"Livery"};var ki={0:"window_lf",1:"window_rf",2:"window_lr",3:"window_rr",4:"windscreen",5:"windscreen_r",6:"window_lm",7:"window_rm"};var vi={0:"door_dside_f",1:"door_pside_f",2:"door_dside_r",3:"door_pside_r",4:"bonnet",5:"boot",6:"boot2"};var Rl={0:"Face",1:"Mask",2:"Hair",3:"Torso",4:"Legs",5:"Bags/Parachute",6:"Shoes",7:"Accessories",8:"Undershirt",9:"Kevlar",10:"Badge",11:"Torso 2"},Ml={0:"Hats",1:"Glasses",2:"Ears",3:"Unknown 3",4:"Unknown 4",5:"Unknown 5",6:"Watches",7:"Bracelets",8:"Unknown 8",9:"Unknown 9"};function x(e){let t=e.toLowerCase(),r=0;for(let n=0;n<t.length;n++)r+=t.charCodeAt(n),r+=r<<10,r^=r>>>6;return r+=r<<3,r^=r>>>11,r+=r<<15,r>>>0}var Gm={[x("PLAYER")]:"Player",[x("NETWORK_PLAYER")]:"Network Player",[x("CIVMALE")]:"Civilian Male",[x("CIVFEMALE")]:"Civilian Female",[x("COP")]:"Police",[x("MEDIC")]:"Paramedic",[x("FIREMAN")]:"Firefighter",[x("ARMY")]:"Military",[x("SECURITY_GUARD")]:"Security Guard",[x("PRIVATE_SECURITY")]:"Private Security",[x("PRISONER")]:"Prisoner",[x("DEALER")]:"Drug Dealer",[x("AMBIENT_GANG_BALLAS")]:"Ballas",[x("AMBIENT_GANG_FAMILY")]:"Families",[x("AMBIENT_GANG_LOST")]:"Lost MC",[x("AMBIENT_GANG_MEXICAN")]:"Mexican Gang",[x("AMBIENT_GANG_SALVA")]:"Salvadorans",[x("AMBIENT_GANG_WEICHENG")]:"Wei Cheng Triad",[x("AMBIENT_GANG_MARABUNTE")]:"Marabunta Grande",[x("AMBIENT_GANG_HILLBILLY")]:"Hillbillies",[x("AMBIENT_GANG_CULT")]:"Altruist Cult",[x("DOMESTIC_ANIMAL")]:"Domestic Animal",[x("WILD_ANIMAL")]:"Wild Animal",[x("GUARD_DOG")]:"Guard Dog",[x("CAT")]:"Cat",[x("COUGAR")]:"Cougar",[x("DEER")]:"Deer",[x("SHARK")]:"Shark",[x("HEN")]:"Hen/Chicken",[x("NO_RELATIONSHIP")]:"No Relationship",[x("RESPOON_SPACE_WOLVES")]:"Space Wolves",[x("RESPOON_ULTRAMARINES")]:"Ultramarines",[x("RESPOON_BLOOD_ANGELS")]:"Blood Angels",[x("RESPOON_DARK_ANGELS")]:"Dark Angels",[x("RESPOON_IMPERIAL_FISTS")]:"Imperial Fists",[x("RESPOON_BLACK_LEGION")]:"Black Legion",[x("RESPOON_WORLD_EATERS")]:"World Eaters",[x("RESPOON_DEATH_GUARD")]:"Death Guard",[x("RESPOON_THOUSAND_SONS")]:"Thousand Sons",[x("RESPOON_EMPERORS_CHILDREN")]:"Emperor's Children"};function Ci(e){return Rl[e]??`Unknown (${e})`}function xi(e){return Ml[e]??`Unknown (${e})`}var Dl=[{key:"spoiler",slot:0,label:T[0],category:"visual"},{key:"frontBumper",slot:1,label:T[1],category:"visual"},{key:"rearBumper",slot:2,label:T[2],category:"visual"},{key:"sideSkirt",slot:3,label:T[3],category:"visual"},{key:"exhaust",slot:4,label:T[4],category:"visual"},{key:"frame",slot:5,label:T[5],category:"visual"},{key:"grille",slot:6,label:T[6],category:"visual"},{key:"hood",slot:7,label:T[7],category:"visual"},{key:"fender",slot:8,label:T[8],category:"visual"},{key:"rightFender",slot:9,label:T[9],category:"visual"},{key:"roof",slot:10,label:T[10],category:"visual"}],Vl=[{key:"dashboard",slot:29,label:T[29],category:"interior"},{key:"dial",slot:30,label:T[30],category:"interior"},{key:"doorSpeaker",slot:31,label:T[31],category:"interior"},{key:"seats",slot:32,label:T[32],category:"interior"},{key:"steeringWheel",slot:33,label:T[33],category:"interior"},{key:"columnShifterLevers",slot:34,label:T[34],category:"interior"},{key:"plaques",slot:35,label:T[35],category:"interior"},{key:"speakers",slot:36,label:T[36],category:"interior"},{key:"trunk",slot:37,label:T[37],category:"interior"},{key:"hydraulics",slot:38,label:T[38],category:"interior"},{key:"engineBlock",slot:39,label:T[39],category:"interior"},{key:"airFilter",slot:40,label:T[40],category:"interior"},{key:"struts",slot:41,label:T[41],category:"interior"},{key:"archCover",slot:42,label:T[42],category:"interior"},{key:"aerials",slot:43,label:T[43],category:"interior"},{key:"trim",slot:27,label:T[27],category:"interior"},{key:"trim2",slot:44,label:T[44],category:"interior"},{key:"tank",slot:45,label:T[45],category:"interior"},{key:"ornaments",slot:28,label:T[28],category:"interior"},{key:"horn",slot:14,label:T[14],category:"interior"}],Fl=[{key:"engine",slot:11,label:T[11],category:"performance"},{key:"brakes",slot:12,label:T[12],category:"performance"},{key:"transmission",slot:13,label:T[13],category:"performance"},{key:"suspension",slot:15,label:T[15],category:"performance"},{key:"armor",slot:16,label:T[16],category:"performance"},{key:"turbo",slot:18,label:T[18],category:"performance"}],$m=[...Fl,...Dl,...Vl];var Un={0:{name:"CTaskHandsUp",displayName:"Hands Up",category:"Basic"},1:{name:"CTaskClimbLadder",displayName:"Climb Ladder",category:"Movement"},2:{name:"CTaskExitVehicle",displayName:"Exit Vehicle",category:"Vehicle"},3:{name:"CTaskCombatRoll",displayName:"Combat Roll",category:"Combat"},4:{name:"CTaskAimGunOnFoot",displayName:"Aim Gun (Foot)",category:"Combat"},5:{name:"CTaskMovePlayer",displayName:"Move Player",category:"Movement"},6:{name:"CTaskPlayerOnFoot",displayName:"Player On Foot",category:"Player"},8:{name:"CTaskWeapon",displayName:"Weapon",category:"Combat"},9:{name:"CTaskPlayerWeapon",displayName:"Player Weapon",category:"Player"},10:{name:"CTaskPlayerIdles",displayName:"Player Idles",category:"Player"},12:{name:"CTaskComplex",displayName:"Complex Task",category:"Base"},14:{name:"CTaskPause",displayName:"Pause",category:"Basic"},15:{name:"CTaskDoNothing",displayName:"Do Nothing",category:"Basic"},16:{name:"CTaskGetUp",displayName:"Get Up",category:"Basic"},17:{name:"CTaskGetUpAndStandStill",displayName:"Get Up And Stand",category:"Basic"},18:{name:"CTaskFallOver",displayName:"Fall Over",category:"Basic"},19:{name:"CTaskFallAndGetUp",displayName:"Fall And Get Up",category:"Basic"},20:{name:"CTaskCrawl",displayName:"Crawl",category:"Movement"},25:{name:"CTaskComplexOnFire",displayName:"On Fire",category:"Reaction"},26:{name:"CTaskDamageElectric",displayName:"Electric Damage",category:"Reaction"},28:{name:"CTaskTriggerLookAt",displayName:"Look At",category:"Basic"},29:{name:"CTaskClearLookAt",displayName:"Clear Look At",category:"Basic"},30:{name:"CTaskSetCharDecisionMaker",displayName:"Set Decision Maker",category:"AI"},31:{name:"CTaskSetPedDefensiveArea",displayName:"Set Defensive Area",category:"AI"},32:{name:"CTaskUseSequence",displayName:"Use Sequence",category:"Scripted"},34:{name:"CTaskMoveStandStill",displayName:"Stand Still",category:"Movement"},35:{name:"CTaskComplexControlMovement",displayName:"Control Movement",category:"Movement"},36:{name:"CTaskMoveSequence",displayName:"Move Sequence",category:"Movement"},38:{name:"CTaskAmbientClips",displayName:"Ambient Clips",category:"Animation"},39:{name:"CTaskMoveInAir",displayName:"Move In Air",category:"Movement"},40:{name:"CTaskNetworkClone",displayName:"Network Clone",category:"Network"},41:{name:"CTaskUseClimbOnRoute",displayName:"Use Climb Route",category:"Movement"},42:{name:"CTaskUseDropDownOnRoute",displayName:"Use Drop Down Route",category:"Movement"},43:{name:"CTaskUseLadderOnRoute",displayName:"Use Ladder Route",category:"Movement"},44:{name:"CTaskSetBlockingOfNonTemporaryEvents",displayName:"Block Events",category:"AI"},45:{name:"CTaskForceMotionState",displayName:"Force Motion State",category:"Movement"},46:{name:"CTaskSlopeScramble",displayName:"Slope Scramble",category:"Movement"},47:{name:"CTaskGoToAndClimbLadder",displayName:"Go To Ladder",category:"Movement"},48:{name:"CTaskClimbLadderFully",displayName:"Climb Ladder Fully",category:"Movement"},49:{name:"CTaskRappel",displayName:"Rappel",category:"Movement"},50:{name:"CTaskVault",displayName:"Vault",category:"Movement"},51:{name:"CTaskDropDown",displayName:"Drop Down",category:"Movement"},52:{name:"CTaskAffectSecondaryBehaviour",displayName:"Secondary Behaviour",category:"AI"},53:{name:"CTaskAmbientLookAtEvent",displayName:"Look At Event",category:"Reaction"},54:{name:"CTaskOpenDoor",displayName:"Open Door",category:"Interaction"},55:{name:"CTaskShovePed",displayName:"Shove Ped",category:"Combat"},56:{name:"CTaskSwapWeapon",displayName:"Swap Weapon",category:"Combat"},57:{name:"CTaskGeneralSweep",displayName:"General Sweep",category:"AI"},58:{name:"CTaskPolice",displayName:"Police",category:"Police"},59:{name:"CTaskPoliceOrderResponse",displayName:"Police Order Response",category:"Police"},60:{name:"CTaskPursueCriminal",displayName:"Pursue Criminal",category:"Police"},62:{name:"CTaskArrestPed",displayName:"Arrest Ped",category:"Police"},63:{name:"CTaskArrestPed2",displayName:"Arrest Ped 2",category:"Police"},64:{name:"CTaskBusted",displayName:"Busted",category:"Police"},65:{name:"CTaskFirePatrol",displayName:"Fire Patrol",category:"Emergency"},66:{name:"CTaskHeliOrderResponse",displayName:"Heli Order Response",category:"Police"},67:{name:"CTaskHeliPassengerRappel",displayName:"Heli Passenger Rappel",category:"Police"},68:{name:"CTaskAmbulancePatrol",displayName:"Ambulance Patrol",category:"Emergency"},69:{name:"CTaskPoliceWantedResponse",displayName:"Police Wanted Response",category:"Police"},70:{name:"CTaskSwat",displayName:"SWAT",category:"Police"},72:{name:"CTaskSwatWantedResponse",displayName:"SWAT Wanted Response",category:"Police"},73:{name:"CTaskSwatOrderResponse",displayName:"SWAT Order Response",category:"Police"},74:{name:"CTaskSwatGoToStagingArea",displayName:"SWAT Staging",category:"Police"},75:{name:"CTaskSwatFollowInLine",displayName:"SWAT Follow Line",category:"Police"},76:{name:"CTaskWitness",displayName:"Witness",category:"Reaction"},77:{name:"CTaskGangPatrol",displayName:"Gang Patrol",category:"AI"},78:{name:"CTaskArmy",displayName:"Army",category:"Combat"},80:{name:"CTaskShockingEventWatch",displayName:"Watch Shocking Event",category:"Reaction"},82:{name:"CTaskShockingEventGoto",displayName:"Go To Shocking Event",category:"Reaction"},83:{name:"CTaskShockingEventHurryAway",displayName:"Hurry Away",category:"Reaction"},84:{name:"CTaskShockingEventReactToAircraft",displayName:"React To Aircraft",category:"Reaction"},85:{name:"CTaskShockingEventReact",displayName:"React To Event",category:"Reaction"},86:{name:"CTaskShockingEventBackAway",displayName:"Back Away",category:"Reaction"},87:{name:"CTaskShockingPoliceInvestigate",displayName:"Police Investigate",category:"Police"},88:{name:"CTaskShockingEventStopAndStare",displayName:"Stop And Stare",category:"Reaction"},89:{name:"CTaskShockingNiceCarPicture",displayName:"Nice Car Picture",category:"Reaction"},90:{name:"CTaskShockingEventThreatResponse",displayName:"Threat Response",category:"Reaction"},92:{name:"CTaskTakeOffHelmet",displayName:"Take Off Helmet",category:"Basic"},93:{name:"CTaskCarReactToVehicleCollision",displayName:"React To Collision",category:"Vehicle"},95:{name:"CTaskCarReactToVehicleCollisionGetOut",displayName:"React Collision Get Out",category:"Vehicle"},97:{name:"CTaskDyingDead",displayName:"Dying/Dead",category:"Basic"},100:{name:"CTaskWanderingScenario",displayName:"Wandering Scenario",category:"Scenario"},101:{name:"CTaskWanderingInRadiusScenario",displayName:"Wander In Radius",category:"Scenario"},103:{name:"CTaskMoveBetweenPointsScenario",displayName:"Move Between Points",category:"Scenario"},104:{name:"CTaskChatScenario",displayName:"Chat Scenario",category:"Scenario"},106:{name:"CTaskCowerScenario",displayName:"Cower Scenario",category:"Scenario"},107:{name:"CTaskDeadBodyScenario",displayName:"Dead Body Scenario",category:"Scenario"},114:{name:"CTaskSayAudio",displayName:"Say Audio",category:"Audio"},116:{name:"CTaskWaitForSteppingOut",displayName:"Wait For Stepping Out",category:"Vehicle"},117:{name:"CTaskCoupleScenario",displayName:"Couple Scenario",category:"Scenario"},118:{name:"CTaskUseScenario",displayName:"Use Scenario",category:"Scenario"},119:{name:"CTaskUseVehicleScenario",displayName:"Use Vehicle Scenario",category:"Scenario"},120:{name:"CTaskUnalerted",displayName:"Unalerted",category:"AI"},121:{name:"CTaskStealVehicle",displayName:"Steal Vehicle",category:"Vehicle"},122:{name:"CTaskReactToPursuit",displayName:"React To Pursuit",category:"Reaction"},125:{name:"CTaskHitWall",displayName:"Hit Wall",category:"Movement"},126:{name:"CTaskCower",displayName:"Cower",category:"Reaction"},127:{name:"CTaskCrouch",displayName:"Crouch",category:"Movement"},128:{name:"CTaskMelee",displayName:"Melee",category:"Combat"},129:{name:"CTaskMoveMeleeMovement",displayName:"Melee Movement",category:"Combat"},130:{name:"CTaskMeleeActionResult",displayName:"Melee Action Result",category:"Combat"},131:{name:"CTaskMeleeUpperbodyAnims",displayName:"Melee Upperbody",category:"Combat"},133:{name:"CTaskMoVEScripted",displayName:"Move Scripted",category:"Scripted"},134:{name:"CTaskScriptedAnimation",displayName:"Scripted Animation",category:"Animation"},135:{name:"CTaskSynchronizedScene",displayName:"Synchronized Scene",category:"Animation"},137:{name:"CTaskComplexEvasiveStep",displayName:"Evasive Step",category:"Movement"},138:{name:"CTaskWalkRoundCarWhileWandering",displayName:"Walk Round Car",category:"Movement"},140:{name:"CTaskComplexStuckInAir",displayName:"Stuck In Air",category:"Movement"},141:{name:"CTaskWalkRoundEntity",displayName:"Walk Round Entity",category:"Movement"},142:{name:"CTaskMoveWalkRoundVehicle",displayName:"Walk Round Vehicle",category:"Movement"},144:{name:"CTaskReactToGunAimedAt",displayName:"React To Gun Aimed",category:"Reaction"},146:{name:"CTaskDuckAndCover",displayName:"Duck And Cover",category:"Combat"},147:{name:"CTaskAggressiveRubberneck",displayName:"Aggressive Rubberneck",category:"Reaction"},150:{name:"CTaskInVehicleBasic",displayName:"In Vehicle Basic",category:"Vehicle"},151:{name:"CTaskCarDriveWander",displayName:"Car Drive Wander",category:"Vehicle"},152:{name:"CTaskLeaveAnyCar",displayName:"Leave Any Car",category:"Vehicle"},153:{name:"CTaskComplexGetOffBoat",displayName:"Get Off Boat",category:"Vehicle"},155:{name:"CTaskCarSetTempAction",displayName:"Car Temp Action",category:"Vehicle"},156:{name:"CTaskBringVehicleToHalt",displayName:"Bring Vehicle To Halt",category:"Vehicle"},157:{name:"CTaskCarDrive",displayName:"Car Drive",category:"Vehicle"},159:{name:"CTaskPlayerDrive",displayName:"Player Drive",category:"Player"},160:{name:"CTaskEnterVehicle",displayName:"Enter Vehicle",category:"Vehicle"},161:{name:"CTaskEnterVehicleAlign",displayName:"Enter Vehicle Align",category:"Vehicle"},162:{name:"CTaskOpenVehicleDoorFromOutside",displayName:"Open Door From Outside",category:"Vehicle"},163:{name:"CTaskEnterVehicleSeat",displayName:"Enter Vehicle Seat",category:"Vehicle"},164:{name:"CTaskCloseVehicleDoorFromInside",displayName:"Close Door From Inside",category:"Vehicle"},165:{name:"CTaskInVehicleSeatShuffle",displayName:"Seat Shuffle",category:"Vehicle"},167:{name:"CTaskExitVehicleSeat",displayName:"Exit Vehicle Seat",category:"Vehicle"},168:{name:"CTaskCloseVehicleDoorFromOutside",displayName:"Close Door From Outside",category:"Vehicle"},169:{name:"CTaskControlVehicle",displayName:"Control Vehicle",category:"Vehicle"},170:{name:"CTaskMotionInAutomobile",displayName:"Motion In Automobile",category:"Vehicle"},171:{name:"CTaskMotionOnBicycle",displayName:"Motion On Bicycle",category:"Vehicle"},172:{name:"CTaskMotionOnBicycleController",displayName:"Bicycle Controller",category:"Vehicle"},173:{name:"CTaskMotionInVehicle",displayName:"Motion In Vehicle",category:"Vehicle"},174:{name:"CTaskMotionInTurret",displayName:"Motion In Turret",category:"Vehicle"},175:{name:"CTaskReactToBeingJacked",displayName:"React To Being Jacked",category:"Vehicle"},176:{name:"CTaskReactToBeingAskedToLeaveVehicle",displayName:"Asked To Leave Vehicle",category:"Vehicle"},177:{name:"CTaskTryToGrabVehicleDoor",displayName:"Grab Vehicle Door",category:"Vehicle"},178:{name:"CTaskGetOnTrain",displayName:"Get On Train",category:"Vehicle"},179:{name:"CTaskGetOffTrain",displayName:"Get Off Train",category:"Vehicle"},180:{name:"CTaskRideTrain",displayName:"Ride Train",category:"Vehicle"},190:{name:"CTaskMountThrowProjectile",displayName:"Mount Throw Projectile",category:"Combat"},195:{name:"CTaskGoToCarDoorAndStandStill",displayName:"Go To Car Door",category:"Vehicle"},196:{name:"CTaskMoveGoToVehicleDoor",displayName:"Move To Vehicle Door",category:"Vehicle"},197:{name:"CTaskSetPedInVehicle",displayName:"Set Ped In Vehicle",category:"Vehicle"},198:{name:"CTaskSetPedOutOfVehicle",displayName:"Set Ped Out Of Vehicle",category:"Vehicle"},199:{name:"CTaskVehicleMountedWeapon",displayName:"Vehicle Mounted Weapon",category:"Combat"},200:{name:"CTaskVehicleGun",displayName:"Vehicle Gun",category:"Combat"},201:{name:"CTaskVehicleProjectile",displayName:"Vehicle Projectile",category:"Combat"},204:{name:"CTaskSmashCarWindow",displayName:"Smash Car Window",category:"Vehicle"},205:{name:"CTaskMoveGoToPoint",displayName:"Go To Point",category:"Movement"},206:{name:"CTaskMoveAchieveHeading",displayName:"Achieve Heading",category:"Movement"},207:{name:"CTaskMoveFaceTarget",displayName:"Face Target",category:"Movement"},208:{name:"CTaskMoveGoToPointAndStandStill",displayName:"Go To Point And Stand",category:"Movement"},209:{name:"CTaskMoveFollowPointRoute",displayName:"Follow Point Route",category:"Movement"},210:{name:"CTaskMoveSeekEntity_Standard",displayName:"Seek Entity (Standard)",category:"Movement"},211:{name:"CTaskMoveSeekEntity_NavMesh",displayName:"Seek Entity (NavMesh)",category:"Movement"},212:{name:"CTaskMoveSeekEntity_NavMesh2",displayName:"Seek Entity (NavMesh 2)",category:"Movement"},213:{name:"CTaskMoveSeekEntity_XYOffset",displayName:"Seek Entity (XY Offset)",category:"Movement"},214:{name:"CTaskMoveSeekEntity_XYOffset2",displayName:"Seek Entity (XY Offset 2)",category:"Movement"},215:{name:"CTaskExhaustedFlee",displayName:"Exhausted Flee",category:"Flee"},216:{name:"CTaskGrowlAndFlee",displayName:"Growl And Flee",category:"Flee"},217:{name:"CTaskScenarioFlee",displayName:"Scenario Flee",category:"Flee"},218:{name:"CTaskSmartFlee",displayName:"Smart Flee",category:"Flee"},219:{name:"CTaskFlyAway",displayName:"Fly Away",category:"Flee"},220:{name:"CTaskWalkAway",displayName:"Walk Away",category:"Flee"},221:{name:"CTaskWander",displayName:"Wander",category:"Movement"},222:{name:"CTaskWanderInArea",displayName:"Wander In Area",category:"Movement"},223:{name:"CTaskFollowLeaderInFormation",displayName:"Follow Leader Formation",category:"Movement"},224:{name:"CTaskGoToPointAnyMeans",displayName:"Go To Point Any Means",category:"Movement"},225:{name:"CTaskTurnToFaceEntityOrCoord",displayName:"Turn To Face",category:"Movement"},226:{name:"CTaskFollowLeaderAnyMeans",displayName:"Follow Leader Any Means",category:"Movement"},228:{name:"CTaskFlyToPoint",displayName:"Fly To Point",category:"Movement"},229:{name:"CTaskFlyingWander",displayName:"Flying Wander",category:"Movement"},230:{name:"CTaskGoToPointAiming",displayName:"Go To Point Aiming",category:"Combat"},231:{name:"CTaskGoToScenario",displayName:"Go To Scenario",category:"Movement"},233:{name:"CTaskSeekEntityAiming",displayName:"Seek Entity Aiming",category:"Combat"},234:{name:"CTaskSlideToCoord",displayName:"Slide To Coord",category:"Movement"},235:{name:"CTaskSwimmingWander",displayName:"Swimming Wander",category:"Movement"},237:{name:"CTaskMoveTrackingEntity",displayName:"Track Entity",category:"Movement"},238:{name:"CTaskMoveFollowNavMesh",displayName:"Follow NavMesh",category:"Movement"},239:{name:"CTaskMoveGoToPointOnRoute",displayName:"Go To Point On Route",category:"Movement"},240:{name:"CTaskEscapeBlast",displayName:"Escape Blast",category:"Reaction"},241:{name:"CTaskMoveWander",displayName:"Move Wander",category:"Movement"},242:{name:"CTaskMoveBeInFormation",displayName:"Be In Formation",category:"Movement"},243:{name:"CTaskMoveCrowdAroundLocation",displayName:"Crowd Around Location",category:"Movement"},244:{name:"CTaskMoveCrossRoadAtTrafficLights",displayName:"Cross Road At Lights",category:"Movement"},245:{name:"CTaskMoveWaitForTraffic",displayName:"Wait For Traffic",category:"Movement"},246:{name:"CTaskMoveGoToPointStandStillAchieveHeading",displayName:"Go Stand Achieve Heading",category:"Movement"},251:{name:"CTaskMoveGetOntoMainNavMesh",displayName:"Get Onto NavMesh",category:"Movement"},252:{name:"CTaskMoveSlideToCoord",displayName:"Move Slide To Coord",category:"Movement"},253:{name:"CTaskMoveGoToPointRelativeToEntityAndStandStill",displayName:"Go Relative To Entity",category:"Movement"},254:{name:"CTaskHelicopterStrafe",displayName:"Helicopter Strafe",category:"Vehicle"},256:{name:"CTaskGetOutOfWater",displayName:"Get Out Of Water",category:"Movement"},259:{name:"CTaskMoveFollowEntityOffset",displayName:"Follow Entity Offset",category:"Movement"},261:{name:"CTaskFollowWaypointRecording",displayName:"Follow Waypoint Recording",category:"Movement"},264:{name:"CTaskMotionPed",displayName:"Motion Ped",category:"Movement"},265:{name:"CTaskMotionPedLowLod",displayName:"Motion Ped Low LOD",category:"Movement"},268:{name:"CTaskHumanLocomotion",displayName:"Human Locomotion",category:"Movement"},269:{name:"CTaskMotionBasicLocomotionLowLod",displayName:"Basic Locomotion Low LOD",category:"Movement"},270:{name:"CTaskMotionStrafing",displayName:"Motion Strafing",category:"Movement"},271:{name:"CTaskMotionTennis",displayName:"Motion Tennis",category:"Sport"},272:{name:"CTaskMotionAiming",displayName:"Motion Aiming",category:"Combat"},273:{name:"CTaskBirdLocomotion",displayName:"Bird Locomotion",category:"Animal"},274:{name:"CTaskFlightlessBirdLocomotion",displayName:"Flightless Bird Locomotion",category:"Animal"},278:{name:"CTaskFishLocomotion",displayName:"Fish Locomotion",category:"Animal"},279:{name:"CTaskQuadLocomotion",displayName:"Quad Locomotion",category:"Animal"},280:{name:"CTaskMotionDiving",displayName:"Motion Diving",category:"Movement"},281:{name:"CTaskMotionSwimming",displayName:"Motion Swimming",category:"Movement"},282:{name:"CTaskMotionParachuting",displayName:"Motion Parachuting",category:"Movement"},283:{name:"CTaskMotionDrunk",displayName:"Motion Drunk",category:"Movement"},284:{name:"CTaskRepositionMove",displayName:"Reposition Move",category:"Movement"},285:{name:"CTaskMotionAimingTransition",displayName:"Aiming Transition",category:"Combat"},286:{name:"CTaskThrowProjectile",displayName:"Throw Projectile",category:"Combat"},287:{name:"CTaskCover",displayName:"Cover",category:"Combat"},288:{name:"CTaskMotionInCover",displayName:"Motion In Cover",category:"Combat"},289:{name:"CTaskAimAndThrowProjectile",displayName:"Aim And Throw Projectile",category:"Combat"},290:{name:"CTaskGun",displayName:"Gun",category:"Combat"},291:{name:"CTaskAimFromGround",displayName:"Aim From Ground",category:"Combat"},295:{name:"CTaskAimGunVehicleDriveBy",displayName:"Aim Gun Drive By",category:"Combat"},296:{name:"CTaskAimGunScripted",displayName:"Aim Gun Scripted",category:"Combat"},298:{name:"CTaskReloadGun",displayName:"Reload Gun",category:"Combat"},299:{name:"CTaskWeaponBlocked",displayName:"Weapon Blocked",category:"Combat"},300:{name:"CTaskEnterCover",displayName:"Enter Cover",category:"Combat"},301:{name:"CTaskExitCover",displayName:"Exit Cover",category:"Combat"},302:{name:"CTaskAimGunFromCoverIntro",displayName:"Aim From Cover Intro",category:"Combat"},303:{name:"CTaskAimGunFromCoverOutro",displayName:"Aim From Cover Outro",category:"Combat"},304:{name:"CTaskAimGunBlindFire",displayName:"Blind Fire",category:"Combat"},307:{name:"CTaskCombatClosestTargetInArea",displayName:"Combat Closest Target",category:"Combat"},308:{name:"CTaskCombatAdditionalTask",displayName:"Combat Additional Task",category:"Combat"},309:{name:"CTaskInCover",displayName:"In Cover",category:"Combat"},313:{name:"CTaskAimSweep",displayName:"Aim Sweep",category:"Combat"},319:{name:"CTaskSharkCircle",displayName:"Shark Circle",category:"Animal"},320:{name:"CTaskSharkAttack",displayName:"Shark Attack",category:"Animal"},321:{name:"CTaskAgitated",displayName:"Agitated",category:"Reaction"},322:{name:"CTaskAgitatedAction",displayName:"Agitated Action",category:"Reaction"},323:{name:"CTaskConfront",displayName:"Confront",category:"Combat"},324:{name:"CTaskIntimidate",displayName:"Intimidate",category:"Combat"},325:{name:"CTaskShove",displayName:"Shove",category:"Combat"},326:{name:"CTaskShoved",displayName:"Shoved",category:"Reaction"},328:{name:"CTaskCrouchToggle",displayName:"Crouch Toggle",category:"Movement"},329:{name:"CTaskRevive",displayName:"Revive",category:"Basic"},335:{name:"CTaskParachute",displayName:"Parachute",category:"Movement"},336:{name:"CTaskParachuteObject",displayName:"Parachute Object",category:"Movement"},337:{name:"CTaskTakeOffPedVariation",displayName:"Take Off Ped Variation",category:"Basic"},340:{name:"CTaskCombatSeekCover",displayName:"Combat Seek Cover",category:"Combat"},342:{name:"CTaskCombatFlank",displayName:"Combat Flank",category:"Combat"},343:{name:"CTaskCombat",displayName:"Combat",category:"Combat"},344:{name:"CTaskCombatMounted",displayName:"Combat Mounted",category:"Combat"},345:{name:"CTaskMoveCircle",displayName:"Move Circle",category:"Movement"},346:{name:"CTaskMoveCombatMounted",displayName:"Move Combat Mounted",category:"Combat"},347:{name:"CTaskSearch",displayName:"Search",category:"AI"},348:{name:"CTaskSearchOnFoot",displayName:"Search On Foot",category:"AI"},349:{name:"CTaskSearchInAutomobile",displayName:"Search In Automobile",category:"AI"},350:{name:"CTaskSearchInBoat",displayName:"Search In Boat",category:"AI"},351:{name:"CTaskSearchInHeli",displayName:"Search In Heli",category:"AI"},352:{name:"CTaskThreatResponse",displayName:"Threat Response",category:"AI"},353:{name:"CTaskInvestigate",displayName:"Investigate",category:"AI"},354:{name:"CTaskStandGuardFSM",displayName:"Stand Guard FSM",category:"AI"},355:{name:"CTaskPatrol",displayName:"Patrol",category:"AI"},356:{name:"CTaskShootAtTarget",displayName:"Shoot At Target",category:"Combat"},357:{name:"CTaskSetAndGuardArea",displayName:"Set And Guard Area",category:"AI"},358:{name:"CTaskStandGuard",displayName:"Stand Guard",category:"AI"},359:{name:"CTaskSeparate",displayName:"Separate",category:"Movement"},360:{name:"CTaskStayInCover",displayName:"Stay In Cover",category:"Combat"},361:{name:"CTaskVehicleCombat",displayName:"Vehicle Combat",category:"Combat"},362:{name:"CTaskVehiclePersuit",displayName:"Vehicle Pursuit",category:"Vehicle"},363:{name:"CTaskVehicleChase",displayName:"Vehicle Chase",category:"Vehicle"},364:{name:"CTaskDraggingToSafety",displayName:"Dragging To Safety",category:"AI"},365:{name:"CTaskDraggedToSafety",displayName:"Dragged To Safety",category:"Reaction"},366:{name:"CTaskVariedAimPose",displayName:"Varied Aim Pose",category:"Combat"},367:{name:"CTaskMoveWithinAttackWindow",displayName:"Move Within Attack Window",category:"Combat"},368:{name:"CTaskMoveWithinDefensiveArea",displayName:"Move Within Defensive Area",category:"Combat"},369:{name:"CTaskShootOutTire",displayName:"Shoot Out Tire",category:"Combat"},370:{name:"CTaskShellShocked",displayName:"Shell Shocked",category:"Reaction"},371:{name:"CTaskBoatChase",displayName:"Boat Chase",category:"Vehicle"},372:{name:"CTaskBoatCombat",displayName:"Boat Combat",category:"Combat"},373:{name:"CTaskBoatStrafe",displayName:"Boat Strafe",category:"Vehicle"},374:{name:"CTaskHeliChase",displayName:"Heli Chase",category:"Vehicle"},375:{name:"CTaskHeliCombat",displayName:"Heli Combat",category:"Combat"},376:{name:"CTaskSubmarineCombat",displayName:"Submarine Combat",category:"Combat"},377:{name:"CTaskSubmarineChase",displayName:"Submarine Chase",category:"Vehicle"},378:{name:"CTaskPlaneChase",displayName:"Plane Chase",category:"Vehicle"},379:{name:"CTaskTargetUnreachable",displayName:"Target Unreachable",category:"AI"},380:{name:"CTaskTargetUnreachableInInterior",displayName:"Target Unreachable Interior",category:"AI"},381:{name:"CTaskTargetUnreachableInExterior",displayName:"Target Unreachable Exterior",category:"AI"},382:{name:"CTaskStealthKill",displayName:"Stealth Kill",category:"Combat"},383:{name:"CTaskWrithe",displayName:"Writhe",category:"Reaction"},384:{name:"CTaskAdvance",displayName:"Advance",category:"Combat"},385:{name:"CTaskCharge",displayName:"Charge",category:"Combat"},386:{name:"CTaskMoveToTacticalPoint",displayName:"Move To Tactical Point",category:"Combat"},387:{name:"CTaskToHurtTransit",displayName:"To Hurt Transit",category:"Reaction"},388:{name:"CTaskAnimatedHitByExplosion",displayName:"Hit By Explosion",category:"Reaction"},389:{name:"CTaskNMRelax",displayName:"NM Relax",category:"Ragdoll"},391:{name:"CTaskNMPose",displayName:"NM Pose",category:"Ragdoll"},392:{name:"CTaskNMBrace",displayName:"NM Brace",category:"Ragdoll"},393:{name:"CTaskNMBuoyancy",displayName:"NM Buoyancy",category:"Ragdoll"},394:{name:"CTaskNMInjuredOnGround",displayName:"NM Injured On Ground",category:"Ragdoll"},395:{name:"CTaskNMShot",displayName:"NM Shot",category:"Ragdoll"},396:{name:"CTaskNMHighFall",displayName:"NM High Fall",category:"Ragdoll"},397:{name:"CTaskNMBalance",displayName:"NM Balance",category:"Ragdoll"},398:{name:"CTaskNMElectrocute",displayName:"NM Electrocute",category:"Ragdoll"},399:{name:"CTaskNMPrototype",displayName:"NM Prototype",category:"Ragdoll"},400:{name:"CTaskNMExplosion",displayName:"NM Explosion",category:"Ragdoll"},401:{name:"CTaskNMOnFire",displayName:"NM On Fire",category:"Ragdoll"},402:{name:"CTaskNMScriptControl",displayName:"NM Script Control",category:"Ragdoll"},403:{name:"CTaskNMJumpRollFromRoadVehicle",displayName:"NM Jump From Vehicle",category:"Ragdoll"},404:{name:"CTaskNMFlinch",displayName:"NM Flinch",category:"Ragdoll"},405:{name:"CTaskNMSit",displayName:"NM Sit",category:"Ragdoll"},406:{name:"CTaskNMFallDown",displayName:"NM Fall Down",category:"Ragdoll"},407:{name:"CTaskBlendFromNM",displayName:"Blend From NM",category:"Ragdoll"},408:{name:"CTaskNMControl",displayName:"NM Control",category:"Ragdoll"},409:{name:"CTaskNMDangle",displayName:"NM Dangle",category:"Ragdoll"},412:{name:"CTaskNMGenericAttach",displayName:"NM Generic Attach",category:"Ragdoll"},414:{name:"CTaskNMDraggingToSafety",displayName:"NM Dragging To Safety",category:"Ragdoll"},415:{name:"CTaskNMThroughWindscreen",displayName:"NM Through Windscreen",category:"Ragdoll"},416:{name:"CTaskNMRiverRapids",displayName:"NM River Rapids",category:"Ragdoll"},417:{name:"CTaskNMSimple",displayName:"NM Simple",category:"Ragdoll"},418:{name:"CTaskRageRagdoll",displayName:"Rage Ragdoll",category:"Ragdoll"},421:{name:"CTaskJumpVault",displayName:"Jump Vault",category:"Movement"},422:{name:"CTaskJump",displayName:"Jump",category:"Movement"},423:{name:"CTaskFall",displayName:"Fall",category:"Movement"},425:{name:"CTaskReactAimWeapon",displayName:"React Aim Weapon",category:"Reaction"},426:{name:"CTaskChat",displayName:"Chat",category:"Social"},427:{name:"CTaskMobilePhone",displayName:"Mobile Phone",category:"Social"},428:{name:"CTaskReactToDeadPed",displayName:"React To Dead Ped",category:"Reaction"},430:{name:"CTaskSearchForUnknownThreat",displayName:"Search Unknown Threat",category:"AI"},432:{name:"CTaskBomb",displayName:"Bomb",category:"Combat"},433:{name:"CTaskDetonator",displayName:"Detonator",category:"Combat"},435:{name:"CTaskAnimatedAttach",displayName:"Animated Attach",category:"Animation"},441:{name:"CTaskCutScene",displayName:"Cut Scene",category:"Scripted"},442:{name:"CTaskReactToExplosion",displayName:"React To Explosion",category:"Reaction"},443:{name:"CTaskReactToImminentExplosion",displayName:"React To Imminent Explosion",category:"Reaction"},444:{name:"CTaskDiveToGround",displayName:"Dive To Ground",category:"Reaction"},445:{name:"CTaskReactAndFlee",displayName:"React And Flee",category:"Flee"},446:{name:"CTaskSidestep",displayName:"Sidestep",category:"Movement"},447:{name:"CTaskCallPolice",displayName:"Call Police",category:"Social"},448:{name:"CTaskReactInDirection",displayName:"React In Direction",category:"Reaction"},449:{name:"CTaskReactToBuddyShot",displayName:"React To Buddy Shot",category:"Reaction"},454:{name:"CTaskVehicleGoToAutomobileNew",displayName:"Vehicle Go To Automobile",category:"Vehicle"},455:{name:"CTaskVehicleGoToPlane",displayName:"Vehicle Go To Plane",category:"Vehicle"},456:{name:"CTaskVehicleGoToHelicopter",displayName:"Vehicle Go To Helicopter",category:"Vehicle"},457:{name:"CTaskVehicleGoToSubmarine",displayName:"Vehicle Go To Submarine",category:"Vehicle"},458:{name:"CTaskVehicleGoToBoat",displayName:"Vehicle Go To Boat",category:"Vehicle"},459:{name:"CTaskVehicleGoToPointAutomobile",displayName:"Vehicle Go To Point",category:"Vehicle"},460:{name:"CTaskVehicleGoToPointWithAvoidanceAutomobile",displayName:"Vehicle Go With Avoidance",category:"Vehicle"},461:{name:"CTaskVehiclePursue",displayName:"Vehicle Pursue",category:"Vehicle"},462:{name:"CTaskVehicleRam",displayName:"Vehicle Ram",category:"Vehicle"},463:{name:"CTaskVehicleSpinOut",displayName:"Vehicle Spin Out",category:"Vehicle"},464:{name:"CTaskVehicleApproach",displayName:"Vehicle Approach",category:"Vehicle"},465:{name:"CTaskVehicleThreePointTurn",displayName:"Vehicle Three Point Turn",category:"Vehicle"},466:{name:"CTaskVehicleDeadDriver",displayName:"Vehicle Dead Driver",category:"Vehicle"},467:{name:"CTaskVehicleCruiseNew",displayName:"Vehicle Cruise",category:"Vehicle"},468:{name:"CTaskVehicleCruiseBoat",displayName:"Vehicle Cruise Boat",category:"Vehicle"},469:{name:"CTaskVehicleStop",displayName:"Vehicle Stop",category:"Vehicle"},470:{name:"CTaskVehiclePullOver",displayName:"Vehicle Pull Over",category:"Vehicle"},471:{name:"CTaskVehiclePassengerExit",displayName:"Vehicle Passenger Exit",category:"Vehicle"},472:{name:"CTaskVehicleFlee",displayName:"Vehicle Flee",category:"Vehicle"},473:{name:"CTaskVehicleFleeAirborne",displayName:"Vehicle Flee Airborne",category:"Vehicle"},474:{name:"CTaskVehicleFleeBoat",displayName:"Vehicle Flee Boat",category:"Vehicle"},475:{name:"CTaskVehicleFollowRecording",displayName:"Vehicle Follow Recording",category:"Vehicle"},476:{name:"CTaskVehicleFollow",displayName:"Vehicle Follow",category:"Vehicle"},477:{name:"CTaskVehicleBlock",displayName:"Vehicle Block",category:"Vehicle"},478:{name:"CTaskVehicleBlockCruiseInFront",displayName:"Vehicle Block Cruise Front",category:"Vehicle"},479:{name:"CTaskVehicleBlockBrakeInFront",displayName:"Vehicle Block Brake Front",category:"Vehicle"},481:{name:"CTaskVehicleCrash",displayName:"Vehicle Crash",category:"Vehicle"},482:{name:"CTaskVehicleLand",displayName:"Vehicle Land",category:"Vehicle"},483:{name:"CTaskVehicleLandPlane",displayName:"Vehicle Land Plane",category:"Vehicle"},484:{name:"CTaskVehicleHover",displayName:"Vehicle Hover",category:"Vehicle"},485:{name:"CTaskVehicleAttack",displayName:"Vehicle Attack",category:"Combat"},486:{name:"CTaskVehicleAttackTank",displayName:"Vehicle Attack Tank",category:"Combat"},487:{name:"CTaskVehicleCircle",displayName:"Vehicle Circle",category:"Vehicle"},488:{name:"CTaskVehiclePoliceBehaviour",displayName:"Vehicle Police Behaviour",category:"Police"},489:{name:"CTaskVehiclePoliceBehaviourHelicopter",displayName:"Vehicle Police Heli",category:"Police"},490:{name:"CTaskVehiclePoliceBehaviourBoat",displayName:"Vehicle Police Boat",category:"Police"},491:{name:"CTaskVehicleEscort",displayName:"Vehicle Escort",category:"Vehicle"},492:{name:"CTaskVehicleHeliProtect",displayName:"Vehicle Heli Protect",category:"Vehicle"},494:{name:"CTaskVehiclePlayerDriveAutomobile",displayName:"Player Drive Automobile",category:"Player"},495:{name:"CTaskVehiclePlayerDriveBike",displayName:"Player Drive Bike",category:"Player"},496:{name:"CTaskVehiclePlayerDriveBoat",displayName:"Player Drive Boat",category:"Player"},497:{name:"CTaskVehiclePlayerDriveSubmarine",displayName:"Player Drive Submarine",category:"Player"},498:{name:"CTaskVehiclePlayerDriveSubmarineCar",displayName:"Player Drive Submarine Car",category:"Player"},499:{name:"CTaskVehiclePlayerDriveAmphibiousAutomobile",displayName:"Player Drive Amphibious",category:"Player"},500:{name:"CTaskVehiclePlayerDrivePlane",displayName:"Player Drive Plane",category:"Player"},501:{name:"CTaskVehiclePlayerDriveHeli",displayName:"Player Drive Heli",category:"Player"},502:{name:"CTaskVehiclePlayerDriveAutogyro",displayName:"Player Drive Autogyro",category:"Player"},503:{name:"CTaskVehiclePlayerDriveDiggerArm",displayName:"Player Drive Digger Arm",category:"Player"},504:{name:"CTaskVehiclePlayerDriveTrain",displayName:"Player Drive Train",category:"Player"},505:{name:"CTaskVehiclePlaneChase",displayName:"Vehicle Plane Chase",category:"Vehicle"},506:{name:"CTaskVehicleNoDriver",displayName:"Vehicle No Driver",category:"Vehicle"},507:{name:"CTaskVehicleAnimation",displayName:"Vehicle Animation",category:"Vehicle"},508:{name:"CTaskVehicleConvertibleRoof",displayName:"Vehicle Convertible Roof",category:"Vehicle"},509:{name:"CTaskVehicleParkNew",displayName:"Vehicle Park",category:"Vehicle"},510:{name:"CTaskVehicleFollowWaypointRecording",displayName:"Vehicle Follow Waypoint",category:"Vehicle"},511:{name:"CTaskVehicleGoToNavmesh",displayName:"Vehicle Go To Navmesh",category:"Vehicle"},512:{name:"CTaskVehicleReactToCopSiren",displayName:"Vehicle React To Cop Siren",category:"Vehicle"},513:{name:"CTaskVehicleGotoLongRange",displayName:"Vehicle Goto Long Range",category:"Vehicle"},514:{name:"CTaskVehicleWait",displayName:"Vehicle Wait",category:"Vehicle"},515:{name:"CTaskVehicleReverse",displayName:"Vehicle Reverse",category:"Vehicle"},516:{name:"CTaskVehicleBrake",displayName:"Vehicle Brake",category:"Vehicle"},517:{name:"CTaskVehicleHandBrake",displayName:"Vehicle Hand Brake",category:"Vehicle"},518:{name:"CTaskVehicleTurn",displayName:"Vehicle Turn",category:"Vehicle"},519:{name:"CTaskVehicleGoForward",displayName:"Vehicle Go Forward",category:"Vehicle"},520:{name:"CTaskVehicleSwerve",displayName:"Vehicle Swerve",category:"Vehicle"},521:{name:"CTaskVehicleFlyDirection",displayName:"Vehicle Fly Direction",category:"Vehicle"},522:{name:"CTaskVehicleHeadonCollision",displayName:"Vehicle Head On Collision",category:"Vehicle"},523:{name:"CTaskVehicleBoostUseSteeringAngle",displayName:"Vehicle Boost Steering",category:"Vehicle"},524:{name:"CTaskVehicleShotTire",displayName:"Vehicle Shot Tire",category:"Vehicle"},525:{name:"CTaskVehicleBurnout",displayName:"Vehicle Burnout",category:"Vehicle"},526:{name:"CTaskVehicleRevEngine",displayName:"Vehicle Rev Engine",category:"Vehicle"},527:{name:"CTaskVehicleSurfaceInSubmarine",displayName:"Vehicle Surface Submarine",category:"Vehicle"},528:{name:"CTaskVehiclePullAlongside",displayName:"Vehicle Pull Alongside",category:"Vehicle"},529:{name:"CTaskVehicleTransformToSubmarine",displayName:"Vehicle Transform Submarine",category:"Vehicle"},530:{name:"CTaskAnimatedFallback",displayName:"Animated Fallback",category:"Animation"}};var ep=Object.keys(Un).length;var at={alertness:1,combatAbility:1,combatMovement:1,combatRange:1,seeingRange:50,hearingRange:50,targetLossResponse:2},Lr={passive:{alertness:0,combatAbility:0,combatMovement:0,combatRange:0,seeingRange:20,hearingRange:15,targetLossResponse:0},defensive:{alertness:2,combatAbility:1,combatMovement:1,combatRange:1,seeingRange:60,hearingRange:50,targetLossResponse:2},aggressive:{alertness:3,combatAbility:2,combatMovement:2,combatRange:2,seeingRange:100,hearingRange:80,targetLossResponse:1}};function ve(e){let t=e.toLowerCase(),r=0;for(let n=0;n<t.length;n++)r+=t.charCodeAt(n),r+=r<<10,r^=r>>>6;return r+=r<<3,r^=r>>>11,r+=r<<15,r>>>0}var Re=[{id:"player",name:"Player",color:"#00BFFF",alignment:"player"},{id:"space_wolves",name:"Space Wolves",color:"#5B9BD5",alignment:"loyalist"},{id:"ultramarines",name:"Ultramarines",color:"#0047AB",alignment:"loyalist"},{id:"blood_angels",name:"Blood Angels",color:"#C41E3A",alignment:"loyalist"},{id:"dark_angels",name:"Dark Angels",color:"#013220",alignment:"loyalist"},{id:"imperial_fists",name:"Imperial Fists",color:"#FFD700",alignment:"loyalist"},{id:"black_legion",name:"Black Legion",color:"#1C1C1C",alignment:"chaos"},{id:"world_eaters",name:"World Eaters",color:"#8B0000",alignment:"chaos"},{id:"death_guard",name:"Death Guard",color:"#556B2F",alignment:"chaos"},{id:"thousand_sons",name:"Thousand Sons",color:"#4169E1",alignment:"chaos"},{id:"emperors_children",name:"Emperor's Children",color:"#9932CC",alignment:"chaos"}],np=Object.fromEntries(Re.map(e=>[e.id,e])),op=Re.filter(e=>e.alignment==="loyalist").map(e=>e.id),ap=Re.filter(e=>e.alignment==="chaos").map(e=>e.id),vt={player:ve("PLAYER"),space_wolves:ve("RESPOON_SPACE_WOLVES"),ultramarines:ve("RESPOON_ULTRAMARINES"),blood_angels:ve("RESPOON_BLOOD_ANGELS"),dark_angels:ve("RESPOON_DARK_ANGELS"),imperial_fists:ve("RESPOON_IMPERIAL_FISTS"),black_legion:ve("RESPOON_BLACK_LEGION"),world_eaters:ve("RESPOON_WORLD_EATERS"),death_guard:ve("RESPOON_DEATH_GUARD"),thousand_sons:ve("RESPOON_THOUSAND_SONS"),emperors_children:ve("RESPOON_EMPERORS_CHILDREN")},ip=Object.fromEntries(Object.entries(vt).map(([e,t])=>[t,e])),Br={RESPECT:1,LIKE:2,NEUTRAL:3,DISLIKE:4,HATE:5};function Ol(){let e={};for(let t of Re){e[t.id]={};for(let r of Re)t.id==="player"||r.id==="player"?e[t.id][r.id]=Br.NEUTRAL:t.id===r.id?e[t.id][r.id]=Br.RESPECT:t.alignment===r.alignment?e[t.id][r.id]=Br.LIKE:e[t.id][r.id]=Br.HATE}return e}var Wn=Ol();function Ti(e){return vt[e]}var Si=[{boneId:0,name:"SKEL_ROOT",label:"Root",category:"root"},{boneId:57597,name:"SKEL_Spine_Root",label:"Spine Root",category:"root"},{boneId:11816,name:"SKEL_Head",label:"Head",category:"head"},{boneId:31086,name:"IK_Head",label:"Head (IK)",category:"head"},{boneId:39317,name:"SKEL_Neck_1",label:"Neck",category:"neck"},{boneId:23553,name:"SKEL_Spine0",label:"Spine 0",category:"torso"},{boneId:24816,name:"SKEL_Spine1",label:"Spine 1",category:"torso"},{boneId:24817,name:"SKEL_Spine2",label:"Spine 2",category:"torso"},{boneId:24818,name:"SKEL_Spine3",label:"Spine 3",category:"torso"},{boneId:65068,name:"SKEL_Pelvis",label:"Pelvis",category:"torso"},{boneId:10706,name:"SKEL_R_Clavicle",label:"Right Clavicle",category:"shoulders"},{boneId:64729,name:"SKEL_L_Clavicle",label:"Left Clavicle",category:"shoulders"},{boneId:40269,name:"SKEL_R_UpperArm",label:"Right Upper Arm",category:"arms"},{boneId:45509,name:"SKEL_L_UpperArm",label:"Left Upper Arm",category:"arms"},{boneId:28252,name:"SKEL_R_Forearm",label:"Right Forearm",category:"arms"},{boneId:61163,name:"SKEL_L_Forearm",label:"Left Forearm",category:"arms"},{boneId:57005,name:"SKEL_R_Hand",label:"Right Hand",category:"hands"},{boneId:18905,name:"SKEL_L_Hand",label:"Left Hand",category:"hands"},{boneId:6286,name:"IK_R_Hand",label:"Right Hand (IK)",category:"hands"},{boneId:36029,name:"IK_L_Hand",label:"Left Hand (IK)",category:"hands"},{boneId:51826,name:"SKEL_R_Thigh",label:"Right Thigh",category:"legs"},{boneId:58271,name:"SKEL_L_Thigh",label:"Left Thigh",category:"legs"},{boneId:36864,name:"SKEL_R_Calf",label:"Right Calf",category:"legs"},{boneId:63931,name:"SKEL_L_Calf",label:"Left Calf",category:"legs"},{boneId:52301,name:"SKEL_R_Foot",label:"Right Foot",category:"feet"},{boneId:14201,name:"SKEL_L_Foot",label:"Left Foot",category:"feet"},{boneId:20781,name:"SKEL_R_Toe0",label:"Right Toe",category:"feet"},{boneId:2108,name:"SKEL_L_Toe0",label:"Left Toe",category:"feet"}],wi=[{boneName:"chassis",label:"Chassis",category:"body"},{boneName:"bumper_f",label:"Front Bumper",category:"body"},{boneName:"bumper_r",label:"Rear Bumper",category:"body"},{boneName:"overhang",label:"Overhang",category:"body"},{boneName:"door_dside_f",label:"Driver Front Door",category:"doors"},{boneName:"door_pside_f",label:"Passenger Front Door",category:"doors"},{boneName:"door_dside_r",label:"Driver Rear Door",category:"doors"},{boneName:"door_pside_r",label:"Passenger Rear Door",category:"doors"},{boneName:"bonnet",label:"Hood",category:"doors"},{boneName:"boot",label:"Trunk",category:"doors"},{boneName:"wheel_lf",label:"Front Left Wheel",category:"wheels"},{boneName:"wheel_rf",label:"Front Right Wheel",category:"wheels"},{boneName:"wheel_lr",label:"Rear Left Wheel",category:"wheels"},{boneName:"wheel_rr",label:"Rear Right Wheel",category:"wheels"},{boneName:"headlight_l",label:"Left Headlight",category:"lights"},{boneName:"headlight_r",label:"Right Headlight",category:"lights"},{boneName:"taillight_l",label:"Left Taillight",category:"lights"},{boneName:"taillight_r",label:"Right Taillight",category:"lights"},{boneName:"exhaust",label:"Exhaust",category:"exhaust"},{boneName:"exhaust_2",label:"Exhaust 2",category:"exhaust"},{boneName:"seat_dside_f",label:"Driver Front Seat",category:"seats"},{boneName:"seat_pside_f",label:"Passenger Front Seat",category:"seats"},{boneName:"seat_dside_r",label:"Driver Rear Seat",category:"seats"},{boneName:"seat_pside_r",label:"Passenger Rear Seat",category:"seats"},{boneName:"neon_l",label:"Left Neon",category:"misc"},{boneName:"neon_r",label:"Right Neon",category:"misc"},{boneName:"neon_f",label:"Front Neon",category:"misc"},{boneName:"neon_b",label:"Rear Neon",category:"misc"}];var Ei={DRIVER:-1,PASSENGER:0,REAR_LEFT:1,REAR_RIGHT:2},zn={NORMAL:786603,IGNORE_LIGHTS:2883621,SOMETIMES_OVERTAKE:5,RUSHED:1074528293,AVOID_TRAFFIC:786468,AVOID_TRAFFIC_EXTREMELY:6};k();var w=m("ExtractVehicle");function Ll(e){w.debug("[Colors] Extracting colors...");let t=GetIsVehiclePrimaryColourCustom(e),r=GetIsVehicleSecondaryColourCustom(e),n=null,o=null;if(t){let[_,c,u]=GetVehicleCustomPrimaryColour(e);n={r:_,g:c,b:u},w.debug(`[Colors] Custom primary: rgb(${_}, ${c}, ${u})`)}if(r){let[_,c,u]=GetVehicleCustomSecondaryColour(e);o={r:_,g:c,b:u},w.debug(`[Colors] Custom secondary: rgb(${_}, ${c}, ${u})`)}let[a,i]=GetVehicleColours(e),[s,l]=GetVehicleExtraColours(e);return w.debug(`[Colors] Indices: primary=${a}, secondary=${i}, pearl=${s}, wheel=${l}`),{primaryColor:n,secondaryColor:o,primaryColorIndex:a,secondaryColorIndex:i,isCustomPrimary:t,isCustomSecondary:r,pearlColor:s,wheelColor:l}}function Bl(e){w.debug("[Mods] Extracting mods...");let t=!!IsToggleModOn(e,18),r=!!IsToggleModOn(e,22),n=!!IsToggleModOn(e,20),o=!!GetVehicleModVariation(e,23),a=null;if(n){let[Er,ii,si]=GetVehicleTyreSmokeColor(e);a={r:Er,g:ii,b:si},w.debug(`[Mods] Tyre smoke color: rgb(${Er}, ${ii}, ${si})`)}let i=GetVehicleMod(e,11),s=GetVehicleMod(e,12),l=GetVehicleMod(e,13),_=GetVehicleMod(e,15),c=GetVehicleMod(e,16);w.debug(`[Mods] Performance: engine=${i}, brakes=${s}, trans=${l}, susp=${_}, armor=${c}`),w.debug(`[Mods] Toggles: turbo=${t}, xenon=${r}, tyreSmoke=${n}`);let u=GetVehicleMod(e,0),b=GetVehicleMod(e,1),v=GetVehicleMod(e,2),C=GetVehicleMod(e,3),R=GetVehicleMod(e,4),M=GetVehicleMod(e,5),f=GetVehicleMod(e,6),Q=GetVehicleMod(e,7),D=GetVehicleMod(e,8),V=GetVehicleMod(e,9),F=GetVehicleMod(e,10),$=GetVehicleMod(e,23),ke=GetVehicleMod(e,24),Ie=GetVehicleMod(e,14),Ne=GetVehicleMod(e,25),pt=GetVehicleMod(e,26),Ze=GetVehicleMod(e,27),Qe=GetVehicleMod(e,28),gt=GetVehicleMod(e,29),Be=GetVehicleMod(e,30),Ge=GetVehicleMod(e,31),He=GetVehicleMod(e,32),yt=GetVehicleMod(e,33),ge=GetVehicleMod(e,34),et=GetVehicleMod(e,35),ht=GetVehicleMod(e,36),Ya=GetVehicleMod(e,37),Xa=GetVehicleMod(e,38),Ja=GetVehicleMod(e,39),Za=GetVehicleMod(e,40),Qa=GetVehicleMod(e,41),ei=GetVehicleMod(e,42),ti=GetVehicleMod(e,43),ri=GetVehicleMod(e,44),ni=GetVehicleMod(e,45),oi=GetVehicleMod(e,46),ai=GetVehicleMod(e,48),hl=[u,b,v,C,R,M,f,Q,D,V,F,i,s,l,_,c,$,ke,Ie,Ne,pt,Ze,Qe,gt,Be,Ge,He,yt,ge,et,ht,Ya,Xa,Ja,Za,Qa,ei,ti,ri,ni,oi,ai].filter(Er=>Er!==-1).length;return w.debug(`[Mods] Total installed: ${hl} mods`),{engine:i,brakes:s,transmission:l,suspension:_,armor:c,turbo:t,xenon:r,tyreSmoke:n,tyreSmokeColor:a,customTires:o,spoiler:u,frontBumper:b,rearBumper:v,sideSkirt:C,exhaust:R,frame:M,grille:f,hood:Q,fender:D,rightFender:V,roof:F,wheels:$,rearWheels:ke,horn:Ie,plateHolder:Ne,vanityPlate:pt,trim:Ze,ornaments:Qe,dashboard:gt,dial:Be,doorSpeaker:Ge,seats:He,steeringWheel:yt,columnShifterLevers:ge,plaques:et,speakers:ht,trunk:Ya,hydraulics:Xa,engineBlock:Ja,airFilter:Za,struts:Qa,archCover:ei,aerials:ti,trim2:ri,tank:ni,windows:oi,livery:ai}}function Gl(e){w.debug("[ModLevelCounts] Extracting available mod counts..."),SetVehicleModKit(e,0);let t={engine:GetNumVehicleMods(e,11),brakes:GetNumVehicleMods(e,12),transmission:GetNumVehicleMods(e,13),suspension:GetNumVehicleMods(e,15),armor:GetNumVehicleMods(e,16),spoiler:GetNumVehicleMods(e,0),frontBumper:GetNumVehicleMods(e,1),rearBumper:GetNumVehicleMods(e,2),sideSkirt:GetNumVehicleMods(e,3),exhaust:GetNumVehicleMods(e,4),frame:GetNumVehicleMods(e,5),grille:GetNumVehicleMods(e,6),hood:GetNumVehicleMods(e,7),fender:GetNumVehicleMods(e,8),rightFender:GetNumVehicleMods(e,9),roof:GetNumVehicleMods(e,10),wheels:GetNumVehicleMods(e,23),rearWheels:GetNumVehicleMods(e,24),horn:GetNumVehicleMods(e,14),plateHolder:GetNumVehicleMods(e,25),vanityPlate:GetNumVehicleMods(e,26),trim:GetNumVehicleMods(e,27),ornaments:GetNumVehicleMods(e,28),dashboard:GetNumVehicleMods(e,29),dial:GetNumVehicleMods(e,30),doorSpeaker:GetNumVehicleMods(e,31),seats:GetNumVehicleMods(e,32),steeringWheel:GetNumVehicleMods(e,33),columnShifterLevers:GetNumVehicleMods(e,34),plaques:GetNumVehicleMods(e,35),speakers:GetNumVehicleMods(e,36),trunk:GetNumVehicleMods(e,37),hydraulics:GetNumVehicleMods(e,38),engineBlock:GetNumVehicleMods(e,39),airFilter:GetNumVehicleMods(e,40),struts:GetNumVehicleMods(e,41),archCover:GetNumVehicleMods(e,42),aerials:GetNumVehicleMods(e,43),trim2:GetNumVehicleMods(e,44),tank:GetNumVehicleMods(e,45),windows:GetNumVehicleMods(e,46),livery:GetNumVehicleMods(e,48)},r=Object.values(t).filter(n=>n>0).length;return w.debug(`[ModLevelCounts] ${r} slots have available mods`),t}function Hl(e){w.debug("[Neon] Extracting neon...");let t=[!!IsVehicleNeonLightEnabled(e,0),!!IsVehicleNeonLightEnabled(e,1),!!IsVehicleNeonLightEnabled(e,2),!!IsVehicleNeonLightEnabled(e,3)],r=t.some(o=>o),n=null;if(r){let[o,a,i]=GetVehicleNeonLightsColour(e);n={r:o,g:a,b:i},w.debug(`[Neon] Enabled [L=${t[0]}, R=${t[1]}, F=${t[2]}, B=${t[3]}], color: rgb(${o}, ${a}, ${i})`)}else w.debug("[Neon] No neon lights enabled");return{neonEnabled:t,neonColor:n}}function Ul(e){w.debug("[Extras] Extracting extras...");let t=[];for(let n=0;n<15;n++)t.push(!!IsVehicleExtraTurnedOn(e,n));let r=t.filter(n=>n).length;return w.debug(`[Extras] ${r} extras enabled`),t}function Gr(e){w.debug("[Doors] Extracting door states using bone detection...");let t=[];for(let o=0;o<=6;o++){let a=vi[o];if(!a||GetEntityBoneIndexByName(e,a)===-1)continue;let s=GetVehicleDoorAngleRatio(e,o),l=!!IsVehicleDoorDamaged(e,o),_=l&&s>=1,c=s>.01;t.push({index:o,isOpen:c,isDamaged:l,isMissing:_,angle:s})}let r=t.filter(o=>o.isDamaged).length,n=t.filter(o=>o.isOpen).length;return w.debug(`[Doors] ${t.length} doors found: ${n} open, ${r} damaged`),t}function Hr(e){w.debug("[Windows] Extracting window states using bone detection...");let t=[],r=[0,1,2,3,6,7];for(let a of r){let i=ki[a];if(!i)continue;let l=GetEntityBoneIndexByName(e,i)!==-1,_=l?!!IsVehicleWindowIntact(e,a):!0;t.push({index:a,exists:l,isIntact:_})}let n=t.filter(a=>a.exists),o=n.filter(a=>!a.isIntact).length;return w.debug(`[Windows] ${n.length} windows exist, ${o} broken`),t}function Wl(e){w.debug("[WheelNames] Extracting wheel mod names..."),SetVehicleModKit(e,0);let t=GetNumVehicleMods(e,23),r=GetNumVehicleMods(e,24),n=[],o=[];for(let a=0;a<t;a++){let i=GetModTextLabel(e,23,a),s=i?GetLabelText(i):null;n.push(s&&s!=="NULL"?s:`Wheel ${a+1}`)}for(let a=0;a<r;a++){let i=GetModTextLabel(e,24,a),s=i?GetLabelText(i):null;o.push(s&&s!=="NULL"?s:`Wheel ${a+1}`)}return w.debug(`[WheelNames] Found ${n.length} front, ${o.length} rear wheel names`),{frontWheelNames:n,rearWheelNames:o}}function zl(e){w.debug("[Wheels] Extracting wheel info...");let t=GetVehicleWheelType(e),r=GetVehicleNumberOfWheels(e),n=[],o=[];for(let i=0;i<r;i++)n.push(GetVehicleWheelHealth(e,i)),o.push(!!IsVehicleTyreBurst(e,i,!1));let a=o.filter(i=>i).length;return w.debug(`[Wheels] Type=${t}, ${r} wheels, ${a} burst`),{wheelType:t,wheelCount:r,tyreHealth:n,tyreBurst:o}}function qn(e){try{let t=GetVehicleClass(e),r=Hn[t]??"Unknown",n=GetIsVehicleEngineRunning(e),o=GetVehicleDoorLockStatus(e);return{class:t,className:r,health:GetEntityHealth(e),engineHealth:GetVehicleEngineHealth(e),bodyHealth:GetVehicleBodyHealth(e),isEngineRunning:n,doorCount:GetNumberOfVehicleDoors(e),hitBoneIndex:null,hitBoneName:null,primaryColor:null,secondaryColor:null,primaryColorIndex:0,secondaryColorIndex:0,isCustomPrimary:!1,isCustomSecondary:!1,pearlColor:0,wheelColor:0,mods:{...Ar},modLevelCounts:{...Ir},neonEnabled:[!1,!1,!1,!1],neonColor:null,extras:[],livery:-1,livery2:-1,roofLivery:-1,liveryCount:0,traditionalLiveryCount:0,modLiveryCount:0,wheelType:0,wheelCount:0,tyreHealth:[],tyreBurst:[],doorStates:[],windowStates:[],plateText:"",plateStyle:0,windowTint:-1,dirtLevel:0,enveffScale:0,lockStatus:o,roofState:null,isConvertible:!1,fuelLevel:0,xenonColor:-1,configFlags:{flags:{}},locked:o!==1,engineOn:n,tyreSmokeColor:null}}catch{return null}}function ql(e){w.debug("[Config] Extracting all 204 config flags...");let t={};for(let n=0;n<204;n++)t[n]=!!GetVehicleHasFlag(e,n);let r=Object.values(t).filter(Boolean).length;return w.debug(`[Config] ${r}/204 flags active`),{flags:t}}function jn(e){try{w.debug("Starting comprehensive vehicle extraction");let t=GetVehicleClass(e),r=Hn[t]??"Unknown",n=GetEntityHealth(e),o=GetVehicleEngineHealth(e),a=GetVehicleBodyHealth(e),i=GetIsVehicleEngineRunning(e),s=GetNumberOfVehicleDoors(e);w.debug(`Class: ${r} (${t}), Health: ${n}, Engine: ${o}, Body: ${a}`);let l=Ll(e),_=Bl(e),c=Gl(e),u=Hl(e),b=Ul(e),v=GetVehicleLivery(e),C=Math.max(0,GetVehicleLiveryCount(e)),R=GetVehicleMod(e,48),M=Math.max(0,GetNumVehicleMods(e,48)),f=C+M,Q=-1;v>=0&&v<C?Q=v:R>=0&&R<M&&(Q=C+R);let D=-1,V=-1;w.debug(`[Livery] livery=${Q}, total=${f} (traditional=${C}, mod=${M})`);let F=zl(e),$=Wl(e),ke=Gr(e),Ie=Hr(e),Ne=GetVehicleNumberPlateText(e),pt=GetVehicleNumberPlateTextIndex(e),Ze=GetVehicleWindowTint(e),Qe=GetVehicleDirtLevel(e),gt=GetVehicleEnveffScale(e),Be=GetVehicleDoorLockStatus(e),Ge=IsVehicleAConvertible(e,!1),He=Ge?GetConvertibleRoofState(e):null,yt=GetVehicleFuelLevel(e),ge=_.xenon?GetVehicleXenonLightsColor(e):-1;w.debug(`[Misc] Plate: "${Ne}" (style=${pt}), Tint=${Ze}, Dirt=${Qe.toFixed(2)}`),w.debug(`[Misc] Lock=${Be}, Convertible=${Ge}, RoofState=${He}`),w.debug(`[Misc] Fuel: ${yt.toFixed(1)}%, Xenon Color: ${ge}${_.xenon?"":" (no xenon installed)"}`);let et=ql(e);return w.debug("Vehicle extraction complete"),{class:t,className:r,health:n,engineHealth:o,bodyHealth:a,isEngineRunning:i,doorCount:s,hitBoneIndex:null,hitBoneName:null,primaryColor:l.primaryColor,secondaryColor:l.secondaryColor,primaryColorIndex:l.primaryColorIndex,secondaryColorIndex:l.secondaryColorIndex,isCustomPrimary:l.isCustomPrimary,isCustomSecondary:l.isCustomSecondary,pearlColor:l.pearlColor,wheelColor:l.wheelColor,mods:_,modLevelCounts:c,neonEnabled:u.neonEnabled,neonColor:u.neonColor,extras:b,livery:Q,livery2:D,roofLivery:V,liveryCount:f,traditionalLiveryCount:C,modLiveryCount:M,wheelType:F.wheelType,wheelCount:F.wheelCount,tyreHealth:F.tyreHealth,tyreBurst:F.tyreBurst,wheelModNames:{front:$.frontWheelNames,rear:$.rearWheelNames},doorStates:ke,windowStates:Ie,plateText:Ne,plateStyle:pt,windowTint:Ze,dirtLevel:Qe,enveffScale:gt,lockStatus:Be,roofState:He,isConvertible:Ge,fuelLevel:yt,xenonColor:ge,configFlags:et,locked:Be!==1,engineOn:i,tyreSmokeColor:_.tyreSmokeColor}}catch(t){return w.error("Error extracting vehicle info",{},t),null}}k();var P=m("ExtractPed");function jl(e){P.debug("[Drawables] Extracting 12 components...");let t=[];for(let n=0;n<12;n++){let o=GetPedDrawableVariation(e,n),a=GetPedTextureVariation(e,n),i=GetPedPaletteVariation(e,n);t.push({componentId:n,componentName:Ci(n),drawableId:o,textureId:a,paletteId:i})}let r=t.filter(n=>n.drawableId!==0||n.textureId!==0).length;return P.debug(`[Drawables] ${r} components with non-default values`),t}function $l(e){P.debug("[Props] Extracting props (0, 1, 2, 6, 7)...");let t=[0,1,2,6,7],r=[];for(let o of t){let a=GetPedPropIndex(e,o),i=GetPedPropTextureIndex(e,o);r.push({propId:o,propName:xi(o),drawableId:a,textureId:i})}let n=r.filter(o=>o.drawableId!==-1).length;return P.debug(`[Props] ${n} props worn`),r}function Kl(e){P.debug("[HeadBlend] Extracting head blend data...");try{let t=GetPedHeadBlendData(e),[r,n,o,a,i,s,l,_,c,u]=t;return r?(P.debug(`[HeadBlend] Shape: ${n}/${o}/${a}, Skin: ${i}/${s}/${l}`),P.debug(`[HeadBlend] Mixes: shape=${_?.toFixed(2)}, skin=${c?.toFixed(2)}, third=${u?.toFixed(2)}`),{shapeFirst:n??0,shapeSecond:o??0,shapeThird:a??0,skinFirst:i??0,skinSecond:s??0,skinThird:l??0,shapeMix:_??0,skinMix:c??0,thirdMix:u??0}):(P.debug("[HeadBlend] No head blend data (not an MP ped)"),null)}catch{return P.debug("[HeadBlend] Failed to get head blend data"),null}}function Yl(e){P.debug("[FaceFeatures] Extracting 20 face features...");try{let t=[];for(let n=0;n<20;n++){let o=GetPedFaceFeature(e,n);t.push(o)}let r=t.filter(n=>Math.abs(n)>.01).length;return P.debug(`[FaceFeatures] ${r} features with non-zero values`),t}catch{return P.debug("[FaceFeatures] Failed to extract (non-MP ped)"),[]}}function Xl(e){P.debug("[HairColors] Extracting hair colors...");try{let t=GetPedHairColor(e),r=GetPedHairHighlightColor(e);return P.debug(`[HairColors] Primary: ${t}, Highlight: ${r}`),{hairColor:t,hairHighlight:r}}catch{return P.debug("[HairColors] Failed to extract (non-MP ped)"),{hairColor:0,hairHighlight:0}}}function Jl(e){P.debug("[EyeColor] Extracting eye color...");try{let t=GetPedEyeColor(e);return P.debug(`[EyeColor] Eye color: ${t}`),t}catch{return P.debug("[EyeColor] Failed to extract (non-MP ped)"),0}}var Zl=new Set([1,2,10]);function Ql(e,t,r){P.debug("[HeadOverlays] Extracting 13 overlay slots...");try{let n=[];for(let a=0;a<13;a++){let i=GetPedHeadOverlayValue(e,a),s=Zl.has(a),l=s?1:0,_=s?t:0,c=s?r:0;n.push({overlayId:a,index:i,opacity:i===255?0:1,colorType:l,firstColor:_,secondColor:c})}let o=n.filter(a=>a.index!==255).length;return P.debug(`[HeadOverlays] ${o} overlays with non-default values`),n}catch{return P.debug("[HeadOverlays] Failed to extract (non-MP ped)"),[]}}function $n(e){P.debug("[Config] Extracting all 462 config flags...");let t={};for(let n=0;n<462;n++)t[n]=!!GetPedConfigFlag(e,n,!0);let r=Object.values(t).filter(Boolean).length;return P.debug(`[Config] ${r}/462 flags active`),{flags:t}}function Kn(e){P.debug("[Animation] Extracting animation state...");let t=2166240316,r=null,n=null;try{let V=Citizen.invokeNative("0x84FE084",e,Citizen.resultAsInteger());V&&V!==0&&V!==t&&(r=V,n=`0x${(V>>>0).toString(16).toUpperCase()}`)}catch{r=null}let o=null,a=null,i=!1,s=null;try{let F=Citizen.invokeNative("0x44B0E5E2",e,Citizen.resultAsInteger());F!=null&&F!==3&&(o=F)}catch{}try{if(r&&r!==0){let V=Citizen.invokeNative("0x77F1BEB8B2D4ADA8",e,r,Citizen.resultAsInteger());V!=null&&(a=V)}}catch{}i=!!GetPedConfigFlag(e,17,!0);let l=[];try{for(let[V,F]of Object.entries(Un)){let $=parseInt(V,10);Citizen.invokeNative("0xB0760331C7AA4155",e,$,Citizen.resultAsInteger())&&(l.push({index:$,name:F.name,displayName:F.displayName,category:F.category}),s===null&&(s=$))}l.sort((V,F)=>V.index-F.index)}catch{}let _=!!IsPedActiveInScenario(e),c=null,u=!!IsPedSprinting(e),b=!!IsPedRunning(e),v=!!IsPedWalking(e),C=!!IsPedStill(e),R=!!IsEntityPlayingAnim(e,"","",3),M=null,f=null,Q=null,D="still";return u?D="sprinting":b?D="running":v&&(D="walking"),P.debug(`[Animation] Task: ${n??"none"}, Stage: ${o}, Active: ${l.length}, Scenario: ${_}, Moving: ${D}`),{taskHash:r!==0?r:null,taskName:n,isInScenario:_,movementClipset:c,isSprinting:u,isRunning:b,isWalking:v,isStill:C,isPlayingAnim:R,animDict:M,animName:f,animTime:Q,taskStage:o,taskStatus:a,blockingEvents:i,specificTaskType:s,activeTasks:l}}function Yn(e){try{let t=!!IsPedAPlayer(e),r=null;return t&&(r=NetworkGetPlayerIndexFromPed(e)),{health:GetEntityHealth(e),maxHealth:GetEntityMaxHealth(e),armour:GetPedArmour(e),isDead:!!IsPedDeadOrDying(e,!0),isPlayer:t,playerId:r,hitBoneIndex:null,hitBoneName:null,drawables:[],props:[],headBlend:null,faceFeatures:[],hairColor:0,hairHighlight:0,eyeColor:0,headOverlays:[],isInVehicle:!1,vehicleHandle:null,vehicleSeat:null,isOnFoot:!0,isSwimming:!1,isFalling:!1,isClimbing:!1,isRagdoll:!1,isShooting:!1,isAiming:!1,currentWeapon:null,relationshipGroup:0,combatMovement:0,combatRange:0,combatAbility:0,alertness:0,accuracy:0,configFlags:{flags:{}},animationState:{taskHash:null,taskName:null,isInScenario:!1,movementClipset:null,isSprinting:!1,isRunning:!1,isWalking:!1,isStill:!0,isPlayingAnim:!1,animDict:null,animName:null,animTime:null,taskStage:null,taskStatus:null,blockingEvents:!1,specificTaskType:null,activeTasks:[]},animation:null,weaponHash:null,blockEvents:!1,taskState:null,faction:null}}catch{return null}}function nr(e){try{P.debug("Starting comprehensive ped extraction");let t=GetEntityHealth(e),r=GetEntityMaxHealth(e),n=GetPedArmour(e),o=!!IsPedDeadOrDying(e,!0),a=!!IsPedAPlayer(e),i=a?NetworkGetPlayerIndexFromPed(e):null;P.debug(`Health: ${t}/${r}, Armour: ${n}, isDead: ${o}`);let s=jl(e),l=$l(e);P.debug(`[Appearance] ${s.length} drawables, ${l.length} props`);let _=Kl(e),c=Yl(e),{hairColor:u,hairHighlight:b}=Xl(e),v=Jl(e),C=Ql(e,u,b),R=!!IsPedInAnyVehicle(e,!1),M=null,f=null;if(R&&(M=GetVehiclePedIsIn(e,!1),M&&M!==0)){let et=GetVehicleMaxNumberOfPassengers(M);if(GetPedInVehicleSeat(M,-1)===e)f=-1;else for(let ht=0;ht<et;ht++)if(GetPedInVehicleSeat(M,ht)===e){f=ht;break}}let Q=!!IsPedOnFoot(e),D=!!IsPedSwimming(e),V=!!IsPedFalling(e),F=!!IsPedClimbing(e),$=!!IsPedRagdoll(e),ke=!!IsPedShooting(e),Ie=a?!!IsPlayerFreeAiming(i):!!IsPedAimingFromCover(e),Ne=GetSelectedPedWeapon(e);P.debug(`[State] In vehicle: ${R}, On foot: ${Q}, Weapon: 0x${Ne.toString(16).toUpperCase()}`);let pt=GetPedRelationshipGroupHash(e),Ze=GetPedCombatMovement(e),Qe=GetPedCombatRange(e),gt=1,Be=GetPedAlertness(e),Ge=GetPedAccuracy(e);P.debug(`[Behavior] Alertness: ${Be}, Combat: ${Ze}/${Qe}/${gt}, Accuracy: ${Ge}`);let He=$n(e),yt=Object.entries(He.flags).filter(([,et])=>et).length;P.debug(`[Config] Active flags: ${yt}/${Object.keys(He.flags).length}`);let ge=Kn(e);return P.debug("Ped extraction complete"),{health:t,maxHealth:r,armour:n,isDead:o,isPlayer:a,playerId:i,hitBoneIndex:null,hitBoneName:null,drawables:s,props:l,headBlend:_,faceFeatures:c,hairColor:u,hairHighlight:b,eyeColor:v,headOverlays:C,isInVehicle:R,vehicleHandle:M,vehicleSeat:f,isOnFoot:Q,isSwimming:D,isFalling:V,isClimbing:F,isRagdoll:$,isShooting:ke,isAiming:Ie,currentWeapon:Ne,relationshipGroup:pt,combatMovement:Ze,combatRange:Qe,combatAbility:gt,alertness:Be,accuracy:Ge,configFlags:He,animationState:ge,animation:ge.animDict&&ge.animName?{dict:ge.animDict,name:ge.animName,flags:0,blendIn:1,blendOut:1}:null,weaponHash:null,blockEvents:ge.blockingEvents,taskState:null,faction:null}}catch(t){return P.error("Error extracting ped info",{},t),null}}k();var or=m("ExtractObject");function Xn(e){try{or.debug("Starting comprehensive object extraction");let t=null;try{let i=GetObjectTextureVariation(e);t=i>=0?i:null}catch{t=null}let r=!!IsEntityPositionFrozen(e),n=!1;try{n=!!HasObjectBeenBroken(e)}catch{n=!1}let o=GetEntityAlpha(e),a=!!GetEntityCollisionDisabled(e);return or.debug(`Texture variation: ${t??"N/A"}, Frozen: ${r}, Broken: ${n}`),or.debug(`Alpha: ${o}, Collision Disabled: ${a}`),or.debug("Object extraction complete"),{textureVariation:t,isFrozen:r,hasBeenBroken:n,alpha:o,collisionDisabled:a}}catch(t){return or.error("Error extracting object info",{},t),null}}var Jn=m("Extract");function Pi(e){if(!DoesEntityExist(e))return null;try{let t=GetEntityType(e);if(t===0)return null;let r=GetEntityModel(e);if(r===0)return null;let n=GetEntityArchetypeName(e)||null,o=GetEntityCoords(e,!1),a=GetEntityRotation(e,2),i=NetworkGetEntityIsNetworked(e),s=i?NetworkGetNetworkIdFromEntity(e):null,l=i?NetworkGetEntityOwner(e):null,_=GetEntityPopulationType(e),c=null;try{c=Entity(e).state.ct_uuid??null}catch{}let u={handle:e,entityType:t,entityTypeName:Rr[t]??"unknown",model:r,modelName:n,position:Ue(o),rotation:Ue(a),isNetworked:i,networkId:s,ownerId:l,isMissionEntity:IsEntityAMissionEntity(e),populationType:_,populationTypeName:Mr[_]??"unknown",managedUuid:c};return t===2?u.vehicleInfo=qn(e)??void 0:t===1&&(u.pedInfo=Yn(e)??void 0),u}catch(t){return Jn.error("Error extracting entity",{handle:e},t),null}}function Ur(e){if(!DoesEntityExist(e))return null;try{let t=GetEntityType(e);if(t===0)return null;let r=GetEntityModel(e);if(r===0)return null;let n=GetEntityArchetypeName(e)||null,o=GetEntityCoords(e,!1),a=GetEntityRotation(e,2),i=NetworkGetEntityIsNetworked(e),s=i?NetworkGetNetworkIdFromEntity(e):null,l=i?NetworkGetEntityOwner(e):null,_=GetEntityPopulationType(e),c=null;try{c=Entity(e).state.ct_uuid??null}catch{}let u={handle:e,entityType:t,entityTypeName:Rr[t]??"unknown",model:r,modelName:n,position:Ue(o),rotation:Ue(a),isNetworked:i,networkId:s,ownerId:l,isMissionEntity:IsEntityAMissionEntity(e),populationType:_,populationTypeName:Mr[_]??"unknown",managedUuid:c};return t===2?u.vehicleInfo=jn(e)??void 0:t===1?u.pedInfo=nr(e)??void 0:t===3&&(u.objectInfo=Xn(e)??void 0),Jn.debug("Extracted comprehensive data",{entityType:u.entityTypeName,handle:e}),u}catch(t){return Jn.error("Error extracting comprehensive entity",{handle:e},t),null}}k();k();var it=m("DeferredStateBags"),X=new Map,Ai=new Map;function Ii(e,t){X.set(e,t)}function Ni(e,t){Ai.set(e,t)}var Ct=new Map;function Ri(e,t){Ct.set(e,t),it.debug("Queued pending attachment",{childHandle:e,parentUuid:t.parentUuid})}function eo(e){Ct.delete(e)&&it.debug("Removed pending attachment",{childHandle:e})}function Mi(){Ct.size>0&&(it.debug("Clearing pending attachments",{count:Ct.size}),Ct.clear())}function Di(e,t){let r=X.get("attachment");if(r){for(let[n,o]of Ct)if(o.parentUuid===e){it.info("Processing deferred attachment \u2014 parent now available",{childHandle:n,parentUuid:e,parentHandle:t});try{r(n,o)}catch(a){it.error("Failed to process deferred attachment",{childHandle:n,parentUuid:e},a),Ct.delete(n)}}}}function Vi(e){if(!e||!DoesEntityExist(e))return;let t=GetEntityType(e),r=Entity(e).state;if(t===2){let o=r.ct_doorStates;if(o&&Array.isArray(o)&&o.length>0){let i=X.get("doorStates");i&&i(e,o)}let a=r.ct_windowStates;if(a&&Array.isArray(a)&&a.length>0){let i=X.get("windowStates");i&&i(e,a)}}if(t===1){let o=r.ct_faction;if(o){let f=X.get("faction");f&&f(e,o)}let a=r.ct_weaponHash;if(a!=null){let f=X.get("weaponHash");f&&f(e,a)}let i=r.ct_blockEvents;if(i!==void 0){let f=X.get("blockEvents");f&&f(e,i)}let s=r.ct_behavior;if(s){let f=X.get("behavior");f&&f(e,s)}let l=r.ct_configFlags;if(l){let f=X.get("configFlags");f&&f(e,l)}let _=r.ct_drawables;if(_&&Array.isArray(_)){let f=X.get("drawables");f&&f(e,_)}let c=r.ct_props;if(c&&Array.isArray(c)){let f=X.get("props");f&&f(e,c)}let u=r.ct_headBlend;if(u){let f=X.get("headBlend");f&&f(e,u)}let b=r.ct_faceFeatures;if(b&&Array.isArray(b)){let f=X.get("faceFeatures");f&&f(e,b)}let v=r.ct_hairColor;if(v&&Array.isArray(v)){let f=X.get("hairColor");f&&f(e,v)}let C=r.ct_eyeColor;if(C!=null){let f=X.get("eyeColor");f&&f(e,C)}let R=r.ct_headOverlays;if(R&&Array.isArray(R)){let f=X.get("headOverlays");f&&f(e,R)}let M=r.ct_taskState;if(M&&M.status==="running"&&M.sequence&&NetworkHasControlOfEntity(e)){it.debug("Resuming task execution after stream-in",{handle:e});let f=Ai.get("taskState");f&&f(e,M)}}let n=r.ct_attachment;if(n)if(!ft(n))it.warn("Invalid deferred attachment data, skipping",{handle:e,attachment:n});else{let o=X.get("attachment");o&&(it.info("Applying deferred attachment",{handle:e,parentUuid:n.parentUuid}),o(e,n))}}var Zn=null,Qn=null,ar=null;function Fi(e){Zn=e}function Oi(e){Qn=e}function Li(e){ar=e}function Wr(e){if(!Zn||!ar)return;let t=e.replace("entity:",""),r=parseInt(t,10);if(isNaN(r))return;let n=ar(r);n&&Zn(n)}function Bi(e){if(!Qn||!ar)return;let t=e.replace("entity:",""),r=parseInt(t,10);if(isNaN(r))return;let n=ar(r);n&&Qn(n)}var Me=m("EntityCache"),Ce=new Map,ir=new Map,to=null,Gi=null;function ec(){return{handle:null,networkId:null,isSpawned:!1,isSelected:!1,pendingUpdate:null,lockedBy:null,isOwner:!1,ownerId:null,isRequestingControl:!1}}function tc(e,t){return{...e,...ec(),networkId:t,lockedBy:e.lockedBy??null}}function zr(e,t){let r=Ce.get(e.uuid);return r?(Object.assign(r,e),t!==null&&(r.networkId=t,ir.set(t,e.uuid)),e.lockedBy!==void 0&&(r.lockedBy=e.lockedBy)):(r=tc(e,t),Ce.set(e.uuid,r),t!==null&&ir.set(t,e.uuid)),Me.debug("Entity set",{type:e.type,model:e.model,uuid:e.uuid,networkId:t}),r}function E(e){return Ce.get(e)}function ro(e){let t=ir.get(e);return t?Ce.get(t):void 0}function no(e){let t=Ce.get(e);return t?(t.networkId!==null&&ir.delete(t.networkId),Ce.delete(e),Me.debug("Entity removed",{uuid:e}),!0):!1}function oo(){return Array.from(Ce.values())}function Ht(){Ce.clear(),ir.clear(),Mi(),Me.debug("All entities cleared")}function sr(e,t){let r=Ce.get(e);return r?(r.handle=t,r.isSpawned=t!==0&&DoesEntityExist(t),Me.debug("Handle updated",{uuid:e,handle:t,isSpawned:r.isSpawned?1:0}),r.isSpawned&&(Vi(t),Di(r.uuid,t)),!0):!1}function ao(e,t){let r=Ce.get(e);r&&(r.lockedBy=t,Me.debug("Lock updated",{uuid:e,lockedBy:t}))}function qr(e){to=e,Me.debug("Room set",{roomName:e?.name??null,roomUuid:e?.uuid??null})}function st(){return to}function io(e){Gi=e}function lr(){return Gi}function jr(e){Ht();for(let t of e)zr(t,t.networkId);Me.debug("Synced entities from server",{count:e.length})}function rc(){let e=0;for(let t of Ce.values())t.handle&&DoesEntityExist(t.handle)&&(Me.debug("Deleting entity",{uuid:t.uuid,handle:t.handle,model:t.model}),DeleteEntity(t.handle),e++);return Me.debug("Deleted game entities",{count:e}),e}function so(){rc(),Ht(),to=null,Me.debug("Client state reset")}k();var lt=m("ParticleCache"),De=new Map;function nc(){return{handle:null,isSpawned:!1}}function oc(e,t){return{...e,...nc(),handle:t,isSpawned:t!==null}}function lo(e,t){let r=De.get(e.uuid);return r?(Object.assign(r,e),t!==null&&(r.handle=t,r.isSpawned=!0)):(r=oc(e,t),De.set(e.uuid,r)),lt.debug("Particle set",{uuid:e.uuid,effect:`${e.dictionary}/${e.effect}`,handle:t}),r}function Ve(e){return De.get(e)}function Hi(e){return De.get(e)?(De.delete(e),lt.debug("Particle removed",{uuid:e}),!0):!1}function Ui(){return Array.from(De.values())}function Wi(){De.clear(),lt.debug("All particles cleared")}function co(e,t){let r=De.get(e);return r?(r.handle=t,r.isSpawned=!0,!0):!1}function zi(e,t){let r=De.get(e);r&&(r.isSpawned=t,t||(r.handle=null))}function qi(e){Wi();for(let t of e)lo(t,null);lt.debug("Synced particles from server",{count:e.length})}function _o(){let e=0,t=new Set;for(let r of De.values())t.add(r.dictionary),r.handle!==null&&(lt.debug("Stopping particle",{uuid:r.uuid,handle:r.handle,effect:`${r.dictionary}/${r.effect}`}),StopParticleFxLooped(r.handle,!1),e++);for(let r of t)RemoveNamedPtfxAsset(r),lt.debug("Released PTFX asset",{dictionary:r});return lt.debug("Stopped particle effects",{count:e,releasedAssets:t.size}),e}function ji(){_o(),Wi(),lt.debug("Particle state reset")}k();k();var $i=5e3,ac=50,uo=10,ic=100,xt=m("Network"),mo=e=>new Promise(t=>setTimeout(t,e));async function $r(e,t=$i){let r=GetGameTimer();for(;GetGameTimer()-r<t;){if(NetworkDoesEntityExistWithNetworkId(e)){let n=NetworkGetEntityFromNetworkId(e);if(n!==0&&DoesEntityExist(n))return xt.debug("Entity resolved",{networkId:e,handle:n,elapsedMs:GetGameTimer()-r}),n}await mo(ac)}return xt.debug("Entity resolution timeout",{networkId:e,timeout:t}),0}async function Kr(e,t,r=$i){let n=[],o=e.length;xt.debug("Starting batch resolution",{total:o});for(let i=0;i<e.length;i+=uo){let s=e.slice(i,i+uo),l=await Promise.all(s.map(async c=>{let u=await $r(c,r);return{networkId:c,handle:u,success:u!==0}}));n.push(...l);let _=n.length;t&&t(_,o),xt.debug("Batch progress",{resolved:_,total:o}),i+uo<e.length&&await mo(ic)}let a=n.filter(i=>i.success).length;return xt.debug("Batch resolution complete",{successCount:a,total:o}),n}async function po(e,t=2e3){if(!DoesEntityExist(e))return!1;if(NetworkHasControlOfEntity(e))return!0;NetworkRequestControlOfEntity(e);let r=GetGameTimer();for(;GetGameTimer()-r<t;){if(NetworkHasControlOfEntity(e))return xt.debug("Control granted",{handle:e,elapsedMs:GetGameTimer()-r}),!0;await mo(10)}return xt.warn("Control request timeout",{handle:e}),!1}function ct(e,t){emitNet(`respoon:room:${e}`,t??{})}function O(e,t){emitNet(`respoon:entity:${e}`,t)}var sc=m("Network");function Ki(){emitNet("respoon:room:requestCurrent"),sc.debug("Network module initialized")}k();var St=m("PositionSync"),Yr={updateInterval:16,debug:!1,debugLogInterval:120},cr=!1,Tt=null,Ut=null,go=0,Wt=0;function lc(e,t,r){SendNUIMessage({action:"gizmo:updatePosition",payload:{uuid:e,position:t,rotation:r},timestamp:Date.now()})}function cc(e){if(!DoesEntityExist(e))return null;let t=GetEntityCoords(e,!1),r=GetEntityRotation(e,2);return{position:{x:t[0],y:t[1],z:t[2]},rotation:{x:r[0],y:r[1],z:r[2]}}}function _c(){if(!cr||!Tt)return;let e=Date.now();if(e-go<Yr.updateInterval)return;go=e,Wt++;let t=cc(Tt.handle);if(!t){St.warn("Entity no longer exists, stopping tracking",{uuid:Tt.uuid}),We();return}Yr.debug&&Wt%Yr.debugLogInterval===0&&St.debug("Position update",{updateNumber:Wt,uuid:Tt.uuid,position:{x:t.position.x.toFixed(1),y:t.position.y.toFixed(1),z:t.position.z.toFixed(1)}}),lc(Tt.uuid,t.position,t.rotation)}function yo(e,t){if(cr&&(St.debug("Already active, stopping previous tracking"),We()),!DoesEntityExist(t)){St.warn("Cannot start tracking: entity handle does not exist",{handle:t});return}cr=!0,Tt={uuid:e,handle:t},go=0,Wt=0,St.debug("Starting position tracking",{uuid:e,handle:t}),Ut=setTick(_c),St.debug("Position tracking started",{tickId:Ut,interval:Yr.updateInterval})}function We(){cr&&(cr=!1,Tt=null,Ut!==null&&(clearTick(Ut),St.debug("Position tracking stopped",{tickId:Ut,totalUpdates:Wt}),Ut=null),Wt=0)}k();var ye=m("Subscription"),xe=new Map,zt=null,Xr=!1,Yi={animationState:e=>{if(!DoesEntityExist(e))return null;let t=GetEntityType(e);return t!==1?(ye.warn("animationState subscription on non-ped entity",{handle:e,entityType:t}),null):Kn(e)},configFlags:e=>{if(!DoesEntityExist(e))return null;let t=GetEntityType(e);return t!==1?(ye.warn("configFlags subscription on non-ped entity",{handle:e,entityType:t}),null):$n(e)}};function dc(){if(xe.size===0)return;let e=Date.now(),t=[];for(let[r,n]of xe){let o=Dr[r];if(e-n.lastUpdateTime<o.throttleMs)continue;if(!DoesEntityExist(n.entityHandle)){ye.debug("Entity deleted, removing subscription",{channel:r,handle:n.entityHandle}),t.push(r);continue}let i=Yi[r];if(!i){ye.warn("No extractor for channel",{channel:r});continue}let s=i(n.entityHandle);if(s===null)continue;n.lastUpdateTime=e;let l={channel:r,entityHandle:n.entityHandle,data:s,timestamp:e};SendNUIMessage({action:`subscription:${r}`,payload:l,timestamp:e})}for(let r of t)xe.delete(r);xe.size===0&&ho()}function uc(){Xr||(Xr=!0,zt=setTick(dc),ye.debug("Subscription tick started",{tickId:zt}))}function ho(){Xr&&(Xr=!1,zt!==null&&(clearTick(zt),ye.debug("Subscription tick stopped",{tickId:zt}),zt=null))}function Xi(e){let{channel:t,entityHandle:r,entityUuid:n}=e,o=Dr[t];if(!DoesEntityExist(r))return ye.warn("Cannot subscribe: entity does not exist",{channel:t,handle:r}),!1;let a=GetEntityType(r),i=a===1?"ped":a===2?"vehicle":"object";if(!o.entityTypes.includes(i))return ye.warn("Channel does not support this entity type",{channel:t,entityType:i,supported:o.entityTypes}),!1;if(!Yi[t])return ye.warn("No extractor implemented for channel",{channel:t}),!1;let s={channel:t,entityHandle:r,entityUuid:n,lastUpdateTime:0};return xe.set(t,s),ye.debug("Subscribed to channel",{channel:t,handle:r,uuid:n}),uc(),!0}function Ji(e){xe.has(e)&&(xe.delete(e),ye.debug("Unsubscribed from channel",{channel:e}),xe.size===0&&ho())}function _r(){if(xe.size===0)return;let e=xe.size;xe.clear(),ho(),ye.debug("Unsubscribed from all channels",{count:e})}k();bt();k();var bo=m("BoneMarker"),dr=!1,Zr=null,Qr=null,ko=0,mc=28,fo=.05,Jr={r:0,g:200,b:255,a:200};function pc(){if(!dr||!Qr)return;let e=E(Qr);if(!e||!e.handle||!e.isSpawned)return;let t=e.handle;if(DoesEntityExist(t))try{let[r,n,o]=GetWorldPositionOfEntityBone(t,ko);DrawMarker(mc,r,n,o,0,0,0,0,0,0,fo,fo,fo,Jr.r,Jr.g,Jr.b,Jr.a,!1,!1,2,!1,"","",!1)}catch{}}function Zi(e,t){Qr=e,ko=t,dr?bo.debug("Bone marker updated",{parentUuid:e.substring(0,8),boneIndex:t}):(dr=!0,Zr=setTick(pc),bo.debug("Bone marker started",{parentUuid:e.substring(0,8),boneIndex:t}))}function wt(){dr&&(dr=!1,Qr=null,ko=0,Zr!==null&&(clearTick(Zr),Zr=null),bo.debug("Bone marker hidden"))}var J=m("NUI:Attachment"),ze=null,qe=null;function Qi(){(ze||qe)&&J.debug("Clearing stale attachment drag state"),ze=null,qe=null}function vo(){RegisterNuiCallback("entity:attach",(e,t)=>{let{uuid:r,parentUuid:n}=e;if(!r||!n){J.warn("entity:attach - missing uuid or parentUuid"),t({success:!1,error:"Missing uuid or parentUuid"});return}if(!E(r)){J.warn("entity:attach - child entity not found",{uuid:r}),t({success:!1,error:"Child entity not found"});return}if(!E(n)){J.warn("entity:attach - parent entity not found",{parentUuid:n}),t({success:!1,error:"Parent entity not found"});return}J.info("Attach request",{child:r.substring(0,8),parent:n.substring(0,8)}),O("attach",{uuid:r,parentUuid:n,boneIndex:0,offset:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}),t({success:!0})}),RegisterNuiCallback("entity:detach",(e,t)=>{let{uuid:r}=e;if(!r){J.warn("entity:detach - missing uuid"),t({success:!1,error:"Missing uuid"});return}if(!E(r)){J.warn("entity:detach - entity not found",{uuid:r}),t({success:!1,error:"Entity not found"});return}J.info("Detach request",{uuid:r.substring(0,8)}),O("detach",{uuid:r}),t({success:!0})}),RegisterNuiCallback("entity:updateAttachment",(e,t)=>{let{uuid:r,boneIndex:n,offset:o,rotation:a}=e;if(!r){J.warn("entity:updateAttachment - missing uuid"),t({success:!1,error:"Missing uuid"});return}if(!E(r)){J.warn("entity:updateAttachment - entity not found",{uuid:r}),t({success:!1,error:"Entity not found"});return}J.info("Update attachment request",{uuid:r.substring(0,8),hasBone:n!==void 0,hasOffset:o!==void 0,hasRotation:a!==void 0});let s={uuid:r};n!==void 0&&(s.boneIndex=n),o!==void 0&&(s.offset=o),a!==void 0&&(s.rotation=a),O("updateAttachment",s),t({success:!0})}),RegisterNuiCallback("entity:moveAttachment",(e,t)=>{let{handle:r,parentHandle:n,boneIndex:o,worldPosition:a,worldRotation:i}=e;if(!r||!DoesEntityExist(r)){t({success:!1,error:"Child entity does not exist"});return}if(!n||!DoesEntityExist(n)){t({success:!1,error:"Parent entity does not exist"});return}t({success:!0});let s=GetWorldPositionOfEntityBone(n,o),l=GetEntityBoneRotation(n,o),_={x:s[0],y:s[1],z:s[2]},c={x:l[0],y:l[1],z:l[2]},u=hi(a,_,c),b=fi(i,c);ze=u,qe=b,NetworkAllowRemoteAttachmentModification(n,!0),AttachEntityToEntity(r,n,o,u.x,u.y,u.z,b.x,b.y,b.z,!1,!1,!1,!1,2,!0)}),RegisterNuiCallback("entity:endAttachmentDrag",(e,t)=>{let{uuid:r}=e;if(!r){t({success:!1,error:"Missing uuid"});return}if(!ze||!qe){J.warn("endAttachmentDrag - no dragged offset/rotation stored",{uuid:r.substring(0,8)}),t({success:!1,error:"No drag data"});return}J.info("Persisting attachment drag",{uuid:r.substring(0,8),offset:{x:ze.x.toFixed(3),y:ze.y.toFixed(3),z:ze.z.toFixed(3)},rotation:{x:qe.x.toFixed(1),y:qe.y.toFixed(1),z:qe.z.toFixed(1)}}),O("updateAttachment",{uuid:r,offset:ze,rotation:qe}),ze=null,qe=null,t({success:!0})}),RegisterNuiCallback("bone:showMarker",(e,t)=>{let{parentUuid:r,boneIndex:n}=e;if(!r){J.warn("bone:showMarker - missing parentUuid"),t({success:!1,error:"Missing parentUuid"});return}J.debug("Show bone marker",{parentUuid:r.substring(0,8),boneIndex:n}),Zi(r,n),t({success:!0})}),RegisterNuiCallback("bone:hideMarker",(e,t)=>{J.debug("Hide bone marker"),wt(),t({success:!0})}),J.debug("Attachment callbacks registered")}k();var S=m("Selection"),he={debug:!1,debugHover:!1,marker:{type:2,heightOffset:1.5,scale:{x:.4,y:.4,z:.4},rotationSpeed:2,bobAmplitude:.1,bobSpeed:.05},colors:{selected:{r:0,g:255,b:100,a:200},lockedByOther:{r:255,g:80,b:80,a:200},hovering:{r:100,g:220,b:255,a:180}}},K=null,L=null,se=null,ie=null,Z=null,rn=null,Et=null,Co=null,tn=0,en=!1,qt=null;function nn(){return Co===null&&(Co=GetPlayerServerId(PlayerId())),Co}function Pt(e){if(!e){g("gizmo:setEntity",null),S.debug("Gizmo cleared");return}let t;if(e.handle!==null){let n=GetEntityCoords(e.handle,!1),o=GetEntityRotation(e.handle,2);t={position:{x:n[0],y:n[1],z:n[2]},rotation:{x:o[0],y:o[1],z:o[2]}}}else if(e.transform)t=e.transform;else{S.warn("Cannot send gizmo entity without handle or transform",{uuid:e.uuid});return}let r={uuid:e.uuid,type:e.type,model:e.model,handle:e.handle,transform:t};if(e.handle!==null){let o=E(e.uuid)?.data?.attachment;if(o){let a=E(o.parentUuid);a?.handle&&DoesEntityExist(a.handle)&&(r.attachment={parentHandle:a.handle,boneIndex:o.boneIndex,offset:o.offset,rotation:o.rotation},S.debug("Gizmo payload includes attachment",{parentHandle:a.handle,boneIndex:o.boneIndex}))}}S.debug("Sending gizmo:setEntity",{handle:e.handle,type:e.type,hasAttachment:!!r.attachment,position:{x:t.position.x.toFixed(2),y:t.position.y.toFixed(2),z:t.position.z.toFixed(2)},rotation:{x:t.rotation.x.toFixed(2),y:t.rotation.y.toFixed(2),z:t.rotation.z.toFixed(2)}}),g("gizmo:setEntity",r)}function es(e,t,r){if(!DoesEntityExist(e))return;let n=GetEntityCoords(e,!0),o=Math.sin(tn*he.marker.bobSpeed)*he.marker.bobAmplitude,a=tn*he.marker.rotationSpeed%360,i=n[2]+he.marker.heightOffset+o,s=r?1.2:1;DrawMarker(he.marker.type,n[0],n[1],i,0,0,0,180,0,a,he.marker.scale.x*s,he.marker.scale.y*s,he.marker.scale.z*s,t.r,t.g,t.b,t.a,!1,!1,2,!0,null,null,!1)}function gc(){if(tn++,L!==null&&DoesEntityExist(L)&&es(L,he.colors.selected,!0),Z!==null&&Z!==L&&DoesEntityExist(Z)){let e=he.colors.hovering;if(ie){let t=E(ie);t?.lockedBy&&t.lockedBy!==nn()&&(e=he.colors.lockedByOther)}es(Z,e,!1)}}function ts(){en||(en=!0,tn=0,qt=setTick(()=>{en&&gc()}),S.debug("Render loop started",{tickId:qt}))}function xo(){en=!1,qt!==null?(clearTick(qt),S.debug("Render loop stopped",{tickId:qt}),qt=null):S.debug("Render loop stopped (no tick to clear)")}function To(e){let t=e?.managedUuid??null,r=e?.handle??null;if(!(r===Z&&t===ie))if(ie=t,Z=r,rn=e,r!==null){let n=t?E(t):null;g("selection:hovered",{uuid:t,handle:r,model:e?.model??null,entityType:e?.entityTypeName??null,lockedBy:n?.lockedBy??null,isManaged:t!==null}),he.debugHover&&S.debug("Hover",{handle:r,uuid:t??"UNMANAGED"})}else g("selection:hovered",{uuid:null,handle:null})}function rs(){if(Z===null){_t();return}if(Z===L){S.debug("Already selected",{handle:L,uuid:K??"UNMANAGED"});return}if(ie===null){S.debug("Selecting unmanaged entity",{handle:Z}),L!==null&&_t(),L=Z,K=null;let t=Ur(Z);g("selection:confirmed",{uuid:null,handle:Z,model:GetEntityModel(Z),entityType:yc(GetEntityType(Z)),isManaged:!1,entityInfo:t??rn}),S.debug("Selected unmanaged entity",{handle:Z});return}let e=E(ie);if(e?.lockedBy&&e.lockedBy!==nn()){S.warn("Cannot select: locked by another player",{uuid:ie,lockedBy:e.lockedBy}),g("selection:denied",{uuid:ie,lockedBy:e.lockedBy});return}L!==null&&_t(),Et=ie,g("selection:pending",{uuid:ie}),S.debug("Requesting lock",{uuid:ie}),O("lock",{uuid:ie})}function yc(e){switch(e){case 1:return"ped";case 2:return"vehicle";case 3:return"object";default:return"unknown"}}function ns(e){if(K===e){S.debug("Already selected from hierarchy",{uuid:e});return}let t=E(e);if(t?.lockedBy&&t.lockedBy!==nn()){S.warn("Cannot select from hierarchy: locked by another player",{uuid:e,lockedBy:t.lockedBy}),g("selection:denied",{uuid:e,lockedBy:t.lockedBy});return}L!==null&&_t(),Et=e,g("selection:pending",{uuid:e}),S.debug("Requesting lock from hierarchy",{uuid:e}),O("lock",{uuid:e})}function hc(e,t){K!==null&&K!==e&&_t(),K=e,L=t,Et=null;let r=t?Ur(t):null,n=E(e);g("selection:confirmed",{uuid:e,handle:t,model:t?GetEntityModel(t):null,entityType:n?.type??null,isManaged:!0,entityInfo:r??rn}),t&&n&&(Pt({uuid:e,type:n.type,model:n.model,handle:t}),yo(e,t),S.debug("Started position tracking",{uuid:e})),S.debug("Selected",{uuid:e,handle:t})}function _t(){if(se!==null&&ss(),L===null)return;let e=K,t=L;e!==null&&(S.debug("Releasing lock",{uuid:e}),O("unlock",{uuid:e})),Qi(),K=null,L=null,We(),S.debug("Stopped position tracking"),_r(),Pt(null),g("selection:cleared",{}),S.debug("Deselected",{handle:t,uuid:e??"UNMANAGED"})}function os(){if(L===null)return;let e=K,t=L;K=null,L=null,We(),Pt(null),g("selection:cleared",{}),S.debug("Selection cleared (no unlock)",{handle:t,uuid:e??"UNMANAGED"})}function an(){return{uuid:K,handle:L}}function as(){return se}function is(e){L!==null&&_t(),se!==null&&se!==e&&ss(),se=e;let t=Ve(e);t&&t.transform?(Pt({uuid:e,type:"particle",model:`${t.dictionary}/${t.effect}`,handle:null,transform:{position:t.transform.position,rotation:t.transform.rotation}}),S.debug("Selected particle with gizmo",{uuid:e,effect:`${t.dictionary}/${t.effect}`})):S.warn("Selected particle but no transform in cache",{uuid:e})}function ss(){if(se===null)return;let e=se;S.debug("Releasing particle lock",{uuid:e}),emitNet("respoon:particle:unlock",{uuid:e}),se=null,Pt(null),S.debug("Deselected particle",{uuid:e})}function ls(){if(se===null)return;let e=se;se=null,S.debug("Particle selection cleared (no unlock)",{uuid:e})}async function cs(e,t){let r=t===nn();if(S.debug("Lock confirmed",{uuid:e,lockedBy:t,isOurLock:r}),r&&e===Et){let n=null,o=E(e);o?.handle?n=o.handle:e===ie&&(n=Z),n&&(await po(n)?S.debug("Network control granted",{uuid:e,handle:n}):S.warn("Could not get network control - real-time sync may not work",{uuid:e})),hc(e,n)}else r||e===Et&&(Et=null,g("selection:denied",{uuid:e,lockedBy:t}))}function _s(e){S.debug("Unlock confirmed",{uuid:e}),e===K&&(K=null,L=null,g("selection:cleared",{forced:!0}))}function At(){xo(),We(),_r(),K!==null&&O("unlock",{uuid:K}),se!==null&&emitNet("respoon:particle:unlock",{uuid:se}),Pt(null),K=null,L=null,se=null,ie=null,Z=null,rn=null,Et=null,S.debug("Selection state reset")}function sn(e){if(e!==K||L===null)return;let t=E(e);if(!t){S.warn("Cannot resync gizmo - entity not found",{uuid:e});return}S.debug("Resyncing gizmo for selected entity",{uuid:e}),Pt({uuid:e,type:t.type,model:t.model,handle:L})}function fc(e){if(e!==K||L===null)return;let t=Ur(L);if(!t){S.warn("Cannot refresh entityInfo - extraction failed",{uuid:e,handle:L});return}g("entityInfo:refreshed",{entityInfo:t}),S.debug("Refreshed entityInfo for selected entity",{uuid:e.substring(0,8)})}Fi(fc);Oi(sn);Li(e=>ro(e)?.uuid);bt();var ur={maxDistance:1e3,rayFlags:511,nuiUpdateInterval:200,debug:!1},gr=!1,mr=null,us=null,So=0,It=null,wo=null,Eo=null,Po=null,pr=m("Raycaster");function ms(e){SendNUIMessage({action:"raycaster:hit",payload:e,timestamp:Date.now()})}function bc(){let[e,t]=GetNuiCursorPosition(),[r,n]=GetActiveScreenResolution();return{x:e/r,y:t/n}}function ds(){let e=bc(),t=PlayerPedId(),[r,n]=GetWorldCoordFromScreenCoord(e.x,e.y),o={x:r[0],y:r[1],z:r[2]},a={x:r[0]+n[0]*ur.maxDistance,y:r[1]+n[1]*ur.maxDistance,z:r[2]+n[2]*ur.maxDistance};It=StartShapeTestLosProbe(o.x,o.y,o.z,a.x,a.y,a.z,ur.rayFlags,t,4),wo=o,Eo=a,Po=e}function kc(){if(It===null)return null;let[e,t,r,n,o,a]=GetShapeTestResultIncludingMaterial(It);if(e===1)return null;let i=wo,s=Eo,l=Po;if(It=null,wo=null,Eo=null,Po=null,e===2){let _=t===!0||t===1,c=a&&a!==0?a:null,u=null;if(_&&r){let b=Ue(r);u=gi(i,b)}return{hit:_,coords:_?Ue(r):null,surfaceNormal:_?Ue(n):null,materialHash:_?o:null,screenCoords:l,rayOrigin:i,rayDestination:s,entity:c?Pi(c):null,distance:u,timestamp:Date.now()}}return{hit:!1,coords:null,surfaceNormal:null,materialHash:null,screenCoords:l,rayOrigin:i,rayDestination:s,entity:null,distance:null,timestamp:Date.now()}}function vc(){if(!gr)return;if(It===null){ds();return}let e=kc();if(e===null)return;us=e;let t=Date.now();t-So>=ur.nuiUpdateInterval&&(So=t,ms(e),To(e.entity)),ds()}function ps(){if(gr){pr.debug("Already active");return}gr=!0,us=null,So=0,It=null,pr.debug("Starting raycaster tick loop..."),mr=setTick(vc),pr.debug("Raycaster started",{tickId:mr})}function gs(){if(!gr){pr.debug("Already stopped");return}gr=!1,It=null,mr!==null&&(clearTick(mr),mr=null),To(null),ms({hit:!1,coords:null,surfaceNormal:null,materialHash:null,screenCoords:{x:.5,y:.5},rayOrigin:{x:0,y:0,z:0},rayDestination:{x:0,y:0,z:0},entity:null,distance:null,timestamp:Date.now()}),pr.debug("Stopped")}k();function Ao(e){return e.complexity==="simple"}function Io(e){return e.complexity==="multi"}function No(e){return e.complexity==="async"}var ys="ct_";function jt(e){return`${ys}${e}`}var Cc={key:"alpha",entityType:"common",valueType:"number",complexity:"simple",label:"Transparency",description:"Entity transparency (0-255, 255 = fully opaque)",nativeCall:"SetEntityAlpha($entity, $value, false)"},xc={key:"visible",entityType:"common",valueType:"boolean",complexity:"simple",label:"Visible",description:"Whether entity is visible",nativeCall:"SetEntityVisible($entity, $value, false)"},Tc={key:"collision",entityType:"common",valueType:"boolean",complexity:"simple",label:"Collision",description:"Whether entity has collision",nativeCall:"SetEntityCollision($entity, $value, true)"},Sc={key:"frozen",entityType:"common",valueType:"boolean",complexity:"multi",label:"Frozen",description:"Whether entity position is frozen",handlerId:"frozen"},wc={key:"invincible",entityType:"common",valueType:"boolean",complexity:"simple",label:"Invincible",description:"Whether entity is invincible to damage",nativeCall:"SetEntityInvincible($entity, $value)"},Ec={key:"lodDistance",entityType:"common",valueType:"number",complexity:"simple",label:"LOD Distance",description:"Level of detail distance (-1 for game default)",nativeCall:"SetEntityLodDist($entity, $value)"},Pc={key:"attachment",entityType:"common",valueType:"nullable",complexity:"multi",label:"Attachment",description:"Attach entity to a parent entity bone with offset",handlerId:"attachment"},ln=[Cc,xc,Tc,Sc,wc,Ec,Pc],Ro=ln.map(e=>e.key);var Ac={key:"primaryColor",entityType:"vehicle",valueType:"rgb",complexity:"multi",label:"Primary Color",description:"Custom primary RGB color",entityTypeCheck:2,handlerId:"primaryColor"},Ic={key:"secondaryColor",entityType:"vehicle",valueType:"rgb",complexity:"multi",label:"Secondary Color",description:"Custom secondary RGB color",entityTypeCheck:2,handlerId:"secondaryColor"},Nc={key:"neonEnabled",entityType:"vehicle",valueType:"array",complexity:"multi",label:"Neon Enabled",description:"Which neon lights are enabled [left, right, front, back]",entityTypeCheck:2,handlerId:"neonEnabled"},Rc={key:"neonColor",entityType:"vehicle",valueType:"rgb",complexity:"multi",label:"Neon Color",description:"Neon light RGB color",entityTypeCheck:2,handlerId:"neonColor"},Mc={key:"tyreSmokeColor",entityType:"vehicle",valueType:"rgb",complexity:"multi",label:"Tyre Smoke Color",description:"Tyre smoke RGB color (requires tyreSmoke mod)",entityTypeCheck:2,handlerId:"tyreSmokeColor"},Dc={key:"pearlColor",entityType:"vehicle",valueType:"number",complexity:"multi",label:"Pearl Color",description:"Pearl/pearlescent color index (applies to metallic paints)",entityTypeCheck:2,handlerId:"pearlColor"},Vc={key:"wheelColor",entityType:"vehicle",valueType:"number",complexity:"multi",label:"Wheel Color",description:"Wheel/rim color index",entityTypeCheck:2,handlerId:"wheelColor"},Fc={key:"windowTint",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Window Tint",description:"Window tint level (0-5)",entityTypeCheck:2,nativeCall:"SetVehicleWindowTint($entity, $value)"},Oc={key:"livery",entityType:"vehicle",valueType:"number",complexity:"multi",label:"Livery",description:"Livery index (-1 for none)",entityTypeCheck:2,handlerId:"livery"},Lc={key:"plateText",entityType:"vehicle",valueType:"string",complexity:"simple",label:"Plate Text",description:"License plate text (max 8 characters)",entityTypeCheck:2,nativeCall:"SetVehicleNumberPlateText($entity, $value)"},Bc={key:"plateStyle",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Plate Style",description:"License plate style index (0-12)",entityTypeCheck:2,nativeCall:"SetVehicleNumberPlateTextIndex($entity, $value)"},Gc={key:"dirtLevel",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Dirt Level",description:"Vehicle dirt/mud level (0 = clean, 15 = max dirty)",entityTypeCheck:2,nativeCall:"SetVehicleDirtLevel($entity, $value)"},Hc={key:"enveffScale",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Paint Fade",description:"Paint weathering (0=pristine, 1=worn). Only works on military vehicles/aircraft.",entityTypeCheck:2,nativeCall:"SetVehicleEnveffScale($entity, $value)"},Uc={key:"engineHealth",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Engine Health",description:"Engine health (-4000 to 1000). Below 0: smoke/fire, below -1000: explosion risk.",entityTypeCheck:2,nativeCall:"SetVehicleEngineHealth($entity, $value + 0.0)"},Wc={key:"bodyHealth",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Body Health",description:"Body health (0-1000). Internal damage tracking value.",entityTypeCheck:2,nativeCall:"SetVehicleBodyHealth($entity, $value + 0.0)"},zc={key:"fuelLevel",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Fuel Level",description:"Fuel level (0-100%)",entityTypeCheck:2,nativeCall:"SetVehicleFuelLevel($entity, $value + 0.0)"},qc={key:"locked",entityType:"vehicle",valueType:"boolean",complexity:"simple",label:"Doors Locked",description:"Whether vehicle doors are locked",entityTypeCheck:2,nativeCall:"SetVehicleDoorsLocked($entity, $value ? 2 : 1)"},jc={key:"engineOn",entityType:"vehicle",valueType:"boolean",complexity:"multi",label:"Engine On",description:"Whether vehicle engine is running",entityTypeCheck:2,handlerId:"engineOn"},$c={key:"mods",entityType:"vehicle",valueType:"object",complexity:"multi",label:"Modifications",description:"Vehicle modifications (performance, visual, interior)",entityTypeCheck:2,handlerId:"mods"},Kc={key:"xenonColor",entityType:"vehicle",valueType:"number",complexity:"simple",label:"Xenon Color",description:"Xenon headlight color (-1 = default, 0-12 = custom colors)",entityTypeCheck:2,nativeCall:"SetVehicleXenonLightsColor($entity, $value)"},Yc={key:"wheelType",entityType:"vehicle",valueType:"number",complexity:"multi",label:"Wheel Type",description:"Wheel category (changes available wheel designs)",entityTypeCheck:2,handlerId:"wheelType"},Xc={key:"repairVehicle",entityType:"vehicle",valueType:"boolean",complexity:"multi",label:"Repair Vehicle",description:"Repair all vehicle damage and restore missing parts",entityTypeCheck:2,handlerId:"repairVehicle",isTransient:!0},Jc={key:"doorCommand",entityType:"vehicle",valueType:"object",complexity:"multi",label:"Door Command",description:"Command to open/close/break/remove a door",entityTypeCheck:2,handlerId:"doorCommand",isTransient:!0},Zc={key:"windowCommand",entityType:"vehicle",valueType:"object",complexity:"multi",label:"Window Command",description:"Command to roll/smash/fix a window",entityTypeCheck:2,handlerId:"windowCommand",isTransient:!0},Qc={key:"doorStates",entityType:"vehicle",valueType:"array",complexity:"multi",label:"Door States",description:"Persistent door states (open/damaged/missing)",entityTypeCheck:2,handlerId:"doorStates"},e_={key:"windowStates",entityType:"vehicle",valueType:"array",complexity:"multi",label:"Window States",description:"Persistent window states (intact/broken)",entityTypeCheck:2,handlerId:"windowStates"},t_={key:"extras",entityType:"vehicle",valueType:"array",complexity:"multi",label:"Extras",description:"Vehicle extras (0-14) - model-specific toggleable parts",entityTypeCheck:2,handlerId:"extras"},cn=[Ac,Ic,Dc,Vc,Nc,Rc,Mc,Fc,Oc,Lc,Bc,Gc,Hc,Uc,Wc,zc,qc,jc,$c,Kc,Yc,Xc,Jc,Zc,Qc,e_,t_],Mo=cn.map(e=>e.key);var r_={key:"animation",entityType:"ped",valueType:"nullable",complexity:"async",label:"Animation",description:"Animation data (dict, name, flags, blend)",entityTypeCheck:1,handlerId:"animation"},n_={key:"taskState",entityType:"ped",valueType:"nullable",complexity:"async",label:"Task State",description:"Current task sequence and execution status",entityTypeCheck:1,handlerId:"taskState"},o_={key:"weaponHash",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Weapon",description:"Assigned weapon for this ped",entityTypeCheck:1,handlerId:"weaponHash"},a_={key:"blockEvents",entityType:"ped",valueType:"boolean",complexity:"multi",label:"Block Events",description:"Block non-temporary events (ignore surroundings)",entityTypeCheck:1,handlerId:"blockEvents"},i_={key:"faction",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Faction",description:"Faction assignment for relationship system",entityTypeCheck:1,handlerId:"faction"},s_={key:"behavior",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Behavior",description:"AI behavior attributes (alertness, combat ability, etc.)",entityTypeCheck:1,handlerId:"behavior"},l_={key:"configFlags",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Config Flags",description:"Ped config flags (Record<number, boolean>)",entityTypeCheck:1,handlerId:"configFlags"},c_={key:"drawables",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Drawables",description:"Ped clothing components (12 slots)",entityTypeCheck:1,handlerId:"drawables"},__={key:"props",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Props",description:"Ped accessories (hats, glasses, etc)",entityTypeCheck:1,handlerId:"props"},d_={key:"headBlend",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Head Blend",description:"Face/skin mixing (freemode peds only)",entityTypeCheck:1,handlerId:"headBlend"},u_={key:"faceFeatures",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Face Features",description:"20 face feature values (freemode peds only)",entityTypeCheck:1,handlerId:"faceFeatures"},m_={key:"hairColor",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Hair Color",description:"Hair color [primary, highlight] (freemode peds only)",entityTypeCheck:1,handlerId:"hairColor"},p_={key:"eyeColor",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Eye Color",description:"Eye color index (freemode peds only)",entityTypeCheck:1,handlerId:"eyeColor"},g_={key:"headOverlays",entityType:"ped",valueType:"nullable",complexity:"multi",label:"Head Overlays",description:"Head overlays - eyebrows, facial hair, makeup, etc. (freemode peds only)",entityTypeCheck:1,handlerId:"headOverlays"},_n=[r_,n_,o_,a_,i_,s_,l_,c_,__,d_,u_,m_,p_,g_],Do=_n.map(e=>e.key);var y_={key:"textureVariation",entityType:"prop",valueType:"number",complexity:"simple",label:"Texture Variation",description:"Select texture variant for objects with multiple textures (0-15)",entityTypeCheck:3,nativeCall:"SetObjectTextureVariation($entity, $value)"},dn=[y_],Vo=dn.map(e=>e.key);var yr=[...ln,...cn,..._n,...dn],h_=[...Ro,...Mo,...Do,...Vo],f_=h_.map(jt),oy=yr.filter(e=>"isTransient"in e&&e.isTransient===!0).map(e=>e.key),ay=new Map(yr.map(e=>[e.key,e]));var b_=["uuid","roomId","createdBy"],k_=b_.map(jt),iy=[...k_,...f_];var Fo={key:"time",valueType:"object",label:"Time of Day",description:"Override the in-game clock for this room",defaultValue:null,handlerId:"time"},Oo={key:"timeLock",valueType:"boolean",label:"Lock Time",description:"Freeze the clock at the current time (prevents time progression)",defaultValue:!1,handlerId:"timeLock"};var Lo={key:"weather",valueType:"string",nullable:!0,label:"Weather",description:"Override the weather for this room",defaultValue:null,handlerId:"weather"};var Bo={key:"windSpeed",valueType:"number",nullable:!0,label:"Wind Speed",description:"Override wind speed (0-12)",defaultValue:null,handlerId:"windSpeed"},Go={key:"windDirection",valueType:"number",nullable:!0,label:"Wind Direction",description:"Override wind direction in radians",defaultValue:null,handlerId:"windDirection"},Ho={key:"rainLevel",valueType:"number",nullable:!0,label:"Rain Level",description:"Override rain intensity (0-1)",defaultValue:null,handlerId:"rainLevel"},Uo={key:"snowLevel",valueType:"number",nullable:!0,label:"Snow Level",description:"Override snow intensity (0-1)",defaultValue:null,handlerId:"snowLevel"};var Wo={key:"cloudHat",valueType:"string",nullable:!0,label:"Cloud Hat",description:"Override cloud type",defaultValue:null,handlerId:"cloudHat"},zo={key:"cloudOpacity",valueType:"number",nullable:!0,label:"Cloud Opacity",description:"Override cloud opacity (0-1)",defaultValue:null,handlerId:"cloudOpacity"};var qo={key:"blackout",valueType:"boolean",label:"Blackout",description:"Disable all artificial lights (streetlights, building lights)",defaultValue:!1,handlerId:"blackout"};var jo={key:"gravity",valueType:"number",nullable:!0,label:"Gravity",description:"Override gravity level (0=Normal, 1=Low, 2=Very Low, 3=Zero)",defaultValue:null,handlerId:"gravity"},$o={key:"forcePedTracks",valueType:"boolean",label:"Ped Footprint Tracks",description:"Force ped footprint tracks on all surfaces",defaultValue:!1,handlerId:"forcePedTracks"},Ko={key:"forceVehicleTrails",valueType:"boolean",label:"Vehicle Trails",description:"Force vehicle tire trails on all surfaces",defaultValue:!1,handlerId:"forceVehicleTrails"};var Yo={key:"waveIntensity",valueType:"number",nullable:!0,label:"Wave Intensity",description:"Override ocean wave intensity",defaultValue:null,handlerId:"waveIntensity"};var Xo={key:"timecycleModifier",valueType:"string",nullable:!0,label:"Timecycle Modifier",description:"Apply a timecycle modifier (visual filter)",defaultValue:null,handlerId:"timecycleModifier"},Jo={key:"timecycleStrength",valueType:"number",nullable:!0,label:"Timecycle Strength",description:"Timecycle modifier strength (0-2)",defaultValue:null,handlerId:"timecycleStrength"};var Zo={key:"vehicleTrafficEnabled",valueType:"boolean",label:"Vehicle Traffic",description:"Enable or disable vehicle traffic (cars, bikes, etc.)",defaultValue:!0,handlerId:"vehicleTrafficEnabled"},Qo={key:"pedPopulationEnabled",valueType:"boolean",label:"Pedestrian Population",description:"Enable or disable pedestrian population (NPCs walking around)",defaultValue:!0,handlerId:"pedPopulationEnabled"};var ea=[Fo,Oo,Lo,Bo,Go,Ho,Uo,Wo,zo,qo,jo,$o,Ko,Yo,Xo,Jo,Zo,Qo],Ry=new Map(ea.map(e=>[e.key,e]));k();var $t={REPEAT:1,STOP_LAST_FRAME:2,UPPERBODY:16,SECONDARY:32,UPPERBODY_COMBINED:48};function hs(e,t=!1){let r=0;switch(e){case"once":r=0;break;case"hold":r=$t.STOP_LAST_FRAME;break;case"loop":r=$t.REPEAT;break;case"timed":r=0;break}return t&&(r|=$t.UPPERBODY_COMBINED),r}var p=m("TaskExecutor"),fe=new Map;function U(e,t){let r=fe.get(e);return!r||r.cancelled||r.version!==t||!DoesEntityExist(e)?!1:IsPedDeadOrDying(e,!1)?(p.info("Task stopped - ped is dead",{entity:e}),!1):!!NetworkHasControlOfEntity(e)}function W(e){return new Promise(t=>setTimeout(t,e))}function ks(e){return Entity(e).state.ct_uuid}function vs(e,t,r,n,o,a){let i=n-e,s=o-t,l=a-r;return Math.sqrt(i*i+s*s+l*l)}function v_(e,t,r){emitNet("respoon:task:stepComplete",{uuid:e,stepIndex:t,version:r})}function C_(e,t,r){emitNet("respoon:task:error",{uuid:e,errorMessage:t,version:r})}async function x_(e,t,r){let{target:n,speed:o,distanceToStop:a,timeout:i}=t;ClearPedTasks(e),FreezeEntityPosition(e,!1),TaskGoToCoordAnyMeans(e,n.x,n.y,n.z,o,0,!1,786603,a),p.debug("GoToCoord started",{entity:e,target:`${n.x.toFixed(1)},${n.y.toFixed(1)},${n.z.toFixed(1)}`,speed:o});let s=Date.now(),l=i??6e4,_=1/0,c=null;for(;U(e,r);){let u=GetEntityCoords(e,!0),b=vs(u[0],u[1],u[2],n.x,n.y,n.z);if(b<=a)return p.debug("GoToCoord arrived",{entity:e,distance:b.toFixed(2)}),!0;if(Date.now()-s>l)return p.warn("GoToCoord timeout",{entity:e,distance:b.toFixed(2),timeout:l}),!0;Math.abs(b-_)<.1?c===null?c=Date.now():Date.now()-c>3e3&&(p.debug("GoToCoord restarting (stuck)",{entity:e,distance:b.toFixed(2)}),TaskGoToCoordAnyMeans(e,n.x,n.y,n.z,o,0,!1,786603,a),c=null):c=null,_=b,await W(200)}return!1}async function T_(e,t,r){let{center:n,radius:o,duration:a}=t;ClearPedTasks(e),FreezeEntityPosition(e,!1),TaskWanderInArea(e,n.x,n.y,n.z,o,0,0);let i=Date.now();for(;U(e,r);){if(Date.now()-i>=a)return ClearPedTasks(e),p.debug("Wander complete",{entity:e,duration:a}),!0;await W(100)}return!1}async function S_(e,t,r){let{duration:n}=t;TaskStandStill(e,n);let o=Date.now();for(;U(e,r);){if(Date.now()-o>=n)return p.debug("Wait complete",{entity:e,duration:n}),!0;await W(100)}return!1}async function w_(e,t,r){let n=t.duration??0;if(p.debug("Idle step started",{entity:e,duration:n===0?"forever":n}),n===0){for(;U(e,r);)await W(500);return p.debug("Idle step ended (execution cancelled)",{entity:e}),!1}let o=Date.now();for(;U(e,r);){if(Date.now()-o>=n)return p.debug("Idle step complete",{entity:e,duration:n}),!0;await W(100)}return!1}function E_(e){return ClearPedTasks(e),p.debug("Tasks cleared",{entity:e}),!0}async function P_(e,t,r){let{duration:n,facingEntityUuid:o}=t;ClearPedTasks(e),FreezeEntityPosition(e,!1);let a=PlayerPedId();if(o){let s=GetGamePool("CPed");for(let l of s)if(Entity(l).state.ct_uuid===o){a=l;break}}TaskHandsUp(e,n,a,-1,!1),p.debug("HandsUp started",{entity:e,duration:n,facingPed:a});let i=Date.now();for(;U(e,r);){if(Date.now()-i>=n)return ClearPedTasks(e),p.debug("HandsUp complete",{entity:e,duration:n}),!0;await W(100)}return!1}async function A_(e,t,r){let{fleeFromEntityUuid:n,duration:o=1e4}=t;ClearPedTasks(e),FreezeEntityPosition(e,!1);let a=PlayerPedId();if(n){let l=GetGamePool("CPed");for(let _ of l)if(Entity(_).state.ct_uuid===n){a=_;break}}TaskReactAndFleePed(e,a),p.debug("Flee started",{entity:e,fleeFromPed:a,duration:o});let i=Date.now(),s=1e3;for(;U(e,r);){let l=Date.now()-i;if(l>=o)return ClearPedTasks(e),p.debug("Flee complete (timeout)",{entity:e}),!0;if(l>s){let _=Citizen.invokeNative("0xB0760331C7AA4155",e,218,Citizen.resultAsInteger()),c=Citizen.invokeNative("0xB0760331C7AA4155",e,445,Citizen.resultAsInteger());if(!_&&!c)return p.debug("Flee complete (stopped fleeing)",{entity:e,elapsed:l}),!0}await W(200)}return!1}async function I_(e,t,r){let{targetEntityUuid:n,duration:o=3e4,flags:a=0}=t;ClearPedTasks(e),FreezeEntityPosition(e,!1);let i=PlayerPedId();if(n){let D=GetGamePool("CPed");for(let V of D)if(Entity(V).state.ct_uuid===n){i=V;break}}let s=ks(e),l=GetPedRelationshipGroupHash(e),_=GetPedRelationshipGroupHash(i),c=Entity(e).state.ct_faction,u=Entity(i).state.ct_faction,b=!!GetPedConfigFlag(e,17,!0);p.info("=== COMBAT DIAGNOSTICS START ===",{entityUuid:s?.substring(0,8),entity:e,targetPed:i,targetUuid:n?.substring(0,8),entityFaction:c,targetFaction:u,entityRelationshipGroup:l,targetRelationshipGroup:_,initialBlockEvents:b,combatFlags:a});let v=!!GetPedConfigFlag(e,17,!0);SetBlockingOfNonTemporaryEvents(e,!0),TaskSetBlockingOfNonTemporaryEvents(e,!0),p.warn("Combat: Forcing blockEvents ON (this may suppress threat detection)",{entity:e,entityUuid:s?.substring(0,8),previousBlockEvents:v,newBlockEvents:!0});let C=()=>{SetBlockingOfNonTemporaryEvents(e,v),TaskSetBlockingOfNonTemporaryEvents(e,v)};TaskCombatPed(e,i,a,16),p.info("Combat: TaskCombatPed called",{entity:e,entityUuid:s?.substring(0,8),targetPed:i,flags:a,threatResponse:16,duration:o});let R=Date.now(),M=1e3,f=0,Q=2e3;for(;U(e,r);){let D=Date.now()-R;if(D-f>=Q){f=D;let V=Citizen.invokeNative("0xB0760331C7AA4155",e,343,Citizen.resultAsInteger()),F=Citizen.invokeNative("0xB0760331C7AA4155",e,218,Citizen.resultAsInteger()),$=Citizen.invokeNative("0xB0760331C7AA4155",e,445,Citizen.resultAsInteger()),ke=GetEntityCoords(e,!0),Ie=GetEntityCoords(i,!0),Ne=Math.sqrt(Math.pow(Ie[0]-ke[0],2)+Math.pow(Ie[1]-ke[1],2)+Math.pow(Ie[2]-ke[2],2));p.info("Combat: Status check",{entity:e,entityUuid:s?.substring(0,8),elapsed:D,isCombat:!!V,isFlee:!!F,isReactFlee:!!$,distanceToTarget:Ne.toFixed(2),blockEventsActive:!0}),(F||$)&&!V&&p.error("Combat: Ped is FLEEING instead of fighting!",{entity:e,entityUuid:s?.substring(0,8),targetPed:i,elapsed:D,isFlee:!!F,isReactFlee:!!$,blockEvents:!0,theory:"blockEvents may be suppressing combat behavior"})}if(D>=o)return C(),ClearPedTasks(e),p.info("Combat complete (timeout)",{entity:e,entityUuid:s?.substring(0,8),elapsed:D}),p.info("=== COMBAT DIAGNOSTICS END (timeout) ==="),!0;if(IsEntityDead(i))return C(),ClearPedTasks(e),p.info("Combat complete (target dead)",{entity:e,entityUuid:s?.substring(0,8),elapsed:D}),p.info("=== COMBAT DIAGNOSTICS END (target dead) ==="),!0;if(D>M&&!Citizen.invokeNative("0xB0760331C7AA4155",e,343,Citizen.resultAsInteger())){C();let F=Citizen.invokeNative("0xB0760331C7AA4155",e,218,Citizen.resultAsInteger()),$=Citizen.invokeNative("0xB0760331C7AA4155",e,445,Citizen.resultAsInteger());return p.warn("Combat complete (no longer in combat)",{entity:e,entityUuid:s?.substring(0,8),elapsed:D,currentlyFleeing:!!(F||$),reason:F||$?"PED_IS_FLEEING":"COMBAT_TASK_ENDED"}),p.info("=== COMBAT DIAGNOSTICS END (task ended) ==="),!0}await W(200)}return C(),p.info("=== COMBAT DIAGNOSTICS END (execution cancelled) ==="),!1}function N_(e,t){let{alertness:r,combatAbility:n,combatMovement:o,combatRange:a,seeingRange:i,hearingRange:s,targetLossResponse:l}=t;return r!==void 0&&SetPedAlertness(e,r),n!==void 0&&SetPedCombatAbility(e,n),o!==void 0&&SetPedCombatMovement(e,o),a!==void 0&&SetPedCombatRange(e,a),i!==void 0&&SetPedSeeingRange(e,i),s!==void 0&&SetPedHearingRange(e,s),l!==void 0&&SetPedTargetLossResponse(e,l),p.debug("SetBehavior applied",{entity:e,alertness:r,combatAbility:n,combatMovement:o,combatRange:a,seeingRange:i,hearingRange:s,targetLossResponse:l}),!0}function R_(e,t){let{groupName:r,targetGroup:n,relationship:o}=t,[a]=AddRelationshipGroup(r),[i]=AddRelationshipGroup(n);return SetRelationshipBetweenGroups(o,a,i),SetPedRelationshipGroupHash(e,a),p.debug("SetRelationship applied",{entity:e,groupName:r,targetGroup:n,relationship:o,groupHash:a,targetGroupHash:i}),!0}function M_(e,t){let{flags:r}=t;for(let[n,o]of Object.entries(r)){let a=parseInt(n,10);SetPedConfigFlag(e,a,o)}return p.debug("SetConfigFlags applied",{entity:e,flagCount:Object.keys(r).length,flags:r}),!0}function D_(e,t){let{value:r}=t;return SetBlockingOfNonTemporaryEvents(e,r),TaskSetBlockingOfNonTemporaryEvents(e,r),p.debug("SetBlockEvents applied",{entity:e,blockEvents:r}),!0}function V_(e){return SetPedAlertness(e,at.alertness),SetPedCombatAbility(e,at.combatAbility),SetPedCombatMovement(e,at.combatMovement),SetPedCombatRange(e,at.combatRange),SetPedSeeingRange(e,at.seeingRange),SetPedHearingRange(e,at.hearingRange),SetPedTargetLossResponse(e,at.targetLossResponse),p.debug("ClearBehavior applied - reset to defaults",{entity:e}),!0}async function F_(e,t,r){let{dictionary:n,name:o,duration:a,flags:i=0,blendIn:s=8,blendOut:l=-8,playbackMode:_,upperBodyOnly:c}=t;if(!n||!o)return p.warn("Animation step skipped - missing dictionary or name",{dictionary:n,name:o,stepId:t.id}),!0;let u=_!==void 0?hs(_,c??!1):i,b=_??(a!==void 0&&a>0?"timed":u&$t.REPEAT?"loop":u&$t.STOP_LAST_FRAME?"hold":"once");ClearPedTasks(e),FreezeEntityPosition(e,!1),RequestAnimDict(n);let v=Date.now(),C=5e3;for(;!HasAnimDictLoaded(n);){if(Date.now()-v>C)return p.warn("Animation dict load timeout",{dictionary:n}),!0;if(!U(e,r))return!1;await W(50)}let R=b==="timed"&&a&&a>0?a:-1;TaskPlayAnim(e,n,o,s,l,R,u,0,!1,!1,!1),RemoveAnimDict(n),p.info("Animation started",{entity:e,dictionary:n,name:o,duration:a,flags:u,mode:b});let M=Date.now();switch(b){case"loop":for(p.info("Animation looping indefinitely",{entity:e,dictionary:n,name:o});U(e,r);)await W(1e3);return p.debug("Animation loop ended (execution cancelled)",{entity:e}),!1;case"hold":return p.debug("Animation step complete (hold)",{entity:e}),!0;case"timed":if(a&&a>0)for(;U(e,r);){if(Date.now()-M>=a)return StopAnimTask(e,n,o,1),p.info("Animation complete (duration)",{entity:e,duration:a}),!0;await W(100)}return!1;case"once":default:{for(;U(e,r);){let D=Date.now()-M;if(D>6e4)return p.warn("Animation timeout (max wait)",{entity:e,elapsed:D}),!0;if(D>500&&!IsEntityPlayingAnim(e,n,o,3))return p.info("Animation complete (finished)",{entity:e,elapsed:D}),!0;await W(100)}return!1}}}async function O_(e,t,r){let{scenarioName:n,position:o,heading:a,duration:i}=t;p.debug("Scenario started",{entity:e,scenarioName:n,position:o,heading:a,duration:i}),ClearPedTasks(e),FreezeEntityPosition(e,!1),SetCurrentPedWeapon(e,GetHashKey("WEAPON_UNARMED"),!0),o?TaskStartScenarioAtPosition(e,n,o.x,o.y,o.z,a??0,0,!1,!0):TaskStartScenarioInPlace(e,n,0,!0);let s=Date.now(),l=i??3e4,_=1e3;for(;U(e,r);){let c=Date.now()-s;if(c>=l)return ClearPedTasks(e),p.debug("Scenario complete (duration)",{entity:e,scenarioName:n,elapsed:c}),!0;if(c>_&&!IsPedUsingScenario(e,n))return p.debug("Scenario complete (ended naturally)",{entity:e,scenarioName:n,elapsed:c}),!0;await W(200)}return ClearPedTasks(e),!1}function L_(e){let t=GetGamePool("CVehicle");for(let r of t)if(Entity(r).state.ct_uuid===e)return r;return null}async function B_(e,t,r){let{targetVehicleUuid:n,seat:o=Ei.DRIVER,speed:a=2,timeout:i=1e4,warp:s=!1}=t,l=L_(n);if(!l||!DoesEntityExist(l))return p.warn("EnterVehicle: target vehicle not found",{targetVehicleUuid:n}),!0;if(FreezeEntityPosition(e,!1),FreezeEntityPosition(l,!1),s){TaskWarpPedIntoVehicle(e,l,o),await W(200);let c=GetVehiclePedIsIn(e,!1);return c&&c===l?p.info("EnterVehicle: warped into vehicle",{entity:e,vehicle:l,seat:o}):p.warn("EnterVehicle: warp may have failed",{entity:e,vehicle:l,currentVeh:c}),!0}ClearPedTasks(e),TaskEnterVehicle(e,l,i,o,a,1,0),p.info("EnterVehicle: started",{entity:e,vehicle:l,seat:o,speed:a,timeout:i});let _=Date.now();for(;U(e,r);){if(!DoesEntityExist(l))return p.warn("EnterVehicle: target vehicle no longer exists",{entity:e}),!0;let c=GetVehiclePedIsIn(e,!1);if(c&&c===l)return p.info("EnterVehicle: ped is seated in target vehicle",{entity:e,vehicle:l}),!0;if(Date.now()-_>i)return p.warn("EnterVehicle: timeout",{entity:e,elapsed:Date.now()-_}),!0;await W(200)}return!1}async function G_(e,t,r){let{warp:n=!1}=t,o=GetVehiclePedIsIn(e,!1);if(!o||o===0)return p.warn("LeaveVehicle: ped not in a vehicle, skipping",{entity:e}),!0;ClearPedTasks(e);let a=n?16:0;TaskLeaveVehicle(e,o,a),p.info("LeaveVehicle: started",{entity:e,vehicle:o,warp:n});let i=Date.now(),s=1e4;for(;U(e,r);){if(!IsPedInAnyVehicle(e,!1))return p.info("LeaveVehicle: ped exited vehicle",{entity:e}),!0;if(Date.now()-i>s)return p.warn("LeaveVehicle: timeout",{entity:e}),!0;await W(200)}return!1}async function H_(e,t,r){let{destination:n,speed:o=15,drivingStyle:a=zn.NORMAL,stopDistance:i=5,timeout:s=6e4}=t,l=GetVehiclePedIsIn(e,!1);if(!l||l===0)return p.warn("DriveToCoord: ped not in a vehicle, skipping",{entity:e}),!0;FreezeEntityPosition(l,!1),TaskVehicleDriveToCoordLongrange(e,l,n.x,n.y,n.z,o,a,i),p.info("DriveToCoord: started",{entity:e,vehicle:l,destination:`${n.x.toFixed(1)},${n.y.toFixed(1)},${n.z.toFixed(1)}`,speed:o,drivingStyle:a});let _=Date.now();for(;U(e,r);){if(!DoesEntityExist(l)||!IsPedInAnyVehicle(e,!1))return p.warn("DriveToCoord: ped no longer in vehicle",{entity:e,vehicle:l}),!0;let c=GetEntityCoords(e,!0),u=vs(c[0],c[1],c[2],n.x,n.y,n.z);if(u<=i)return p.info("DriveToCoord: arrived",{entity:e,distance:u.toFixed(2)}),!0;if(Date.now()-_>s)return p.warn("DriveToCoord: timeout",{entity:e,distance:u.toFixed(2)}),!0;await W(500)}return!1}async function U_(e,t,r){let{speed:n=10,drivingStyle:o=zn.NORMAL,duration:a=3e4}=t,i=GetVehiclePedIsIn(e,!1);if(!i||i===0)return p.warn("VehicleCruise: ped not in a vehicle, skipping",{entity:e}),!0;FreezeEntityPosition(i,!1),TaskVehicleDriveWander(e,i,n,o),p.info("VehicleCruise: started",{entity:e,vehicle:i,speed:n,drivingStyle:o,duration:a});let s=Date.now();for(;U(e,r);){if(!DoesEntityExist(i)||!IsPedInAnyVehicle(e,!1))return p.warn("VehicleCruise: ped no longer in vehicle",{entity:e,vehicle:i}),!0;if(Date.now()-s>=a)return ClearPedTasks(e),p.info("VehicleCruise: complete",{entity:e,duration:a}),!0;await W(500)}return!1}function Cs(e,t){if(p.debug("Applying frame properties",{entity:e,properties:t}),t.behavior){let r=t.behavior;r.alertness!==void 0&&SetPedAlertness(e,r.alertness),r.combatAbility!==void 0&&SetPedCombatAbility(e,r.combatAbility),r.combatMovement!==void 0&&SetPedCombatMovement(e,r.combatMovement),r.combatRange!==void 0&&SetPedCombatRange(e,r.combatRange),r.seeingRange!==void 0&&SetPedSeeingRange(e,r.seeingRange),r.hearingRange!==void 0&&SetPedHearingRange(e,r.hearingRange),r.targetLossResponse!==void 0&&SetPedTargetLossResponse(e,r.targetLossResponse)}if(t.weapon!==void 0&&(t.weapon===null?SetCurrentPedWeapon(e,2725352035,!0):(GiveWeaponToPed(e,t.weapon,999,!1,!0),SetCurrentPedWeapon(e,t.weapon,!0))),t.blockEvents!==void 0&&(SetBlockingOfNonTemporaryEvents(e,t.blockEvents),TaskSetBlockingOfNonTemporaryEvents(e,t.blockEvents)),t.configFlags)for(let[r,n]of Object.entries(t.configFlags)){let o=parseInt(r,10);SetPedConfigFlag(e,o,n)}if(t.relationship){let{groupName:r,targetGroup:n,relationship:o}=t.relationship,[a]=AddRelationshipGroup(r),[i]=AddRelationshipGroup(n);SetRelationshipBetweenGroups(o,a,i),SetPedRelationshipGroupHash(e,a)}if(t.faction){let r=Ti(t.faction);r&&(t.faction!=="player"&&AddRelationshipGroup(`RESPOON_${t.faction.toUpperCase()}`),SetPedRelationshipGroupHash(e,r),p.debug("Applied faction",{entity:e,faction:t.faction,hash:r}))}t.invincible!==void 0&&SetEntityInvincible(e,t.invincible)}async function W_(e,t,r){switch(t.type){case"goToCoord":return x_(e,t,r);case"wander":return T_(e,t,r);case"wait":return S_(e,t,r);case"clearTasks":return E_(e);case"handsUp":return P_(e,t,r);case"flee":return A_(e,t,r);case"combat":return I_(e,t,r);case"setBehavior":return N_(e,t);case"setRelationship":return R_(e,t);case"setConfigFlags":return M_(e,t);case"setBlockEvents":return D_(e,t);case"clearBehavior":return V_(e);case"animation":return F_(e,t,r);case"scenario":return O_(e,t,r);case"properties":return p.debug("Properties step executed",{entity:e}),!0;case"idle":return w_(e,t,r);case"enterVehicle":return B_(e,t,r);case"leaveVehicle":return G_(e,t,r);case"driveToCoord":return H_(e,t,r);case"vehicleCruise":return U_(e,t,r);default:return p.warn("Unknown step type",{type:t.type}),!0}}async function ta(e,t){if(!t.sequence){p.debug("No sequence to execute",{entity:e});return}let r=ks(e);if(!r){p.warn("Cannot execute: no UUID on entity",{entity:e});return}let{sequence:n,currentStepIndex:o}=t,a=t.version,i=fe.get(e);if(i&&!i.cancelled){p.debug("Execution already running - letting existing execution handle updates",{entity:e,existingVersion:i.version,newVersion:a});return}fe.set(e,{version:a,cancelled:!1}),p.info("Starting task execution",{uuid:r.substring(0,8),sequenceName:n.name,startStep:o,totalSteps:n.steps.length,version:a});let s=o;if(t.triggerPending){p.debug("Starting with trigger pending",{entity:e,trigger:t.triggerPending,stepIndex:s}),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"waiting",triggerName:t.triggerPending});let l=!1;for(;U(e,a);){await W(100);let _=Entity(e).state.ct_taskState;if(!_||_.status!=="running")break;if(_.version!==a){a=_.version,s=_.currentStepIndex,fe.set(e,{version:a,cancelled:!1}),l=!_.triggerPending;break}}if(!l){p.debug("Initial trigger wait cancelled",{entity:e}),fe.delete(e);return}p.debug("Initial trigger resolved, starting execution",{entity:e,stepIndex:s})}for(;s<n.steps.length&&U(e,a);){let l=n.steps[s];p.debug("Executing step",{entity:e,stepIndex:s,type:l.type,id:l.id}),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"running"});try{if(l.properties&&Cs(e,l.properties),!await W_(e,l,a)){p.debug("Step execution interrupted",{entity:e,stepIndex:s}),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"cancelled"});break}g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"completed"}),v_(r,s,a);let c=50,u=2e3,b=Date.now(),v=null;for(;Date.now()-b<u;){if(!U(e,a)){p.debug("Execution cancelled while waiting for step advancement",{entity:e,stepIndex:s});break}await W(c);let C=Entity(e).state.ct_taskState;if(!C){p.debug("Task state cleared while waiting for step advancement",{entity:e});break}if(C.status!=="running"){p.debug("Task status changed while waiting for step advancement",{entity:e,status:C.status});break}if(C.version!==a){v=C;break}}if(!v){Date.now()-b>=u&&p.warn("Timed out waiting for server step advancement",{entity:e,stepIndex:s,version:a});break}if(p.debug("Server advanced version",{entity:e,oldVersion:a,newVersion:v.version,newStepIndex:v.currentStepIndex}),fe.set(e,{version:v.version,cancelled:!1}),a=v.version,s=v.currentStepIndex,v.triggerPending){p.debug("Waiting for trigger",{entity:e,trigger:v.triggerPending,stepIndex:s}),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"waiting",triggerName:v.triggerPending});let C=!1;for(;U(e,a);){await W(100);let R=Entity(e).state.ct_taskState;if(!R||R.status!=="running")break;if(R.version!==a){a=R.version,s=R.currentStepIndex,fe.set(e,{version:a,cancelled:!1}),C=!R.triggerPending;break}}if(!C){p.debug("Trigger wait cancelled",{entity:e,stepIndex:s});break}p.debug("Trigger resolved, continuing execution",{entity:e,stepIndex:s})}}catch(_){p.error("Step execution error",{entity:e,stepIndex:s,step:l.type},_),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:s,totalSteps:n.steps.length,status:"error"}),C_(r,`Step ${s} (${l.type}) failed: ${_.message}`,a);break}}fe.get(e)?.version===a&&fe.delete(e),g("taskBuilder:stepProgress",{entityHandle:e,entityUuid:r,currentStepIndex:null,totalSteps:n.steps.length,status:"idle"}),p.debug("Task execution ended",{uuid:r.substring(0,8),finalStep:s})}function hr(e){let t=fe.get(e);if(t&&(t.cancelled=!0,fe.delete(e)),DoesEntityExist(e)){let n=Entity(e).state.ct_taskState?.sequence?.steps[0]?.properties;if(ClearPedTasks(e),n)Cs(e,{...n,blockEvents:n.blockEvents??!0}),p.info("Restored step 0 properties after stop",{entity:e});else{let o=Entity(e).state.ct_blockEvents??!0;SetBlockingOfNonTemporaryEvents(e,o),TaskSetBlockingOfNonTemporaryEvents(e,o),p.info("Restored blockEvents after stop (no step 0)",{entity:e,blockEvents:o})}}p.debug("Execution stopped",{entity:e})}function ra(e){let t=fe.get(e);return t!==void 0&&!t.cancelled}function z_(){let e=GetGamePool("CPed");for(let t of e){if(!NetworkHasControlOfEntity(t)||ra(t))continue;let r=Entity(t).state.ct_taskState;if(!r||r.status!=="running"||!r.sequence)continue;let n=Entity(t).state.ct_uuid;n&&(p.info("Resuming orphaned task after control transfer",{uuid:n.substring(0,8),entity:t,step:r.currentStepIndex,version:r.version}),ta(t,r))}}var fs=null,bs=0,q_=2e3;function j_(){fs===null&&(fs=setTick(()=>{let e=GetGameTimer();e-bs>=q_&&(bs=e,z_())}),p.debug("Control check tick started"))}j_();var d=m("StateBags"),oa=new Map,aa=new Map;function A(e,t){oa.set(e,t)}function xs(e,t){aa.set(e,t)}function $_(e){let t=e.replace("entity:",""),r=parseInt(t,10);return isNaN(r)||!NetworkDoesEntityExistWithNetworkId(r)?0:NetworkGetEntityFromNetworkId(r)}function na(e){let t=$_(e);return!t||!DoesEntityExist(t)?0:t}function ia(e,t){return t?GetEntityType(e)===t:!0}function K_(e){let{key:t,nativeCall:r,entityTypeCheck:n}=e;return(o,a)=>{if(a!=null&&ia(o,n))try{let s=r.replace(/\$entity/g,"entity").replace(/\$value/g,"value");new Function("entity","value",s)(o,a),d.debug(`Applied ${t}`,{entity:o,value:a})}catch(i){d.error(`Failed to apply ${t}`,{entity:o,value:a},i)}}}A("frozen",(e,t)=>{let r=t;try{FreezeEntityPosition(e,r),r||GetEntityType(e)===2&&(ActivatePhysics(e),SetVehicleGravity(e,!0),d.debug("Activated vehicle physics after unfreeze",{entity:e})),d.debug("Applied frozen",{entity:e,value:r})}catch(n){d.error("Failed to apply frozen",{entity:e,value:r},n)}});A("primaryColor",(e,t)=>{let r=t;if(r)try{SetVehicleCustomPrimaryColour(e,r.r,r.g,r.b),d.debug("Applied primaryColor to vehicle",{entity:e,color:r})}catch(n){d.error("Failed to apply primaryColor",{entity:e,color:r},n)}});A("secondaryColor",(e,t)=>{let r=t;if(r)try{SetVehicleCustomSecondaryColour(e,r.r,r.g,r.b),d.debug("Applied secondaryColor to vehicle",{entity:e,color:r})}catch(n){d.error("Failed to apply secondaryColor",{entity:e,color:r},n)}});A("neonEnabled",(e,t)=>{let r=t;if(r)try{SetVehicleNeonLightEnabled(e,0,r[0]),SetVehicleNeonLightEnabled(e,1,r[1]),SetVehicleNeonLightEnabled(e,2,r[2]),SetVehicleNeonLightEnabled(e,3,r[3]),d.debug("Applied neonEnabled to vehicle",{entity:e,enabled:r})}catch(n){d.error("Failed to apply neonEnabled",{entity:e,enabled:r},n)}});A("neonColor",(e,t)=>{let r=t;if(r)try{SetVehicleNeonLightsColour(e,r.r,r.g,r.b),d.debug("Applied neonColor to vehicle",{entity:e,color:r})}catch(n){d.error("Failed to apply neonColor",{entity:e,color:r},n)}});A("livery",(e,t)=>{let r=t;if(r!=null)try{let n=Math.max(0,GetVehicleLiveryCount(e)),o=Math.max(0,GetNumVehicleMods(e,48));if(r<0)n>0&&SetVehicleLivery(e,-1),o>0&&(SetVehicleModKit(e,0),SetVehicleMod(e,48,-1,!1)),d.debug("Reset livery to none",{entity:e});else if(r<n)SetVehicleLivery(e,r),d.debug("Applied traditional livery",{entity:e,index:r,traditionalCount:n});else{let a=r-n;a<o?(SetVehicleModKit(e,0),SetVehicleMod(e,48,a,!1),d.debug("Applied mod-based livery",{entity:e,modIndex:a,combinedIndex:r,modCount:o})):d.warn("Livery index out of range",{entity:e,combinedIndex:r,traditionalCount:n,modCount:o})}}catch(n){d.error("Failed to apply livery",{entity:e,combinedIndex:r},n)}});A("tyreSmokeColor",(e,t)=>{let r=t;if(r)try{SetVehicleModKit(e,0),ToggleVehicleMod(e,20,!0),SetVehicleTyreSmokeColor(e,r.r,r.g,r.b),d.debug("Applied tyreSmokeColor to vehicle (auto-enabled tyreSmoke mod)",{entity:e,color:r})}catch(n){d.error("Failed to apply tyreSmokeColor",{entity:e,color:r},n)}});A("pearlColor",(e,t)=>{let r=t;if(r!=null)try{let[,n]=GetVehicleExtraColours(e);SetVehicleExtraColours(e,r,n),d.debug("Applied pearlColor to vehicle",{entity:e,pearlIndex:r,wheelColor:n})}catch(n){d.error("Failed to apply pearlColor",{entity:e,pearlIndex:r},n)}});A("wheelColor",(e,t)=>{let r=t;if(r!=null)try{let[n]=GetVehicleExtraColours(e);SetVehicleExtraColours(e,n,r),d.debug("Applied wheelColor to vehicle",{entity:e,pearlColor:n,wheelIndex:r})}catch(n){d.error("Failed to apply wheelColor",{entity:e,wheelIndex:r},n)}});A("engineOn",(e,t)=>{let r=t;try{SetVehicleHasBeenOwnedByPlayer(e,!0),SetVehicleKeepEngineOnWhenAbandoned(e,r),SetVehicleEngineOn(e,r,!0,!0),setTimeout(()=>{DoesEntityExist(e)&&SetVehicleEngineOn(e,r,!1,!0)},100),d.debug("Applied engineOn to vehicle",{entity:e,value:r})}catch(n){d.error("Failed to apply engineOn",{entity:e,value:r},n)}});A("wheelType",(e,t)=>{let r=t;if(r!=null)try{SetVehicleWheelType(e,r),SetVehicleModKit(e,0),SetVehicleMod(e,23,-1,!1);let n=GetVehicleClass(e);(n===8||n===13)&&SetVehicleMod(e,24,-1,!1),d.debug("Applied wheelType (reset wheels to stock)",{entity:e,wheelType:r})}catch(n){d.error("Failed to apply wheelType",{entity:e,wheelType:r},n)}});A("mods",(e,t)=>{let r=t;if(r)try{SetVehicleModKit(e,0);let n="customTires"in r,o=typeof r.customTires=="boolean"?r.customTires:!!GetVehicleModVariation(e,23),a={spoiler:0,frontBumper:1,rearBumper:2,sideSkirt:3,exhaust:4,frame:5,grille:6,hood:7,fender:8,rightFender:9,roof:10,engine:11,brakes:12,transmission:13,horn:14,suspension:15,armor:16,wheels:23,rearWheels:24,plateHolder:25,vanityPlate:26,trim:27,ornaments:28,dashboard:29,dial:30,doorSpeaker:31,seats:32,steeringWheel:33,columnShifterLevers:34,plaques:35,speakers:36,trunk:37,hydraulics:38,engineBlock:39,airFilter:40,struts:41,archCover:42,aerials:43,trim2:44,tank:45,windows:46,livery:48},i={turbo:18,tyreSmoke:20,xenon:22},s=0;if(n&&!("wheels"in r)){let l=GetVehicleMod(e,23);l>=0&&(SetVehicleMod(e,23,l,o),s++,d.debug("Re-applied front wheels with customTires",{entity:e,wheels:l,customTires:o}));let _=GetVehicleClass(e);if(_===8||_===13){let c=GetVehicleMod(e,24);c>=0&&(SetVehicleMod(e,24,c,o),s++,d.debug("Re-applied rear wheels with customTires",{entity:e,rearWheels:c,customTires:o}))}}for(let[l,_]of Object.entries(a)){let c=r[l];if(typeof c=="number"&&c>=0){let u=_===23||_===24?o:!1;SetVehicleMod(e,_,c,u),s++}}for(let[l,_]of Object.entries(i)){let c=r[l];typeof c=="boolean"&&(ToggleVehicleMod(e,_,c),s++)}d.debug("Applied mods to vehicle",{entity:e,appliedCount:s,customTires:o})}catch(n){d.error("Failed to apply mods",{entity:e},n)}});A("repairVehicle",(e,t)=>{if(t)try{SetVehicleFixed(e),d.info("Repaired vehicle",{entity:e}),setTimeout(()=>{let r=Entity(e).state.ct_uuid;if(!r){d.debug("Cannot persist repaired states - no ct_uuid on entity",{entity:e});return}let n=Gr(e),o=Hr(e);O("update",{uuid:r,data:{doorStates:n,windowStates:o}}),d.debug("Sent repaired states to server for persistence",{uuid:r.substring(0,8)})},50)}catch(r){d.error("Failed to repair vehicle",{entity:e},r)}});A("doorCommand",(e,t)=>{if(!t)return;let r=t;try{if(!GetIsDoorValid(e,r.index)){d.warn("Invalid door index",{entity:e,index:r.index});return}switch(r.action){case"open":SetVehicleDoorOpen(e,r.index,!1,!1);break;case"close":SetVehicleDoorShut(e,r.index,!1);break;case"break":SetVehicleDoorBroken(e,r.index,!1);break;case"remove":SetVehicleDoorBroken(e,r.index,!0);break}d.debug("Applied door command",{entity:e,index:r.index,action:r.action}),setTimeout(()=>{let n=Entity(e).state.ct_uuid;if(!n){d.debug("Cannot persist door states - no ct_uuid on entity",{entity:e});return}let o=Gr(e),a=o.find(i=>i.index===r.index);if(a)switch(r.action){case"open":a.isOpen=!0;break;case"close":a.isOpen=!1,a.angle=0;break;case"break":a.isDamaged=!0;break;case"remove":a.isMissing=!0,a.isOpen=!1;break}O("update",{uuid:n,data:{doorStates:o}}),d.debug("Persisted door states",{uuid:n.substring(0,8),count:o.length})},50)}catch(n){d.error("Failed to apply door command",{entity:e,cmd:r},n)}});A("windowCommand",(e,t)=>{if(!t)return;let r=t;try{switch(r.action){case"rollDown":if(r.index<=5)RollDownWindow(e,r.index);else{d.warn("Cannot roll down windscreen",{entity:e,index:r.index});return}break;case"rollUp":if(r.index<=5)RollUpWindow(e,r.index);else{d.warn("Cannot roll up windscreen",{entity:e,index:r.index});return}break;case"smash":SmashVehicleWindow(e,r.index);break;case"fix":FixVehicleWindow(e,r.index);break}d.debug("Applied window command",{entity:e,index:r.index,action:r.action}),setTimeout(()=>{let n=Entity(e).state.ct_uuid;if(!n){d.debug("Cannot persist window states - no ct_uuid on entity",{entity:e});return}let o=Hr(e);O("update",{uuid:n,data:{windowStates:o}}),d.debug("Sent window states to server for persistence",{uuid:n.substring(0,8),windowCount:o.length})},50)}catch(n){d.error("Failed to apply window command",{entity:e,cmd:r},n)}});A("doorStates",(e,t)=>{if(!t||!Array.isArray(t))return;let r=t;try{let n=0;for(let o of r)if(GetIsDoorValid(e,o.index)){if(o.isMissing){SetVehicleDoorBroken(e,o.index,!0),n++;continue}o.isDamaged&&SetVehicleDoorBroken(e,o.index,!1),o.isOpen&&SetVehicleDoorOpen(e,o.index,!1,!1),n++}d.info("Restored door states",{entity:e,count:n,total:r.length})}catch(n){d.error("Failed to restore door states",{entity:e},n)}});A("windowStates",(e,t)=>{if(!t||!Array.isArray(t))return;let r=t;try{let n=0;for(let o of r)o.exists&&(o.isIntact||(SmashVehicleWindow(e,o.index),n++));d.info("Restored window states",{entity:e,count:n,total:r.length})}catch(n){d.error("Failed to restore window states",{entity:e},n)}});A("extras",(e,t)=>{if(!t||!Array.isArray(t))return;let r=t;try{let n=0;for(let o=0;o<15;o++){let a=r[o]??!1;SetVehicleExtra(e,o,!a),n++}d.debug("Applied extras to vehicle",{entity:e,count:n})}catch(n){d.error("Failed to apply extras",{entity:e},n)}});A("weaponHash",(e,t)=>{let r=t;try{ClearPedTasks(e),RemoveAllPedWeapons(e,!0),r!==null&&r!==0&&r!==2725352035&&(GiveWeaponToPed(e,r,9999,!1,!0),SetCurrentPedWeapon(e,r,!0),SetPedCurrentWeaponVisible(e,!0,!1,!1,!1),setTimeout(()=>{DoesEntityExist(e)&&(SetCurrentPedWeapon(e,r,!0),SetPedCurrentWeaponVisible(e,!0,!1,!1,!1))},100)),d.debug("Applied weaponHash to ped",{entity:e,weaponHash:r})}catch(n){d.error("Failed to apply weaponHash",{entity:e,weaponHash:r},n)}});A("blockEvents",(e,t)=>{let r=t;try{SetBlockingOfNonTemporaryEvents(e,r),TaskSetBlockingOfNonTemporaryEvents(e,r),d.debug("Applied blockEvents to ped",{entity:e,blockEvents:r})}catch(n){d.error("Failed to apply blockEvents",{entity:e,blockEvents:r},n)}});A("faction",(e,t)=>{let r=t;try{if(!r){d.debug("No faction assigned",{entity:e});return}let n=vt[r];if(!n){d.warn("Unknown faction ID",{entity:e,factionId:r});return}if(r!=="player"){let o=`RESPOON_${r.toUpperCase()}`;AddRelationshipGroup(o)}SetPedRelationshipGroupHash(e,n),d.debug("Applied faction to ped",{entity:e,factionId:r,hash:n})}catch(n){d.error("Failed to apply faction",{entity:e,factionId:r},n)}});A("behavior",(e,t)=>{let r=t;try{if(!r){d.debug("No behavior config to apply",{entity:e});return}r.alertness!==void 0&&SetPedAlertness(e,r.alertness),r.combatAbility!==void 0&&SetPedCombatAbility(e,r.combatAbility),r.combatMovement!==void 0&&SetPedCombatMovement(e,r.combatMovement),r.combatRange!==void 0&&SetPedCombatRange(e,r.combatRange),r.seeingRange!==void 0&&SetPedSeeingRange(e,r.seeingRange),r.hearingRange!==void 0&&SetPedHearingRange(e,r.hearingRange),r.targetLossResponse!==void 0&&SetPedTargetLossResponse(e,r.targetLossResponse),d.debug("Applied behavior config to ped",{entity:e,behavior:r})}catch(n){d.error("Failed to apply behavior",{entity:e,behavior:r},n)}});A("configFlags",(e,t)=>{let r=t;try{if(!r){d.debug("No config flags to apply",{entity:e});return}for(let[n,o]of Object.entries(r)){let a=parseInt(n,10);SetPedConfigFlag(e,a,o)}d.debug("Applied config flags to ped",{entity:e,flagCount:Object.keys(r).length})}catch(n){d.error("Failed to apply config flags",{entity:e,flags:r},n)}});var Y_=GetHashKey("mp_m_freemode_01"),X_=GetHashKey("mp_f_freemode_01");function fr(e){let t=GetEntityModel(e);return t===Y_||t===X_}A("drawables",(e,t)=>{let r=t;try{if(!r||r.length===0){d.debug("No drawables to apply",{entity:e});return}for(let n of r)SetPedComponentVariation(e,n.componentId,n.drawableId,n.textureId,n.paletteId);d.debug("Applied drawables to ped",{entity:e,count:r.length})}catch(n){d.error("Failed to apply drawables",{entity:e},n)}});A("props",(e,t)=>{let r=t;try{if(!r||r.length===0){d.debug("No props to apply",{entity:e});return}for(let n of r)n.drawableId===-1?ClearPedProp(e,n.propId):SetPedPropIndex(e,n.propId,n.drawableId,n.textureId,!0);d.debug("Applied props to ped",{entity:e,count:r.length})}catch(n){d.error("Failed to apply props",{entity:e},n)}});A("headBlend",(e,t)=>{let r=t;try{if(!r){d.debug("No headBlend to apply",{entity:e});return}if(!fr(e)){d.debug("Skipping headBlend - not a freemode model",{entity:e});return}SetPedHeadBlendData(e,r.shapeFirst,r.shapeSecond,r.shapeThird,r.skinFirst,r.skinSecond,r.skinThird,r.shapeMix,r.skinMix,r.thirdMix,!0),d.debug("Applied headBlend to ped",{entity:e})}catch(n){d.error("Failed to apply headBlend",{entity:e},n)}});A("faceFeatures",(e,t)=>{let r=t;try{if(!r||r.length===0){d.debug("No faceFeatures to apply",{entity:e});return}if(!fr(e)){d.debug("Skipping faceFeatures - not a freemode model",{entity:e});return}setTimeout(()=>{if(DoesEntityExist(e)){for(let n=0;n<r.length;n++)SetPedFaceFeature(e,n,r[n]);d.debug("Applied faceFeatures to ped",{entity:e,count:r.length})}},0)}catch(n){d.error("Failed to apply faceFeatures",{entity:e},n)}});A("hairColor",(e,t)=>{let r=t;try{if(!r){d.debug("No hairColor to apply",{entity:e});return}if(!fr(e)){d.debug("Skipping hairColor - not a freemode model",{entity:e});return}setTimeout(()=>{DoesEntityExist(e)&&(SetPedHairColor(e,0,0),SetPedHairColor(e,r[0],r[1]),d.debug("Applied hairColor to ped",{entity:e,primary:r[0],highlight:r[1]}))},0)}catch(n){d.error("Failed to apply hairColor",{entity:e},n)}});A("eyeColor",(e,t)=>{let r=t;try{if(r==null||r<0){d.debug("No eyeColor to apply",{entity:e,color:r});return}if(!fr(e)){d.debug("Skipping eyeColor - not a freemode model",{entity:e});return}setTimeout(()=>{DoesEntityExist(e)&&(SetPedEyeColor(e,r),d.debug("Applied eyeColor to ped",{entity:e,color:r}))},0)}catch(n){d.error("Failed to apply eyeColor",{entity:e},n)}});A("headOverlays",(e,t)=>{let r=t;try{if(!r||r.length===0){d.debug("No headOverlays to apply",{entity:e});return}if(!fr(e)){d.debug("Skipping headOverlays - not a freemode model",{entity:e});return}setTimeout(()=>{if(DoesEntityExist(e)){for(let n of r)SetPedHeadOverlay(e,n.overlayId,n.index,n.opacity),n.index!==255&&SetPedHeadOverlayColor(e,n.overlayId,n.colorType,n.firstColor,n.secondColor);d.debug("Applied headOverlays to ped",{entity:e,count:r.length,active:r.filter(n=>n.index!==255).length})}},0)}catch(n){d.error("Failed to apply headOverlays",{entity:e},n)}});A("attachment",(e,t)=>{let r=t&&ft(t)?t:null;if(t&&!r){d.warn("Invalid attachment data received, ignoring",{entity:e,value:t});return}try{if(r){let o=E(r.parentUuid)?.handle;if(!o||!DoesEntityExist(o)){Ri(e,r),d.info("Parent not available, queued pending attachment",{child:e,parentUuid:r.parentUuid});return}NetworkAllowRemoteAttachmentModification(o,!0),AttachEntityToEntity(e,o,r.boneIndex,r.offset.x,r.offset.y,r.offset.z,r.rotation.x,r.rotation.y,r.rotation.z,!1,!1,!1,!1,2,!0),eo(e),d.info("Attached entity to parent",{child:e,parent:o,parentUuid:r.parentUuid,bone:r.boneIndex})}else eo(e),DoesEntityExist(e)&&IsEntityAttached(e)&&(DetachEntity(e,!1,!1),d.info("Detached entity from parent",{entity:e}))}catch(n){d.error("Failed to handle attachment",{entity:e,attachment:r},n)}});xs("animation",async(e,t)=>{let r=t;try{if(r){RequestAnimDict(r.dict);let n=5e3;for(;!HasAnimDictLoaded(r.dict)&&n>0;)await new Promise(o=>setTimeout(o,50)),n-=50;HasAnimDictLoaded(r.dict)?(TaskPlayAnim(e,r.dict,r.name,r.blendIn,r.blendOut,-1,r.flags,0,!1,!1,!1),d.debug("Applied animation to ped",{entity:e,dict:r.dict,name:r.name}),RemoveAnimDict(r.dict)):d.warn("Failed to load animation dict",{entity:e,dict:r.dict})}else ClearPedTasks(e),d.debug("Cleared animation from ped",{entity:e})}catch(n){d.error("Failed to apply animation",{entity:e,animation:r},n)}});xs("taskState",async(e,t)=>{let r=t;try{if(!r){hr(e),d.debug("Task state cleared",{entity:e});return}if(!NetworkHasControlOfEntity(e)){d.debug("Skipping task execution - not entity controller",{entity:e});return}if(r.status==="running"&&r.sequence){if(ra(e)){d.debug("Ignoring state bag update - execution already in progress",{entity:e,version:r.version});return}await ta(e,r)}else r.status==="idle"||r.status==="paused"?(hr(e),d.debug("Task execution stopped",{entity:e,status:r.status})):r.status==="completed"?(hr(e),d.debug("Task sequence completed",{entity:e})):r.status==="error"&&(hr(e),d.warn("Task error",{entity:e,error:r.errorMessage}))}catch(n){d.error("Failed to handle taskState",{entity:e,taskState:r},n)}});function J_(){let e=["doorStates","windowStates","faction","weaponHash","blockEvents","behavior","configFlags","drawables","props","headBlend","faceFeatures","hairColor","eyeColor","headOverlays","attachment"],t=["taskState"];for(let r of e){let n=oa.get(r);n&&Ii(r,n)}for(let r of t){let n=aa.get(r);n&&Ni(r,n)}for(let r of yr){let n=jt(r.key);if(Ao(r)){let o=K_(r);A(r.key,o),AddStateBagChangeHandler(n,"",(a,i,s)=>{let l=na(a);l&&(o(l,s),Wr(a))})}else if(Io(r)){let o=oa.get(r.handlerId);if(!o){d.error(`No sync handler registered for ${r.handlerId}`);continue}AddStateBagChangeHandler(n,"",(a,i,s)=>{let l=na(a);l&&ia(l,r.entityTypeCheck)&&(o(l,s),Wr(a),r.key==="attachment"&&Bi(a))})}else if(No(r)){let o=aa.get(r.handlerId);if(!o){d.error(`No async handler registered for ${r.handlerId}`);continue}AddStateBagChangeHandler(n,"",async(a,i,s)=>{let l=na(a);l&&ia(l,r.entityTypeCheck)&&(await o(l,s),Wr(a))})}}d.debug("State bag listeners registered",{count:yr.length})}J_();k();k();var _e={LOOK_X:1,LOOK_Y:2,MOVE_LR:30,MOVE_FB:31,MOVE_UP:44,MOVE_DOWN:46,SPEED_UP:241,SPEED_DOWN:242,SPRINT:21,SLOW:19,LOOK_TOGGLE:25},sa={PITCH:10,YAW:10},Te={DEFAULT:1,MIN:.01,MAX:15,SCROLL_STEP:.1,SHIFT_MULTIPLIER:5,ALT_MULTIPLIER:.2},Nt={FOV:50,EASING_DURATION:250,PITCH_MIN:-89,PITCH_MAX:89};k();var re=-1,le={x:0,y:0,z:0},je={x:0,y:0,z:0},un=m("FreecamCamera");function Ts(e,t){re!==-1&&(un.debug("Camera already exists, destroying first"),la()),le={...e},je={...t},re=CreateCam("DEFAULT_SCRIPTED_CAMERA",!0),SetCamCoord(re,le.x,le.y,le.z),SetCamRot(re,je.x,je.y,je.z,2),SetCamFov(re,Nt.FOV),SetCamActive(re,!0),RenderScriptCams(!0,!0,Nt.EASING_DURATION,!0,!0),un.debug("Camera created",{position:le})}function la(){if(re===-1){un.debug("No camera to destroy");return}RenderScriptCams(!1,!0,Nt.EASING_DURATION,!0,!0),SetCamActive(re,!1),DestroyCam(re,!1),un.debug("Camera destroyed",{position:le}),re=-1}function Kt(){return re!==-1&&DoesCamExist(re)}function dt(){return{...le}}function Se(){return{...je}}function mn(e,t){le={...e},je={...t},re!==-1&&(SetCamCoord(re,le.x,le.y,le.z),SetCamRot(re,je.x,je.y,je.z,2),SetFocusPosAndVel(le.x,le.y,le.z,0,0,0))}bt();k();var Rt=-1,ut=Te.DEFAULT,Mt=!1,Ss=!0,pn=0,gn=0,Yt={lookMode:!1,speedChanges:!1},we=m("FreecamMovement");function Z_(){if(Mt)return;Mt=!0;let[e,t]=GetNuiCursorPosition();pn=e,gn=t,SetNuiFocus(!0,!1),Yt.lookMode&&we.debug("Entered look mode",{savedCursorX:pn,savedCursorY:gn})}function ws(){Mt&&(Mt=!1,SetCursorLocation(pn/GetActiveScreenResolution()[0],gn/GetActiveScreenResolution()[1]),SetNuiFocus(!0,!0),Yt.lookMode&&we.debug("Exited look mode",{savedCursorX:pn,savedCursorY:gn}))}function yn(e){Ss=e,we.debug("Scroll speed controls",{enabled:e})}function Q_(){Ss&&(IsDisabledControlJustPressed(0,_e.SPEED_DOWN)&&(ut=ot(ut-Te.SCROLL_STEP,Te.MIN,Te.MAX),Yt.speedChanges&&we.debug("Speed decreased",{speed:ut})),IsDisabledControlJustPressed(0,_e.SPEED_UP)&&(ut=ot(ut+Te.SCROLL_STEP,Te.MIN,Te.MAX),Yt.speedChanges&&we.debug("Speed increased",{speed:ut})))}function ed(e){let t=ut*e;return IsDisabledControlPressed(0,_e.SPRINT)&&(t*=Te.SHIFT_MULTIPLIER),IsDisabledControlPressed(0,_e.SLOW)&&(t*=Te.ALT_MULTIPLIER),t}function td(){if(DisableAllControlActions(0),IsDisabledControlJustPressed(0,_e.LOOK_TOGGLE)&&(Yt.lookMode&&we.debug("RMB JUST PRESSED - entering look mode"),Z_()),IsDisabledControlJustReleased(0,_e.LOOK_TOGGLE)&&(Yt.lookMode&&we.debug("RMB JUST RELEASED - exiting look mode"),ws()),!Mt)return;Q_();let e=GetFrameTime()*60,t=dt(),r=Se(),n=GetDisabledControlNormal(0,_e.LOOK_X),o=GetDisabledControlNormal(0,_e.LOOK_Y);r.x=ot(r.x-o*sa.PITCH*e,Nt.PITCH_MIN,Nt.PITCH_MAX),r.z=r.z-n*sa.YAW*e;let a=GetDisabledControlNormal(0,_e.MOVE_LR),i=GetDisabledControlNormal(0,_e.MOVE_FB),s=0;IsDisabledControlPressed(0,_e.MOVE_UP)?s=1:IsDisabledControlPressed(0,_e.MOVE_DOWN)&&(s=-1);let{forward:l,right:_,up:c}=Gt(r),u=ed(e);t.x+=_.x*a*u,t.y+=_.y*a*u,t.z+=_.z*a*u,t.x+=l.x*-i*u,t.y+=l.y*-i*u,t.z+=l.z*-i*u,t.x+=c.x*s*u,t.y+=c.y*s*u,t.z+=c.z*s*u,mn(t,r)}function Es(){if(Rt!==-1){we.debug("Movement tick already running");return}ut=Te.DEFAULT,Mt=!1,Rt=setTick(td),we.debug("Movement tick started",{tickId:Rt})}function Ps(){if(Rt===-1){we.debug("Movement tick not running");return}Mt&&ws(),clearTick(Rt),we.debug("Movement tick stopped",{tickId:Rt}),Rt=-1}k();var ce=0,As=!0,Ee=m("Freecam");function rd(){ce=PlayerPedId(),As=IsEntityVisible(ce),SetEntityVisible(ce,!1,!1),SetEntityCollision(ce,!1,!1),SetEntityInvincible(ce,!0),FreezeEntityPosition(ce,!0),Ee.debug("Player hidden for freecam")}function nd(e=!0){if(ce===0&&(ce=PlayerPedId()),e){let t=dt(),[r,n]=GetGroundZFor_3dCoord(t.x,t.y,t.z+1,!1),o=r?n:t.z;SetEntityCoords(ce,t.x,t.y,o,!1,!1,!1,!1);let a=Se();SetEntityHeading(ce,a.z),Ee.debug("Player teleported",{x:t.x,y:t.y,z:o})}SetEntityVisible(ce,As,!1),SetEntityCollision(ce,!0,!0),SetEntityInvincible(ce,!1),FreezeEntityPosition(ce,!1),Ee.debug("Player restored from freecam")}function Is(){if(Kt()){Ee.debug("Freecam already active");return}let e=GetGameplayCamCoord(),t=GetGameplayCamRot(2),r={x:e[0],y:e[1],z:e[2]},n={x:t[0],y:t[1],z:t[2]};Ee.debug("Starting freecam",{position:r}),rd(),Ts(r,n),Es(),Ee.debug("Freecam started")}function Ns(e=!0){if(!Kt()){Ee.debug("Freecam not active");return}Ee.debug("Stopping freecam..."),Ps(),la(),nd(e),ClearFocus(),Ee.debug("Freecam stopped")}function hn(e,t){if(!Kt()){Ee.warn("Cannot teleport: freecam not active");return}let r=Se();mn(e,t||r),Ee.debug("Camera teleported",{position:e})}bt();k();k();var I=m("PreviewProps");function Ms(e,t){if(!DoesEntityExist(e)){I.warn("Cannot apply vehicle data: entity does not exist",{entity:e});return}I.debug("Applying vehicle data to preview",{entity:e,hasData:!!t});try{if(t.mods&&od(e,t.mods),t.primaryColor&&Rs(e,t.primaryColor,"primary"),t.secondaryColor&&Rs(e,t.secondaryColor,"secondary"),t.pearlColor!==void 0||t.wheelColor!==void 0){let[r,n]=GetVehicleExtraColours(e),o=t.pearlColor??r,a=t.wheelColor??n;SetVehicleExtraColours(e,o,a),I.debug("Applied extra colors",{entity:e,pearl:o,wheel:a})}if(t.neonEnabled&&(SetVehicleNeonLightEnabled(e,0,t.neonEnabled[0]),SetVehicleNeonLightEnabled(e,1,t.neonEnabled[1]),SetVehicleNeonLightEnabled(e,2,t.neonEnabled[2]),SetVehicleNeonLightEnabled(e,3,t.neonEnabled[3]),I.debug("Applied neon enabled",{entity:e,enabled:t.neonEnabled})),t.neonColor&&(SetVehicleNeonLightsColour(e,t.neonColor.r,t.neonColor.g,t.neonColor.b),I.debug("Applied neon color",{entity:e,color:t.neonColor})),t.tyreSmokeColor&&(SetVehicleModKit(e,0),ToggleVehicleMod(e,20,!0),SetVehicleTyreSmokeColor(e,t.tyreSmokeColor.r,t.tyreSmokeColor.g,t.tyreSmokeColor.b),I.debug("Applied tyre smoke color",{entity:e,color:t.tyreSmokeColor})),t.livery!==void 0&&t.livery!==null&&ad(e,t.livery),t.wheelType!==void 0&&t.wheelType!==null&&(SetVehicleWheelType(e,t.wheelType),I.debug("Applied wheel type",{entity:e,wheelType:t.wheelType})),t.windowTint!==void 0&&t.windowTint!==null&&(SetVehicleWindowTint(e,t.windowTint),I.debug("Applied window tint",{entity:e,tint:t.windowTint})),t.plateText&&(SetVehicleNumberPlateText(e,t.plateText),I.debug("Applied plate text",{entity:e,text:t.plateText})),t.plateStyle!==void 0&&t.plateStyle!==null&&(SetVehicleNumberPlateTextIndex(e,t.plateStyle),I.debug("Applied plate style",{entity:e,style:t.plateStyle})),t.extras){for(let r=0;r<14;r++)t.extras[r]!==void 0&&SetVehicleExtra(e,r+1,!t.extras[r]);I.debug("Applied extras",{entity:e})}I.info("Vehicle data applied to preview",{entity:e})}catch(r){I.error("Failed to apply vehicle data",{entity:e},r)}}function od(e,t){SetVehicleModKit(e,0);let r=typeof t.customTires=="boolean"?t.customTires:!1,n={spoiler:0,frontBumper:1,rearBumper:2,sideSkirt:3,exhaust:4,frame:5,grille:6,hood:7,fender:8,rightFender:9,roof:10,engine:11,brakes:12,transmission:13,horns:14,suspension:15,armor:16,turbo:18,tyreSmoke:20,xenonHeadlights:22,frontWheels:23,backWheels:24,plateholders:25,vanityPlates:26,trimDesign:27,ornaments:28,dashSpeakers:29,seats:30,steeringWheel:31,columnShifterLevers:32,plaques:33,speakers:34,trunk:35,hydraulics:36,engineBlock:37,airFilter:38,struts:39,archCover:40,aerials:41,trim:42,tank:43,windows:44,livery:46,lightbar:47};for(let[a,i]of Object.entries(n))if(a in t&&typeof t[a]=="number"){let s=t[a];SetVehicleMod(e,i,s,r&&(i===23||i===24))}let o={turbo:18,tyreSmoke:20,xenonHeadlights:22};for(let[a,i]of Object.entries(o))a in t&&typeof t[a]=="boolean"&&ToggleVehicleMod(e,i,t[a]);I.debug("Applied vehicle mods",{entity:e,modCount:Object.keys(t).length})}function Rs(e,t,r){typeof t=="number"?(r==="primary"?SetVehicleColours(e,t,GetVehicleColours(e)[1]):SetVehicleColours(e,GetVehicleColours(e)[0],t),I.debug(`Applied ${r} color (index)`,{entity:e,index:t})):(r==="primary"?SetVehicleCustomPrimaryColour(e,t.r,t.g,t.b):SetVehicleCustomSecondaryColour(e,t.r,t.g,t.b),I.debug(`Applied ${r} color (RGB)`,{entity:e,color:t}))}function ad(e,t){let r=Math.max(0,GetVehicleLiveryCount(e)),n=Math.max(0,GetNumVehicleMods(e,48));if(t<0)r>0&&SetVehicleLivery(e,-1),n>0&&(SetVehicleModKit(e,0),SetVehicleMod(e,48,-1,!1)),I.debug("Reset livery to none",{entity:e});else if(t<r)SetVehicleLivery(e,t),I.debug("Applied traditional livery",{entity:e,index:t});else{let o=t-r;o<n&&(SetVehicleModKit(e,0),SetVehicleMod(e,48,o,!1),I.debug("Applied mod-based livery",{entity:e,modIndex:o}))}}var id=GetHashKey("mp_m_freemode_01"),sd=GetHashKey("mp_f_freemode_01");function ld(e){let t=GetEntityModel(e);return t===id||t===sd}function Ds(e,t){if(!DoesEntityExist(e)){I.warn("Cannot apply ped data: entity does not exist",{entity:e});return}I.debug("Applying ped data to preview",{entity:e,hasData:!!t});try{let r=ld(e);if(t.drawables&&t.drawables.length>0){for(let n of t.drawables)SetPedComponentVariation(e,n.componentId,n.drawableId,n.textureId,n.paletteId);I.debug("Applied drawables",{entity:e,count:t.drawables.length})}if(t.props&&t.props.length>0){for(let n of t.props)n.drawableId===-1?ClearPedProp(e,n.propId):SetPedPropIndex(e,n.propId,n.drawableId,n.textureId,!0);I.debug("Applied props",{entity:e,count:t.props.length})}if(r){if(t.headBlend){let n=t.headBlend;SetPedHeadBlendData(e,n.shapeFirst,n.shapeSecond,n.shapeThird,n.skinFirst,n.skinSecond,n.skinThird,n.shapeMix,n.skinMix,n.thirdMix,!1),I.debug("Applied head blend",{entity:e})}if(t.faceFeatures&&t.faceFeatures.length>0){for(let n=0;n<t.faceFeatures.length;n++)SetPedFaceFeature(e,n,t.faceFeatures[n]);I.debug("Applied face features",{entity:e,count:t.faceFeatures.length})}if(t.hairColor!==void 0&&t.hairColor!==null&&(SetPedHairColor(e,t.hairColor,t.hairHighlight??0),I.debug("Applied hair color",{entity:e,color:t.hairColor})),t.eyeColor!==void 0&&t.eyeColor!==null&&(SetPedEyeColor(e,t.eyeColor),I.debug("Applied eye color",{entity:e,color:t.eyeColor})),t.headOverlays&&t.headOverlays.length>0){for(let n of t.headOverlays)SetPedHeadOverlay(e,n.overlayId,n.index,n.opacity),n.colorType>0&&SetPedHeadOverlayColor(e,n.overlayId,n.colorType,n.firstColor,n.secondColor);I.debug("Applied head overlays",{entity:e,count:t.headOverlays.length})}}I.info("Ped data applied to preview",{entity:e,isFreemode:r})}catch(r){I.error("Failed to apply ped data",{entity:e},r)}}k();var Xt=m("NUI:Preview"),Vs=!1;function Fs(){return Vs}function ca(){RegisterNuiCallback("preview:start",async(e,t)=>{let{type:r,model:n}=e;Xt.debug("NUI preview:start",{type:r,model:n});let o=await fn(n,r);o&&g("preview:started",{model:n,type:r}),t({success:o})}),RegisterNuiCallback("preview:cancel",(e,t)=>{Xt.debug("NUI preview:cancel"),Pe(),g("preview:cancelled",{}),t({success:!0})}),RegisterNuiCallback("preview:confirm",(e,t)=>{Xt.debug("NUI preview:confirm");let r=Os();if(!r){Xt.warn("No active preview to confirm"),t({success:!1,error:"No active preview"});return}g("preview:confirmed",{});let n={position:r.position,rotation:{x:0,y:0,z:r.heading}};O("create",{type:r.type,model:r.model,transform:n,data:r.entityData??void 0,libraryName:r.libraryName??void 0}),Xt.debug("Entity create sent",{model:r.model,hasEntityData:!!r.entityData,libraryName:r.libraryName}),t({success:!0})}),RegisterNuiCallback("preview:uiHover",(e,t)=>{Vs=e.hovering,t({})}),Xt.debug("Preview callbacks registered")}var _a=7.5,Ls=1,Bs=50,Gs=.5,cd=179,_d=241,dd=242,ud=21,Hs=5,ne=-1,Us=0,da="",ua=null,ma=null,pa=null,$e=_a,br=0,Dt=-1,de=m("Preview");function Ws(){let e=dt(),t=Se(),{forward:r}=Gt(t);return{x:e.x+r.x*$e,y:e.y+r.y*$e,z:e.z+r.z*$e}}function zs(){return Se().z+br}async function md(e){if(!IsModelValid(e))return de.warn("Invalid model hash",{hash:`0x${(e>>>0).toString(16).toUpperCase()}`}),!1;RequestModel(e);let t=GetGameTimer()+5e3;for(;!HasModelLoaded(e);){if(GetGameTimer()>t)return de.warn("Model load timeout",{hash:`0x${(e>>>0).toString(16).toUpperCase()}`}),!1;await new Promise(r=>setTimeout(r,0))}return!0}function pd(e,t,r,n){let o=-1;switch(e){case"prop":o=CreateObject(t,r.x,r.y,r.z,!1,!1,!1);break;case"vehicle":o=CreateVehicle(t,r.x,r.y,r.z,n,!1,!1);break;case"ped":o=CreatePed(0,t,r.x,r.y,r.z,n,!1,!1);break}return o}function gd(e){DoesEntityExist(e)&&(SetEntityAlpha(e,cd,!1),SetEntityCollision(e,!1,!1),FreezeEntityPosition(e,!0),SetEntityInvincible(e,!0),IsEntityAPed(e)&&(SetBlockingOfNonTemporaryEvents(e,!0),TaskSetBlockingOfNonTemporaryEvents(e,!0)))}function yd(){if(Dt===-1)return;if(ne===-1||!DoesEntityExist(ne)){de.warn("Preview entity no longer exists, stopping preview"),Pe();return}if(!Fs()){let r=IsDisabledControlPressed(0,ud);IsDisabledControlJustPressed(0,_d)&&(r?br-=Hs:$e=ot($e+Gs,Ls,Bs)),IsDisabledControlJustPressed(0,dd)&&(r?br+=Hs:$e=ot($e-Gs,Ls,Bs))}let e=Ws(),t=zs();SetEntityCoordsNoOffset(ne,e.x,e.y,e.z,!1,!1,!1),SetEntityHeading(ne,t)}async function fn(e,t,r,n){mt()&&(de.debug("Stopping existing preview before starting new one"),Pe());let o=e.startsWith("0x")?parseInt(e,16):GetHashKey(e);if(de.debug("Starting preview",{model:e,hash:`0x${(o>>>0).toString(16).toUpperCase()}`,type:t,hasEntityData:!!r}),!await md(o))return de.warn("Failed to load model",{model:e}),!1;let i=Ws(),s=zs(),l=pd(t,o,i,s);return l===-1||!DoesEntityExist(l)?(de.warn("Failed to create preview entity",{model:e}),SetModelAsNoLongerNeeded(o),!1):(gd(l),r&&(de.debug("Applying saved properties to preview",{handle:l,type:t}),t==="vehicle"?Ms(l,r):t==="ped"&&Ds(l,r)),ne=l,Us=o,da=e,ua=t,ma=r??null,pa=n??null,yn(!1),$e=_a,br=0,Dt=setTick(yd),de.debug("Preview started",{handle:l,tickId:Dt,hasEntityData:!!r,libraryName:n}),SetModelAsNoLongerNeeded(o),!0)}function Pe(){ne===-1&&Dt===-1||(Dt!==-1&&(clearTick(Dt),Dt=-1),ne!==-1&&DoesEntityExist(ne)&&(DeleteEntity(ne),de.debug("Preview entity deleted",{handle:ne})),yn(!0),ne=-1,Us=0,da="",ua=null,ma=null,pa=null,$e=_a,br=0,de.debug("Preview stopped"))}function Os(){if(!mt())return de.warn("Cannot confirm: no preview active"),null;let e=GetEntityCoords(ne,!1),t=GetEntityHeading(ne),r={model:da,type:ua,position:{x:e[0],y:e[1],z:e[2]},heading:t,entityData:ma,libraryName:pa};return de.debug("Preview confirmed",{model:r.model,position:r.position,hasEntityData:!!r.entityData}),Pe(),r}function mt(){return ne!==-1&&DoesEntityExist(ne)}var ee=m("NUI:Library"),Ke=null;function ga(){RegisterNuiCallback("library:fetch",(e,t)=>{ee.debug("NUI library:fetch"),emitNet("respoon:library:fetch",{}),t({success:!0})}),RegisterNuiCallback("library:delete",(e,t)=>{let{uuid:r}=e;if(!r){ee.warn("library:delete - missing uuid"),t({success:!1,error:"Missing uuid"});return}ee.debug("NUI library:delete",{uuid:r}),emitNet("respoon:library:delete",{uuid:r}),t({success:!0})}),RegisterNuiCallback("library:rename",(e,t)=>{let{uuid:r,newName:n}=e;if(!r||!n){ee.warn("library:rename - missing uuid or newName"),t({success:!1,error:"Missing uuid or newName"});return}ee.debug("NUI library:rename",{uuid:r,newName:n}),emitNet("respoon:library:rename",{uuid:r,newName:n}),t({success:!0})}),RegisterNuiCallback("library:getEntry",(e,t)=>{let{uuid:r}=e;if(!r){ee.warn("library:getEntry - missing uuid"),t({success:!1,error:"Missing uuid"});return}ee.debug("NUI library:getEntry",{uuid:r}),emitNet("respoon:library:getEntry",{uuid:r}),t({success:!0})}),RegisterNuiCallback("preview:startFromLibrary",async(e,t)=>{let{libraryUuid:r}=e;if(!r){ee.warn("preview:startFromLibrary - missing libraryUuid"),t({success:!1,error:"Missing libraryUuid"});return}ee.debug("NUI preview:startFromLibrary",{libraryUuid:r});let n=await hd(r);if(!n){ee.warn("preview:startFromLibrary - failed to fetch library entry",{libraryUuid:r}),t({success:!1,error:"Failed to fetch library entry"});return}ee.debug("Library entry received, starting preview",{name:n.name,model:n.modelName,type:n.entityType});let o=await fn(n.modelName,n.entityType,n.entityData,n.name);o&&g("preview:started",{model:n.modelName,type:n.entityType}),t({success:o})}),ee.debug("Library callbacks registered")}function hd(e){return new Promise(t=>{Ke={uuid:e,resolve:t},emitNet("respoon:library:getEntry",{uuid:e}),setTimeout(()=>{Ke?.uuid===e&&(ee.warn("Library entry fetch timed out",{uuid:e}),Ke=null,t(null))},5e3)})}function qs(e){if(!e){Ke&&(ee.warn("Received null library entry response"),Ke.resolve(null),Ke=null);return}Ke?(ee.debug("Received library entry response",{uuid:e.uuid,name:e.name}),Ke.resolve(e),Ke=null):ee.warn("Received library entry but no pending request",{uuid:e.uuid})}k();var z=m("ParticleManager"),fd=5e3,bd=50;async function kd(e){if(HasNamedPtfxAssetLoaded(e))return!0;RequestNamedPtfxAsset(e);let t=GetGameTimer();for(;!HasNamedPtfxAssetLoaded(e);){if(GetGameTimer()-t>fd)return z.warn("PTFX asset load timeout",{dictionary:e}),!1;await new Promise(r=>setTimeout(r,bd))}return z.debug("PTFX asset loaded",{dictionary:e}),!0}async function js(e,t,r,n){if(!await kd(e))return z.error("Failed to load PTFX asset",{dictionary:e,effect:t}),0;UseParticleFxAssetNextCall(e);let{position:a,rotation:i}=r,s=StartParticleFxLoopedAtCoord(t,a.x,a.y,a.z,i.x,i.y,i.z,1,!1,!1,!1,!1);return s===0?(z.error("Failed to spawn PTFX",{dictionary:e,effect:t}),0):(n!==255&&SetParticleFxLoopedAlpha(s,n/255),z.debug("PTFX spawned",{dictionary:e,effect:t,handle:s}),s)}function $s(e){e!==0&&DoesParticleFxLoopedExist(e)&&(StopParticleFxLooped(e,!1),z.debug("PTFX stopped",{handle:e}))}async function Ks(e){lo(e,null);let t=await js(e.dictionary,e.effect,e.transform,e.alpha);t!==0?co(e.uuid,t):z.error("Particle spawn failed",{uuid:e.uuid,effect:`${e.dictionary}/${e.effect}`})}async function bn(e,t,r){let n=Ve(e);if(!n){z.warn("Particle not found for update",{uuid:e});return}if(t){n.transform=t,n.handle!==null&&($s(n.handle),zi(e,!1));let o=await js(n.dictionary,n.effect,t,r??n.alpha);o!==0&&co(e,o)}else r!==void 0&&n.handle!==null&&(n.alpha=r,SetParticleFxLoopedAlpha(n.handle,r/255),z.debug("Particle alpha updated",{uuid:e,alpha:r}))}function vd(e){let t=Ve(e);return t?(t.handle!==null&&$s(t.handle),Hi(e)):(z.warn("Particle not found for delete",{uuid:e}),!1)}async function ya(e){z.debug("Syncing particles from server",{count:e.length}),_o(),qi(e);for(let t of e)await Ks(t);z.debug("Particle sync complete",{count:e.length})}function kr(){ji(),z.debug("All particle state reset")}async function Cd(e){let{particle:t}=e;z.debug("Particle created",{uuid:t.uuid,effect:`${t.dictionary}/${t.effect}`}),await Ks(t),g("particle:created",{particle:t})}async function xd(e){let{uuid:t,changes:r,byPlayer:n}=e,o=GetPlayerServerId(PlayerId());if(n===o){z.debug("Skipping self-broadcast particle update",{uuid:t});return}z.debug("Particle updated (remote)",{uuid:t,byPlayer:n,hasTransform:!!r.transform,hasAlpha:r.alpha!==void 0}),await bn(t,r.transform,r.alpha);let a=Ve(t);a&&(a.updatedAt=r.updatedAt),g("particle:updated",{uuid:t,changes:r})}function Td(e){let{uuid:t,byPlayer:r}=e;z.debug("Particle deleted",{uuid:t,byPlayer:r}),as()===t&&ls(),vd(t),g("particle:deleted",{uuid:t})}async function Sd(e){let{particles:t}=e;z.debug("Received particles:sync",{count:t.length}),await ya(t),g("particles:sync",{particles:t})}function wd(e){let{uuid:t,lockedBy:r}=e;z.debug("Particle locked",{uuid:t,lockedBy:r}),g("particle:locked",{uuid:t,lockedBy:r})}function Ed(e){let{uuid:t}=e;z.debug("Particle unlocked",{uuid:t}),g("particle:unlocked",{uuid:t})}function Ys(){onNet("respoon:particle:created",Cd),onNet("respoon:particle:updated",xd),onNet("respoon:particle:deleted",Td),onNet("respoon:particles:sync",Sd),onNet("respoon:particle:locked",wd),onNet("respoon:particle:unlocked",Ed),z.debug("Particle handlers registered")}k();var Vt=m("FactionManager"),Xs=!1,Pd=Wn;function Ad(){if(Xs){Vt.debug("Factions already initialized");return}Vt.info("Initializing faction relationship groups");for(let e of Re){if(e.id==="player"){Vt.debug("Skipping PLAYER group (built-in GTA group)",{faction:e.id});continue}let t=`RESPOON_${e.id.toUpperCase()}`,[r,n]=AddRelationshipGroup(t);Vt.debug("Created faction group",{faction:e.id,groupName:t,hash:r,wasCreated:n})}vr(Wn),Xs=!0,Vt.info("Faction system initialized",{factionCount:Re.length})}function vr(e){Vt.debug("Applying relationship matrix");for(let t of Re){let r=vt[t.id];for(let n of Re){let o=vt[n.id],a=e[t.id]?.[n.id]??3,i=On[a];SetRelationshipBetweenGroups(i,r,o)}}Pd=e,Vt.debug("Relationship matrix applied")}setTimeout(()=>{Ad()},1e3);k();var B=m("EnvManager"),h={},Fe=-1,q=new Map,j=new Map;function ue(){let e=h.timeLock||h.weather!=null||h.rainLevel!=null||h.snowLevel!=null||h.vehicleTrafficEnabled===!1||h.pedPopulationEnabled===!1;e&&Fe===-1?(Fe=setTick(()=>{h.timeLock&&h.time&&NetworkOverrideClockTime(h.time.hour,h.time.minute,0),h.weather!=null&&SetOverrideWeather(h.weather),h.rainLevel!=null&&SetRainLevel(h.rainLevel),h.snowLevel!=null&&SetSnowLevel(h.snowLevel),h.vehicleTrafficEnabled===!1&&(SetVehicleDensityMultiplierThisFrame(0),SetRandomVehicleDensityMultiplierThisFrame(0),SetParkedVehicleDensityMultiplierThisFrame(0)),h.pedPopulationEnabled===!1&&(SetPedDensityMultiplierThisFrame(0),SetScenarioPedDensityMultiplierThisFrame(0,0))}),B.debug("Env tick started",{tickId:Fe})):!e&&Fe!==-1&&(clearTick(Fe),B.debug("Env tick stopped",{tickId:Fe}),Fe=-1)}function Id(){let e=GetGamePool("CVehicle"),t=PlayerPedId(),r=GetVehiclePedIsIn(t,!1),n=0;for(let o of e){if(o===r)continue;let a=!1,i=GetVehicleMaxNumberOfPassengers(o);for(let l=-1;l<=i;l++){let _=GetPedInVehicleSeat(o,l);if(_!==0&&IsPedAPlayer(_)){a=!0;break}}if(a)continue;let s=NetworkGetNetworkIdFromEntity(o);s!==0&&Entity(s).state?.ct_managed||(DeleteEntity(o),n++)}B.debug("Deleted NPC vehicles",{count:n})}function Nd(){let e=GetGamePool("CPed"),t=PlayerPedId(),r=0;for(let n of e){if(IsPedAPlayer(n)||n===t)continue;let o=NetworkGetNetworkIdFromEntity(n);o!==0&&Entity(o).state?.ct_managed||(DeleteEntity(n),r++)}B.debug("Deleted NPC peds",{count:r})}q.set("time",e=>{let t=e;h.time=t,t&&(NetworkOverrideClockTime(t.hour,t.minute,0),B.debug("Applied time override",{hour:t.hour,minute:t.minute})),h.timeLock&&ue()});j.set("time",()=>{h.time=void 0});q.set("timeLock",e=>{let t=e;h.timeLock=t,ue(),B.debug(t?"Time lock enabled":"Time lock disabled")});j.set("timeLock",()=>{h.timeLock=void 0,ue()});q.set("weather",e=>{let t=e;h.weather=t,t!=null?(SetWeatherTypePersist(t),SetWeatherTypeNowPersist(t),SetOverrideWeather(t),B.debug("Applied weather",{weather:t})):(ClearOverrideWeather(),ClearWeatherTypePersist(),B.debug("Cleared weather override")),ue()});j.set("weather",()=>{h.weather=void 0,ClearOverrideWeather(),ClearWeatherTypePersist(),ue()});q.set("windSpeed",e=>{let t=e;h.windSpeed=t,t!=null?(SetWindSpeed(t),B.debug("Applied wind speed",{speed:t})):SetWindSpeed(-1)});j.set("windSpeed",()=>{h.windSpeed=void 0,SetWindSpeed(-1)});q.set("windDirection",e=>{let t=e;h.windDirection=t,t!=null?(SetWindDirection(t),B.debug("Applied wind direction",{dir:t})):SetWindDirection(-1)});j.set("windDirection",()=>{h.windDirection=void 0,SetWindDirection(-1)});q.set("rainLevel",e=>{let t=e;h.rainLevel=t,t==null&&SetRainLevel(-1),ue(),B.debug("Rain level set",{level:t})});j.set("rainLevel",()=>{h.rainLevel=void 0,SetRainLevel(-1),ue()});q.set("snowLevel",e=>{let t=e;h.snowLevel=t,t==null&&SetSnowLevel(-1),ue(),B.debug("Snow level set",{level:t})});j.set("snowLevel",()=>{h.snowLevel=void 0,SetSnowLevel(-1),ue()});q.set("cloudHat",e=>{let t=e;h.cloudHat=t,ClearCloudHat(),t!=null&&(LoadCloudHat(t,.5),B.debug("Applied cloud hat",{hat:t}))});j.set("cloudHat",()=>{h.cloudHat=void 0,ClearCloudHat()});q.set("cloudOpacity",e=>{let t=e;h.cloudOpacity=t,t!=null?(SetCloudsAlpha(t),B.debug("Applied cloud opacity",{opacity:t})):SetCloudsAlpha(1)});j.set("cloudOpacity",()=>{h.cloudOpacity=void 0,SetCloudsAlpha(1)});q.set("blackout",e=>{let t=e;h.blackout=t,SetArtificialLightsState(t),B.debug(t?"Blackout enabled":"Blackout disabled")});j.set("blackout",()=>{h.blackout=void 0,SetArtificialLightsState(!1)});q.set("gravity",e=>{let t=e;h.gravity=t,t!=null?(SetGravityLevel(t),B.debug("Applied gravity level",{level:t})):SetGravityLevel(0)});j.set("gravity",()=>{h.gravity=void 0,SetGravityLevel(0)});q.set("forcePedTracks",e=>{let t=e;h.forcePedTracks=t,SetForcePedFootstepsTracks(t),B.debug(t?"Ped tracks enabled":"Ped tracks disabled")});j.set("forcePedTracks",()=>{h.forcePedTracks=void 0,SetForcePedFootstepsTracks(!1)});q.set("forceVehicleTrails",e=>{let t=e;h.forceVehicleTrails=t,SetForceVehicleTrails(t),B.debug(t?"Vehicle trails enabled":"Vehicle trails disabled")});j.set("forceVehicleTrails",()=>{h.forceVehicleTrails=void 0,SetForceVehicleTrails(!1)});q.set("waveIntensity",e=>{let t=e;h.waveIntensity=t,t!=null?(SetDeepOceanScaler(t),B.debug("Applied wave intensity",{intensity:t})):ResetDeepOceanScaler()});j.set("waveIntensity",()=>{h.waveIntensity=void 0,ResetDeepOceanScaler()});q.set("timecycleModifier",e=>{let t=e;h.timecycleModifier=t,t!=null?(SetTimecycleModifier(t),h.timecycleStrength!=null&&SetTimecycleModifierStrength(h.timecycleStrength),B.debug("Applied timecycle modifier",{modifier:t})):ClearTimecycleModifier()});j.set("timecycleModifier",()=>{h.timecycleModifier=void 0,ClearTimecycleModifier()});q.set("timecycleStrength",e=>{let t=e;h.timecycleStrength=t,t!=null&&h.timecycleModifier!=null&&(SetTimecycleModifierStrength(t),B.debug("Applied timecycle strength",{strength:t}))});j.set("timecycleStrength",()=>{h.timecycleStrength=void 0});q.set("vehicleTrafficEnabled",e=>{let t=e;h.vehicleTrafficEnabled=t,t||Id(),ue(),B.debug(t?"Vehicle traffic enabled":"Vehicle traffic disabled")});j.set("vehicleTrafficEnabled",()=>{h.vehicleTrafficEnabled=void 0,ue()});q.set("pedPopulationEnabled",e=>{let t=e;h.pedPopulationEnabled=t,t||Nd(),ue(),B.debug(t?"Ped population enabled":"Ped population disabled")});j.set("pedPopulationEnabled",()=>{h.pedPopulationEnabled=void 0,ue()});function ha(e,t){let r=q.get(e);r?r(t):B.warn("No handler for environment property",{key:e})}function Js(e){if(Jt(),!!e){for(let t of ea){let r=e[t.key];r!==void 0&&ha(t.key,r)}B.debug("Applied all environment properties",{env:e})}}function Jt(){for(let e of j.values())e();Fe!==-1&&(clearTick(Fe),Fe=-1),h={},B.debug("Reset all environment properties")}var y=m("NetListeners");async function Rd(e){let{room:t,entities:r,particles:n,playerIdentifier:o}=e;y.debug("Received room:joined event",{roomName:t.name,entityCount:r.length,particleCount:n?.length??0,bucket:t.routingBucket,playerIdentifier:o||"none",memberCount:t.members.length}),At(),qr(t),y.debug("Auto-camera move disabled, camera remains at current position",{roomName:t.name}),o&&io(o),jr(r),await ya(n??[]),Js(t.environment);let a=GetPlayerServerId(PlayerId());g("room:joined",{room:t,playerIdentifier:o,playerId:a,sceneStatus:e.sceneStatus??"idle"}),g("entities:sync",{entities:r}),g("particles:sync",{particles:n??[]}),y.debug("Room join complete",{roomName:t.name});let i=r.filter(s=>s.networkId!==null).map(s=>s.networkId);if(i.length>0){let s=await Kr(i,(l,_)=>{y.debug("Resolve progress",{resolved:l,total:_})});for(let l of s)if(l.success){let _=r.find(c=>c.networkId===l.networkId);_&&sr(_.uuid,l.handle)}}}function Md(){y.debug("Left room"),wt(),mt()&&(Pe(),y.debug("Stopped preview on room:left")),qr(null),Ht(),kr(),Jt(),g("room:left",{})}function Dd(e){y.debug("Room created",{roomName:e.room.name}),g("room:created",e)}function Vd(e){y.debug("Room deleted",{roomName:e.roomName,roomId:e.roomId}),g("room:deleted",e)}function Fd(e){y.debug("Room reset received",{roomId:e.roomId}),wt(),mt()&&(Pe(),y.debug("Stopped preview on room:reset")),Ht(),kr(),At(),Jt(),g("room:reset",e)}function Od(e){y.debug("Received room:list event",{roomCount:e.rooms.length});for(let t of e.rooms)y.debug("Room in list",{name:t.name,uuid:t.uuid,memberCount:t.memberCount});g("room:list",e),y.debug("Forwarded room:list to NUI")}function Ld(e){y.debug("Member joined",{playerName:e.member.playerName}),g("room:memberJoined",e)}function Bd(e){y.debug("Member left",{playerId:e.playerId}),g("room:memberLeft",e)}async function Gd(e){let{entity:t}=e;y.debug("Entity created",{type:t.type,model:t.model,networkId:t.networkId});let r=zr(t,t.networkId);if(g("entity:created",{entity:r}),t.networkId!==null){let n=await $r(t.networkId);n!==0&&sr(t.uuid,n)}}function Hd(e){let{uuid:t,changes:r,byPlayer:n,endDrag:o}=e,a=GetPlayerServerId(PlayerId()),i=n===a,s={uuid:t.substring(0,8),byPlayer:n,localPlayer:a,isSelf:i},l=r.transform?.position,_=r.transform?.rotation;l&&(s.position={x:l.x.toFixed(2),y:l.y.toFixed(2),z:l.z.toFixed(2)}),_&&(s.rotation={x:_.x.toFixed(2),y:_.y.toFixed(2),z:_.z.toFixed(2)}),i?y.warn("Entity:updated received (SELF-BROADCAST)",s):y.debug("Entity:updated received (remote)",s);let c=E(t);if(!c){y.warn("Entity not found for update",{uuid:t});return}if(Object.assign(c,r),r.transform&&c.handle&&DoesEntityExist(c.handle)&&!i){let u=r.transform,b=GetEntityType(c.handle),v=b===1||b===2;if(v&&o&&(FreezeEntityPosition(c.handle,!0),y.debug("Temporarily froze entity for position apply",{handle:c.handle})),u.position&&(y.debug("Applying position to handle",{handle:c.handle,position:{x:u.position.x.toFixed(2),y:u.position.y.toFixed(2),z:u.position.z.toFixed(2)}}),SetEntityCoordsNoOffset(c.handle,u.position.x,u.position.y,u.position.z,!1,!1,!1)),u.rotation&&(y.debug("Applying rotation to handle",{handle:c.handle,rotation:{x:u.rotation.x.toFixed(2),y:u.rotation.y.toFixed(2),z:u.rotation.z.toFixed(2)}}),SetEntityRotation(c.handle,u.rotation.x,u.rotation.y,u.rotation.z,2,!1)),v&&o&&!c.frozen){FreezeEntityPosition(c.handle,!1);let C=GetEntityType(c.handle);C===2&&(ActivatePhysics(c.handle),SetVehicleGravity(c.handle,!0)),y.debug("Unfroze entity after position apply (drag end)",{handle:c.handle,entityType:C})}else v&&o&&c.frozen&&y.debug("Kept entity frozen after position apply (user preference)",{handle:c.handle,frozen:c.frozen});y.debug("Transform applied to entity",{uuid:t.substring(0,8),handle:c.handle,endDrag:o})}else r.transform&&!c.handle&&y.error("Cannot apply transform - entity has no handle",{uuid:t.substring(0,8),networkId:c.networkId??"none"});g("entity:updated",{uuid:t,changes:r}),r.transform&&sn(t)}function Ud(e){let{uuid:t,byPlayer:r}=e;y.debug("Entity deleted",{uuid:t,byPlayer:r});let{uuid:n}=an();n===t&&(y.debug("Deleted entity was selected, clearing selection"),We(),os()),no(t),g("entity:deleted",{uuid:t})}function Wd(e){let{uuid:t,lockedBy:r}=e;y.debug("Entity locked",{uuid:t,lockedBy:r}),ao(t,r),cs(t,r),g("entity:locked",e)}function zd(e){let{uuid:t}=e;y.debug("Entity unlocked",{uuid:t}),ao(t,null),_s(t),g("entity:unlocked",e)}async function qd(e){let{entities:t}=e;y.debug("Received entities:sync",{entityCount:t.length}),jr(t),g("entities:sync",{entities:t});let r=t.filter(n=>n.networkId!==null).map(n=>n.networkId);if(r.length>0){let n=await Kr(r,(o,a)=>{y.debug("Sync resolve progress",{resolved:o,total:a})});for(let o of n)if(o.success){let a=t.find(i=>i.networkId===o.networkId);a&&sr(a.uuid,o.handle)}}}function jd(e){let{entities:t}=e;y.debug("Received scene:positionsReset",{entityCount:t.length});for(let r of t){let n=E(r.uuid);if(!n){y.warn("Entity not found for position reset",{uuid:r.uuid.substring(0,8)});continue}n.transform.position=r.position,n.transform.rotation=r.rotation,n.handle&&DoesEntityExist(n.handle)&&(SetEntityCoordsNoOffset(n.handle,r.position.x,r.position.y,r.position.z,!1,!1,!1),SetEntityRotation(n.handle,r.rotation.x,r.rotation.y,r.rotation.z,2,!1),y.debug("Applied reset position to entity",{uuid:r.uuid.substring(0,8),position:{x:r.position.x.toFixed(2),y:r.position.y.toFixed(2),z:r.position.z.toFixed(2)}})),sn(r.uuid)}g("scene:positionsReset",{entities:t})}function $d(e){st()&&(y.debug("Scene status changed",{status:e.status}),g("scene:statusChanged",{status:e.status}))}function Kd(e){if(y.debug("Received camera sync request",{position:{x:e.position.x.toFixed(2),y:e.position.y.toFixed(2),z:e.position.z.toFixed(2)},heading:e.heading.toFixed(2)}),Kt()){let t={x:0,y:0,z:e.heading};hn(e.position,t),y.debug("Freecam camera synced to player position")}else y.debug("Freecam not active, skipping camera sync")}function Yd(e){y.error("Network error",{code:e.code,message:e.message}),g("error",e)}function Xd(e){let{networkId:t,position:r,rotation:n}=e;if(!t||!r){y.warn("ped:resurrect - missing networkId or position");return}let o=NetworkGetEntityFromNetworkId(t);if(!o||!DoesEntityExist(o)){y.debug("ped:resurrect - entity not found locally",{networkId:t});return}if(IsPedDeadOrDying(o,!1)){ResurrectPed(o),SetEntityHealth(o,200),ClearPedTasksImmediately(o),SetEntityCoordsNoOffset(o,r.x,r.y,r.z,!1,!1,!1),SetEntityRotation(o,n.x,n.y,n.z,2,!1);let a=Entity(o).state.ct_blockEvents;a!==void 0&&(SetBlockingOfNonTemporaryEvents(o,a),TaskSetBlockingOfNonTemporaryEvents(o,a),y.info("Restored blockEvents after resurrect",{handle:o,blockEvents:a})),y.info("Ped resurrected",{networkId:t,handle:o,position:r})}else y.debug("ped:resurrect - ped is not dead, skipping",{networkId:t,handle:o})}function Jd(e){let t=st();if(!t){y.warn("Ignoring environment update \u2014 not in a room",{key:e.key});return}y.debug("Environment updated",{key:e.key,value:e.value}),t.environment||(t.environment={}),t.environment[e.key]=e.value,ha(e.key,e.value),g("environment:updated",e)}function Zd(e){if(!e.relationships){y.warn("Received invalid faction update");return}y.debug("Received faction relationship update from server"),vr(e.relationships),g("factions:updated",{relationships:e.relationships})}function Qd(e){y.info("Entity saved to library",{name:e.name,type:e.entityType,model:e.model}),g("library:saved",e)}function eu(e){y.debug("Library fetched",{count:e.entries.length}),g("library:fetched",e)}function tu(e){y.debug("Library entry received"),qs(e.entry)}function ru(e){y.debug("Library entry deleted",{uuid:e.uuid}),g("library:deleted",e)}function nu(e){y.debug("Library entry renamed",{uuid:e.uuid,newName:e.newName}),g("library:renamed",e)}function ou(e){if(!ft(e.attachment)){y.warn("entity:attached - invalid attachment data",{uuid:e.uuid,attachment:e.attachment});return}let t=E(e.uuid);if(!t){y.warn("entity:attached - entity not found",{uuid:e.uuid});return}t.data={...t.data,attachment:e.attachment},y.info("Entity attached",{child:e.uuid.substring(0,8),parent:e.parentUuid.substring(0,8),byPlayer:e.byPlayer}),g("entity:attached",e)}function au(e){let t=E(e.uuid);if(!t){y.warn("entity:detached - entity not found",{uuid:e.uuid});return}t.data={...t.data,attachment:null},y.info("Entity detached",{uuid:e.uuid.substring(0,8),byPlayer:e.byPlayer}),g("entity:detached",e)}function Zs(){onNet("respoon:room:joined",Rd),onNet("respoon:room:left",Md),onNet("respoon:room:created",Dd),onNet("respoon:room:deleted",Vd),onNet("respoon:room:reset",Fd),onNet("respoon:room:list",Od),onNet("respoon:room:memberJoined",Ld),onNet("respoon:room:memberLeft",Bd),onNet("respoon:entities:sync",qd),onNet("respoon:entity:created",Gd),onNet("respoon:entity:updated",Hd),onNet("respoon:entity:deleted",Ud),onNet("respoon:entity:locked",Wd),onNet("respoon:entity:unlocked",zd),onNet("respoon:scene:positionsReset",jd),onNet("respoon:scene:statusChanged",$d),onNet("respoon:syncCameraToPlayer",Kd),onNet("respoon:error",Yd),onNet("respoon:environment:updated",Jd),onNet("factions:updated",Zd),onNet("respoon:entity:attached",ou),onNet("respoon:entity:detached",au),onNet("respoon:ped:resurrect",Xd),onNet("respoon:library:saved",Qd),onNet("respoon:library:fetched",eu),onNet("respoon:library:entry",tu),onNet("respoon:library:deleted",ru),onNet("respoon:library:renamed",nu),y.debug("Network listeners registered")}k();k();var N=m("NUI:Entity"),kn=null;function fa(){RegisterNuiCallback("entity:spawn",(e,t)=>{let{type:r,model:n,position:o,data:a}=e,i,s=0;if(o)i=o;else{let _=PlayerPedId(),[c,u,b]=GetOffsetFromEntityInWorldCoords(_,0,3,0);i={x:c,y:u,z:b},s=GetEntityHeading(_)}let l={position:i,rotation:{x:0,y:0,z:s}};N.debug("NUI spawn request",{type:r,model:n}),O("create",{type:r,model:n,transform:l,data:a}),t({success:!0})}),RegisterNuiCallback("entity:move",(e,t)=>{if(!e.handle||!DoesEntityExist(e.handle)){N.warn("entity:move - entity does not exist",{handle:e.handle}),t({success:!1,error:"Entity does not exist"});return}if(IsEntityAttached(e.handle)){t({success:!1,error:"Use entity:moveAttachment for attached entities"});return}if(t({success:!0}),e.position&&SetEntityCoordsNoOffset(e.handle,e.position.x,e.position.y,e.position.z,!1,!1,!1),e.rotation&&SetEntityRotation(e.handle,e.rotation.x,e.rotation.y,e.rotation.z,2,!1),kn!==e.handle){let r=GetEntityType(e.handle);(r===1||r===2)&&(FreezeEntityPosition(e.handle,!0),emitNet("respoon:entity:setFrozen",{uuid:e.uuid,frozen:!0}),N.debug("Froze entity for drag (broadcast)",{handle:e.handle,type:r})),kn=e.handle}}),RegisterNuiCallback("entity:update",(e,t)=>{if(N.debug("NUI update request",{uuid:e.uuid}),e.handle&&DoesEntityExist(e.handle)&&e.transform){let o=e.transform.position,a=e.transform.rotation;o&&(N.debug("Optimistic update",{uuid:e.uuid.substring(0,8),position:{x:o.x.toFixed(2),y:o.y.toFixed(2),z:o.z.toFixed(2)}}),SetEntityCoordsNoOffset(e.handle,o.x,o.y,o.z,!1,!1,!1)),a&&SetEntityRotation(e.handle,a.x,a.y,a.z,0,!1)}let r=E(e.uuid);if(r){if(e.transform&&Object.assign(r,{transform:e.transform}),e.data){let o=e.data;for(let i of rr)i in o&&(i==="alpha"?r.alpha=o[i]:i==="visible"?r.visible=o[i]:i==="collision"?r.collision=o[i]:i==="frozen"?r.frozen=o[i]:i==="invincible"?r.invincible=o[i]:i==="lodDistance"&&(r.lodDistance=o[i]));let a=Object.fromEntries(Object.entries(o).filter(([i])=>!Nr(i)));Object.keys(a).length>0&&(r.data={...r.data,...a})}r.updatedAt=Date.now(),N.debug("Updated local cache after optimistic update",{uuid:e.uuid.substring(0,8),hasTransform:!!e.transform,hasData:!!e.data,frozen:r.frozen})}let n=kn===e.handle;if(e.handle&&DoesEntityExist(e.handle)&&n){let o=GetEntityType(e.handle),a=E(e.uuid),i=!a?.frozen;(o===1||o===2)&&i?(FreezeEntityPosition(e.handle,!1),o===2&&(ActivatePhysics(e.handle),SetVehicleGravity(e.handle,!0)),N.debug("Unfroze entity locally after drag",{uuid:e.uuid,type:o})):(o===1||o===2)&&!i&&N.debug("Kept entity frozen after drag (user preference)",{uuid:e.uuid,frozen:a?.frozen})}kn=null,O("update",{...e,endDrag:n?!0:void 0}),t({success:!0})}),RegisterNuiCallback("entity:updateData",(e,t)=>{let{uuid:r,data:n}=e;if(!r||!n){N.warn("entity:updateData - missing uuid or data"),t({success:!1,error:"Missing uuid or data"});return}N.debug("NUI updateData request",{uuid:r.substring(0,8),properties:Object.keys(n)});let o=E(r);if(o){for(let i of rr)i in n&&(i==="alpha"?o.alpha=n[i]:i==="visible"?o.visible=n[i]:i==="collision"?o.collision=n[i]:i==="frozen"?o.frozen=n[i]:i==="invincible"?o.invincible=n[i]:i==="lodDistance"&&(o.lodDistance=n[i]));let a=Object.fromEntries(Object.entries(n).filter(([i])=>!Nr(i)));Object.keys(a).length>0&&(o.data={...o.data,...a}),o.updatedAt=Date.now(),N.debug("Updated local cache with data properties",{uuid:r.substring(0,8)})}O("update",{uuid:r,data:n}),t({success:!0})}),RegisterNuiCallback("entity:delete",(e,t)=>{N.debug("NUI delete request",{uuid:e.uuid}),O("delete",e),t({success:!0})}),RegisterNuiCallback("entity:lock",(e,t)=>{N.debug("NUI lock request",{uuid:e.uuid}),O("lock",e),t({success:!0})}),RegisterNuiCallback("entity:unlock",(e,t)=>{N.debug("NUI unlock request",{uuid:e.uuid}),O("unlock",e),t({success:!0})}),RegisterNuiCallback("entity:clone",(e,t)=>{N.debug("NUI clone request",{uuid:e.uuid}),O("clone",e),t({success:!0})}),RegisterNuiCallback("entity:snapToGround",(e,t)=>{let{uuid:r,handle:n}=e;if(N.debug("NUI snap to ground request",{uuid:r,handle:n}),!n||!DoesEntityExist(n)){N.warn("entity:snapToGround - entity does not exist",{handle:n}),t({success:!1,error:"Entity does not exist"});return}let o=GetEntityType(n),a=GetEntityRotation(n,2),i={x:a[0],y:a[1],z:a[2]},s;if(o===3){if(!PlaceObjectOnGroundProperly(n)){N.warn("entity:snapToGround - PlaceObjectOnGroundProperly failed",{handle:n}),t({success:!1,error:"Could not place object on ground"});return}let c=GetEntityCoords(n,!1);s={x:c[0],y:c[1],z:c[2]},N.debug("Snapped object to ground using PlaceObjectOnGroundProperly",{uuid:r.substring(0,8),newZ:s.z.toFixed(2)})}else{let _=GetEntityCoords(n,!1),c=_[0],u=_[1],b=_[2],[v,C]=GetGroundZFor_3dCoord(c,u,b+5,!1);if(!v){N.warn("entity:snapToGround - could not find ground",{x:c,y:u,z:b}),t({success:!1,error:"Could not find ground at entity position"});return}s={x:c,y:u,z:C},SetEntityCoordsNoOffset(n,s.x,s.y,s.z,!1,!1,!1),N.debug("Snapped entity to ground",{uuid:r.substring(0,8),type:o===1?"ped":"vehicle",oldZ:b.toFixed(2),newZ:C.toFixed(2)})}let l=E(r);l&&Object.assign(l,{transform:{position:s,rotation:i},updatedAt:Date.now()}),O("update",{uuid:r,transform:{position:s,rotation:i}}),t({success:!0,newZ:s.z})}),RegisterNuiCallback("entity:claim",(e,t)=>{let{handle:r,entityInfo:n}=e;if(!n.isNetworked||n.networkId===null){N.warn("Cannot claim entity - not networked",{handle:r}),t({success:!1,error:"Entity is not networked"});return}let a={1:"ped",2:"vehicle",3:"prop"}[n.entityType];if(!a){N.warn("Cannot claim entity - unknown type",{entityTypeId:n.entityType}),t({success:!1,error:"Unknown entity type"});return}N.debug("NUI claim request",{handle:r,model:n.modelName,type:a}),O("claim",{handle:r,modelName:n.modelName||`0x${n.model.toString(16).toUpperCase()}`,modelHash:n.model,entityType:a,transform:{position:n.position,rotation:n.rotation},entityInfo:n}),t({success:!0})}),RegisterNuiCallback("player:replicate",(e,t)=>{let r=PlayerPedId(),n=GetEntityModel(r),o=GetHashKey("mp_m_freemode_01"),a=GetHashKey("mp_f_freemode_01"),i,s=!1;if(n===o?(i="mp_m_freemode_01",s=!0):n===a?(i="mp_f_freemode_01",s=!0):i=`0x${(n>>>0).toString(16).toUpperCase()}`,N.info("Replicating player",{model:i}),IsPedDeadOrDying(r,!0)){N.warn("player:replicate - Player is dead"),t({success:!1,error:"Cannot replicate dead player"});return}let l=nr(r);if(!l){N.error("player:replicate - Failed to extract ped info"),t({success:!1,error:"Failed to extract appearance"});return}let _=GetFinalRenderedCamCoord(),u=GetFinalRenderedCamRot(2)[2],b=u*Math.PI/180,v=3,C=_[0]-Math.sin(b)*v,R=_[1]+Math.cos(b)*v,M=_[2],f={drawables:l.drawables,props:l.props,headBlend:l.headBlend,faceFeatures:l.faceFeatures,hairColor:l.hairColor,hairHighlight:l.hairHighlight,eyeColor:l.eyeColor,headOverlays:l.headOverlays};O("create",{type:"ped",model:i,transform:{position:{x:C,y:R,z:M},rotation:{x:0,y:0,z:u}},data:f}),t({success:!0})}),RegisterNuiCallback("entity:saveToLibrary",(e,t)=>{let{uuid:r,name:n}=e;if(!r||!n){N.warn("entity:saveToLibrary - missing uuid or name"),t({success:!1,error:"Missing uuid or name"});return}N.info("Saving entity to library",{uuid:r.substring(0,8),name:n}),emitNet("respoon:library:save",{uuid:r,name:n}),t({success:!0})}),N.debug("Entity callbacks registered")}k();function Cr(e,t){let r=t?.distance??5,n=t?.heightOffset??3,o,a;if(t?.heading!==void 0){let i=t.heading*Math.PI/180;o={x:e.x-Math.sin(i)*r,y:e.y-Math.cos(i)*r,z:e.z+n},a={x:-10,y:0,z:t.heading}}else{o={x:e.x,y:e.y-r,z:e.z+n};let i=e.x-o.x,s=e.y-o.y,l=e.z-o.z,_=Math.sqrt(i*i+s*s),c=Math.atan2(l,_)*(180/Math.PI),u=Math.atan2(-s,i)*(180/Math.PI)+90;a={x:c,y:0,z:u}}hn(o,a)}var Ye=m("NUI:Selection");function ba(){RegisterNuiCallback("selection:selectHovered",(e,t)=>{Ye.debug("NUI select hovered request"),rs(),t({success:!0})}),RegisterNuiCallback("selection:clear",(e,t)=>{Ye.debug("NUI clear selection request"),_t(),t({success:!0})}),RegisterNuiCallback("entity:selectByUuid",(e,t)=>{let{uuid:r}=e;Ye.debug("NUI select by UUID request",{uuid:r}),ns(r),t({success:!0})}),RegisterNuiCallback("entity:focus",(e,t)=>{let{uuid:r}=e;Ye.debug("NUI focus entity request",{uuid:r});let n=E(r);if(!n){Ye.warn("Cannot focus - entity not found in cache",{uuid:r}),t({success:!1,error:"Entity not found"});return}let o=n.handle;if(!o||!DoesEntityExist(o)){let s=n.transform?.position;if(!s){Ye.warn("Cannot focus - entity has no position",{uuid:r}),t({success:!1,error:"Entity has no position"});return}Ye.debug("Using stored position (entity not spawned)",{uuid:r}),Cr(s),t({success:!0});return}let a=GetEntityCoords(o,!1),i={x:a[0],y:a[1],z:a[2]};Ye.debug("Focusing camera on entity at actual position",{position:{x:i.x.toFixed(2),y:i.y.toFixed(2),z:i.z.toFixed(2)},handle:o}),Cr(i),t({success:!0})}),Ye.debug("Selection callbacks registered")}k();var Xe=m("NUI:Room");function ka(){RegisterNuiCallback("room:join",(e,t)=>{Xe.debug("NUI room join request",{roomId:e.roomId}),At(),ct("join",e.roomId),t({success:!0})}),RegisterNuiCallback("room:leave",(e,t)=>{Xe.debug("NUI room leave request"),ct("leave"),t({success:!0})}),RegisterNuiCallback("room:create",(e,t)=>{Xe.debug("NUI room create request",{name:e.name}),ct("create",e),t({success:!0})}),RegisterNuiCallback("room:list",(e,t)=>{Xe.debug("NUI room list request",{filter:e.filter||"public"}),ct("list",e),t({success:!0})}),RegisterNuiCallback("room:current",(e,t)=>{let r=st(),n=lr();Xe.debug("NUI room:current request",{roomName:r?.name||"none"}),t({room:r,playerIdentifier:n})}),RegisterNuiCallback("room:requestSync",(e,t)=>{Xe.debug("NUI requesting room resync from server"),emitNet("respoon:room:requestCurrent"),t({success:!0})}),RegisterNuiCallback("room:delete",(e,t)=>{Xe.debug("NUI room delete request",{roomId:e.roomId}),ct("delete",e),t({success:!0})}),RegisterNuiCallback("room:reset",(e,t)=>{Xe.debug("NUI room reset request"),ct("reset"),t({success:!0})}),Xe.debug("Room callbacks registered")}k();var Je=m("NUI:Models"),el="respoon_browser_favorites",iu=100;function va(){let e=GetResourceKvpString(el);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function Qs(e){SetResourceKvp(el,JSON.stringify(e))}function vn(e){return e.type==="particle"?`particle:${e.dictionary}/${e.effect}`:`${e.type}:${e.modelName}`}function Ca(){RegisterNuiCallback("models:fetch",(e,t)=>{Je.debug("NUI models:fetch",{type:e.type,search:e.search??"",limit:e.limit??100}),emitNet("ct:models:fetch",e),t({success:!0})}),RegisterNuiCallback("models:categories",(e,t)=>{Je.debug("NUI models:categories",{type:e.type}),emitNet("ct:models:categories",e),t({success:!0})}),onNet("ct:models:result",e=>{Je.debug("models:result received",{count:e.models.length}),g("models:result",e)}),onNet("ct:models:categoriesResult",e=>{Je.debug("models:categoriesResult received",{count:e.categories.length}),g("models:categoriesResult",e)}),RegisterNuiCallback("browser:favorites:get",(e,t)=>{let r=va();Je.debug("Browser favorites get",{count:r.length}),t({success:!0,favorites:r})}),RegisterNuiCallback("browser:favorites:add",(e,t)=>{let r=va(),n=vn(e);if(r.some(a=>vn(a)===n)){Je.debug("Browser favorite already exists",{key:n}),t({success:!0,favorites:r});return}r.length>=iu&&r.shift(),r.push({type:e.type,modelName:e.modelName,modelHash:e.modelHash,dictionary:e.dictionary,effect:e.effect,label:e.label,addedAt:Date.now()}),Qs(r),Je.info("Browser favorite added",{key:n}),t({success:!0,favorites:r})}),RegisterNuiCallback("browser:favorites:remove",(e,t)=>{let r=va(),n=vn(e);r=r.filter(o=>vn(o)!==n),Qs(r),Je.info("Browser favorite removed",{key:n}),t({success:!0,favorites:r})}),Je.debug("Model callbacks registered")}k();var Y=m("NUI:Particle");function xa(){RegisterNuiCallback("particle:spawn",(e,t)=>{let{dictionary:r,effect:n,position:o,alpha:a}=e;if(!r||!n){Y.warn("particle:spawn - missing dictionary or effect",{dictionary:r,effect:n}),t({success:!1,error:"Dictionary and effect are required"});return}let i,s={x:0,y:0,z:0};if(o)i=o;else{let _=PlayerPedId(),[c,u,b]=GetOffsetFromEntityInWorldCoords(_,0,3,0);i={x:c,y:u,z:b},s.z=GetEntityHeading(_)}let l={position:i,rotation:s};Y.debug("NUI spawn particle request",{effect:`${r}/${n}`,position:{x:i.x.toFixed(2),y:i.y.toFixed(2),z:i.z.toFixed(2)}}),emitNet("respoon:particle:create",{dictionary:r,effect:n,transform:l,alpha:a}),t({success:!0})}),RegisterNuiCallback("particle:selectByUuid",(e,t)=>{let{uuid:r}=e;if(Y.debug("NUI select particle by UUID",{uuid:r}),!Ve(r)){Y.warn("Cannot select - particle not found in cache",{uuid:r}),t({success:!1,error:"Particle not found"});return}is(r),emitNet("respoon:particle:lock",{uuid:r}),g("particle:selected",{uuid:r}),t({success:!0})}),RegisterNuiCallback("particle:focus",(e,t)=>{let{uuid:r}=e;Y.debug("NUI focus particle request",{uuid:r});let n=Ve(r);if(!n){Y.warn("Cannot focus - particle not found in cache",{uuid:r}),t({success:!1,error:"Particle not found"});return}let o=n.transform?.position;if(!o){Y.warn("Cannot focus - particle has no position",{uuid:r}),t({success:!1,error:"Particle has no position"});return}Y.debug("Focusing camera on particle",{uuid:r.substring(0,8),position:{x:o.x.toFixed(2),y:o.y.toFixed(2),z:o.z.toFixed(2)}}),Cr(o),t({success:!0})}),RegisterNuiCallback("particle:delete",(e,t)=>{let{uuid:r}=e;Y.debug("NUI delete particle request",{uuid:r}),emitNet("respoon:particle:delete",{uuid:r}),t({success:!0})}),RegisterNuiCallback("particle:update",(e,t)=>{let{uuid:r,alpha:n,transform:o}=e;Y.debug("NUI update particle request",{uuid:r,alpha:n,hasTransform:!!o}),(o||n!==void 0)&&bn(r,o,n),emitNet("respoon:particle:update",{uuid:r,alpha:n,transform:o}),t({success:!0})}),RegisterNuiCallback("particle:unlock",(e,t)=>{let{uuid:r}=e;Y.debug("NUI unlock particle request",{uuid:r}),emitNet("respoon:particle:unlock",{uuid:r}),t({success:!0})}),RegisterNuiCallback("particle:clone",(e,t)=>{Y.debug("NUI clone particle request",{uuid:e.uuid}),emitNet("respoon:particle:clone",{uuid:e.uuid}),t({success:!0})}),RegisterNuiCallback("particle:snapToGround",(e,t)=>{let{uuid:r}=e;Y.debug("NUI snap particle to ground request",{uuid:r});let n=Ve(r);if(!n){Y.warn("particle:snapToGround - particle not found in cache",{uuid:r}),t({success:!1,error:"Particle not found"});return}let o=n.transform?.position;if(!o){Y.warn("particle:snapToGround - particle has no position",{uuid:r}),t({success:!1,error:"Particle has no position"});return}let[a,i]=GetGroundZFor_3dCoord(o.x,o.y,o.z+5,!1);if(!a){Y.warn("particle:snapToGround - could not find ground",{x:o.x,y:o.y,z:o.z}),t({success:!1,error:"Could not find ground at particle position"});return}let s={position:{x:o.x,y:o.y,z:i},rotation:n.transform.rotation};Y.debug("Snapping particle to ground",{uuid:r.substring(0,8),oldZ:o.z.toFixed(2),newZ:i.toFixed(2)}),bn(r,s,void 0),emitNet("respoon:particle:update",{uuid:r,transform:s}),g("gizmo:updatePosition",{uuid:r,position:s.position,rotation:s.rotation}),t({success:!0,newZ:i})}),Y.debug("Particle callbacks registered")}k();bt();k();var Ta=5,su=.7,lu=1,cu=50,Sa=.1,be=-1,Cn="",xn="",xr=-1,Ft={x:0,y:0,z:0},wa=0,Oe=m("ParticlePreview");function tl(){let e=dt(),t=Se(),{forward:r}=Gt(t);return{x:e.x+r.x*Ta,y:e.y+r.y*Ta,z:e.z+r.z*Ta}}function Ea(){let e=Se();return{x:e.x,y:e.y,z:e.z+180}}function _u(e){let t=Math.abs(e.x-Ft.x),r=Math.abs(e.y-Ft.y),n=Math.abs(e.z-Ft.z);return t>Sa||r>Sa||n>Sa}async function du(e){RequestNamedPtfxAsset(e);let t=GetGameTimer()+5e3;for(;!HasNamedPtfxAssetLoaded(e);){if(GetGameTimer()>t)return Oe.warn("Particle asset load timeout",{dictionary:e}),!1;await new Promise(r=>setTimeout(r,0))}return!0}function rl(e,t){UseParticleFxAsset(Cn);let r=StartParticleFxLoopedAtCoord(xn,e.x,e.y,e.z,t.x,t.y,t.z,lu,!1,!1,!1,!1);return r>0&&SetParticleFxLoopedAlpha(r,su),r}function nl(){be>0&&DoesParticleFxLoopedExist(be)&&(StopParticleFxLooped(be,!1),RemoveParticleFx(be,!1)),be=-1}function uu(){let e=GetGameTimer();if(e-wa<cu)return;wa=e;let t=tl();if(_u(t)){nl();let r=Ea();be=rl(t,r),Ft=t,be<=0&&Oe.warn("Failed to spawn preview particle during tick")}}async function ol(e,t){if(il()&&(Oe.debug("Stopping existing particle preview before starting new one"),Tn()),Oe.debug("Starting particle preview",{dictionary:e,effect:t}),!await du(e))return Oe.warn("Failed to load particle asset",{dictionary:e}),!1;Cn=e,xn=t;let n=tl(),o=Ea();return Ft=n,wa=GetGameTimer(),be=rl(n,o),be<=0?(Oe.warn("Failed to spawn preview particle",{dictionary:e,effect:t}),!1):(xr=setTick(uu),Oe.debug("Particle preview started",{handle:be,tickId:xr}),!0)}function Tn(){xr!==-1&&(clearTick(xr),xr=-1),nl(),Cn="",xn="",Ft={x:0,y:0,z:0},Oe.debug("Particle preview stopped")}function al(){if(!il())return Oe.warn("Cannot confirm: no particle preview active"),null;let e={dictionary:Cn,effect:xn,position:{...Ft},rotation:Ea()};return Oe.debug("Particle preview confirmed",{effect:`${e.dictionary}/${e.effect}`,position:e.position}),Tn(),e}function il(){return be>0&&DoesParticleFxLoopedExist(be)}var Tr=m("NUI:ParticlePreview");function Pa(){RegisterNuiCallback("particlePreview:start",async(e,t)=>{let{dictionary:r,effect:n}=e;Tr.debug("NUI particlePreview:start",{dictionary:r,effect:n});let o=await ol(r,n);o&&g("particlePreview:started",{dictionary:r,effect:n}),t({success:o})}),RegisterNuiCallback("particlePreview:cancel",(e,t)=>{Tr.debug("NUI particlePreview:cancel"),Tn(),g("particlePreview:cancelled",{}),t({success:!0})}),RegisterNuiCallback("particlePreview:confirm",(e,t)=>{Tr.debug("NUI particlePreview:confirm");let r=al();if(!r){Tr.warn("No active particle preview to confirm"),t({success:!1,error:"No active particle preview"});return}g("particlePreview:confirmed",{});let n={position:r.position,rotation:r.rotation};emitNet("respoon:particle:create",{dictionary:r.dictionary,effect:r.effect,transform:n}),t({success:!0})}),Tr.debug("Particle preview callbacks registered")}k();var G=m("NUI:PedControl"),Sn=new Map,mu=0;function me(){return`step-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function pe(){return`seq-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function pu(){return`req-${++mu}-${Date.now()}`}function H(e,t){return new Promise(r=>{let n=pu(),o=setTimeout(()=>{Sn.delete(n),r({success:!1,error:"Request timed out"})},5e3);Sn.set(n,{resolve:r,timeout:o}),emitNet("respoon:task:assign",{uuid:e,sequence:t,requestId:n})})}function Aa(){RegisterNuiCallback("pedControl:goToPlayer",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=PlayerPedId(),[i,s,l]=GetEntityCoords(a,!1),_={id:me(),type:"goToCoord",target:{x:i,y:s,z:l},speed:1,distanceToStop:1.5},c={id:pe(),name:"Go To Player",steps:[_],mode:"once"};G.debug("Assigning goToPlayer sequence",{uuid:o.substring(0,8),target:{x:i,y:s,z:l}});let u=await H(o,c);n(u)}),RegisterNuiCallback("pedControl:wander",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=PlayerPedId(),[i,s,l]=GetEntityCoords(a,!1),_={id:me(),type:"wander",center:{x:i,y:s,z:l},radius:10,duration:3e4},c={id:pe(),name:"Wander",steps:[_],mode:"loop"};G.debug("Assigning wander sequence",{uuid:o.substring(0,8),center:{x:i,y:s,z:l}});let u=await H(o,c);n(u)}),RegisterNuiCallback("pedControl:wait",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"wait",duration:5e3},i={id:pe(),name:"Wait",steps:[a],mode:"once"};G.debug("Assigning wait sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:handsUp",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"handsUp",duration:5e3},i={id:pe(),name:"Hands Up",steps:[a],mode:"once"};G.debug("Assigning handsUp sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:flee",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"flee",fleeDistance:100,duration:1e4},i={id:pe(),name:"Flee",steps:[a],mode:"once"};G.debug("Assigning flee sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:combat",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"combat",duration:3e4},i={id:pe(),name:"Combat",steps:[a],mode:"once"};G.debug("Assigning combat sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:clear",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"clearTasks"},i={id:pe(),name:"Clear Tasks",steps:[a],mode:"once"};G.debug("Assigning clearTasks sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:setBehaviorPassive",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=Lr.passive,i={id:me(),type:"setBehavior",alertness:a.alertness,combatAbility:a.combatAbility,combatMovement:a.combatMovement,combatRange:a.combatRange,seeingRange:a.seeingRange,hearingRange:a.hearingRange,targetLossResponse:a.targetLossResponse},s={id:pe(),name:"Set Behavior (Passive)",steps:[i],mode:"once"};G.debug("Assigning setBehavior (passive) sequence",{uuid:o.substring(0,8)});let l=await H(o,s);n(l)}),RegisterNuiCallback("pedControl:setBehaviorDefensive",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=Lr.defensive,i={id:me(),type:"setBehavior",alertness:a.alertness,combatAbility:a.combatAbility,combatMovement:a.combatMovement,combatRange:a.combatRange,seeingRange:a.seeingRange,hearingRange:a.hearingRange,targetLossResponse:a.targetLossResponse},s={id:pe(),name:"Set Behavior (Defensive)",steps:[i],mode:"once"};G.debug("Assigning setBehavior (defensive) sequence",{uuid:o.substring(0,8)});let l=await H(o,s);n(l)}),RegisterNuiCallback("pedControl:setBehaviorAggressive",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=Lr.aggressive,i={id:me(),type:"setBehavior",alertness:a.alertness,combatAbility:a.combatAbility,combatMovement:a.combatMovement,combatRange:a.combatRange,seeingRange:a.seeingRange,hearingRange:a.hearingRange,targetLossResponse:a.targetLossResponse},s={id:pe(),name:"Set Behavior (Aggressive)",steps:[i],mode:"once"};G.debug("Assigning setBehavior (aggressive) sequence",{uuid:o.substring(0,8)});let l=await H(o,s);n(l)}),RegisterNuiCallback("pedControl:clearBehavior",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a={id:me(),type:"clearBehavior"},i={id:pe(),name:"Clear Behavior",steps:[a],mode:"once"};G.debug("Assigning clearBehavior sequence",{uuid:o.substring(0,8)});let s=await H(o,i);n(s)}),RegisterNuiCallback("pedControl:setBlockEvents",(r,n)=>{let{uuid:o,blockEvents:a}=r;if(!o){n({success:!1,error:"No UUID provided"});return}emitNet("respoon:ped:setBlockEvents",{uuid:o,blockEvents:a}),G.debug("Setting blockEvents",{uuid:o.substring(0,8),blockEvents:a}),n({success:!0})});function e(r,n){let o={id:me(),type:"scenario",scenarioName:n,duration:3e4};return{id:pe(),name:r,steps:[o],mode:"once"}}RegisterNuiCallback("pedControl:scenarioCoffee",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Coffee","WORLD_HUMAN_COFFEE_DRINK");G.debug("Assigning scenarioCoffee sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:scenarioClipboard",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Clipboard","WORLD_HUMAN_CLIPBOARD");G.debug("Assigning scenarioClipboard sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:scenarioSmoking",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Smoking","WORLD_HUMAN_SMOKING");G.debug("Assigning scenarioSmoking sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:scenarioGuard",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Guard","WORLD_HUMAN_GUARD_STAND");G.debug("Assigning scenarioGuard sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:scenarioLean",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Lean","WORLD_HUMAN_LEAN_WALL");G.debug("Assigning scenarioLean sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:scenarioSit",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=e("Sit","WORLD_HUMAN_SIT_BENCH");G.debug("Assigning scenarioSit sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)});function t(r,n,o,a){let i={id:me(),type:"animation",dictionary:n,name:o,duration:a};return{id:pe(),name:r,steps:[i],mode:"once"}}RegisterNuiCallback("pedControl:animationWave",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Wave","anim@mp_player_intcelebrationmale@wave","wave",3e3);G.debug("Assigning animationWave sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:animationPoint",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Point","gestures@m@standing@casual","gesture_point",2e3);G.debug("Assigning animationPoint sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:animationSalute",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Salute","anim@mp_player_intcelebrationmale@salute","salute",3e3);G.debug("Assigning animationSalute sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:animationSurrender",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Surrender","random@arrests","idle_2_hands_up",5e3);G.debug("Assigning animationSurrender sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:animationCower",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Cower","amb@code_human_cower@male@react_cowering","base_front",5e3);G.debug("Assigning animationCower sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),RegisterNuiCallback("pedControl:animationCheer",async(r,n)=>{let{uuid:o}=r;if(!o){n({success:!1,error:"No UUID provided"});return}let a=t("Cheer","anim@mp_player_intcelebrationmale@thumbs_up","thumbs_up",3e3);G.debug("Assigning animationCheer sequence",{uuid:o.substring(0,8)});let i=await H(o,a);n(i)}),onNet("respoon:task:assignResult",r=>{let n=Sn.get(r.requestId);n&&(clearTimeout(n.timeout),Sn.delete(r.requestId),n.resolve({success:r.success,error:r.error}),G.debug("Task assign result received",{requestId:r.requestId,success:r.success}))}),G.debug("Ped control callbacks registered")}k();var wn=m("NUI:Subscription");function Ia(){RegisterNuiCallback("subscription:subscribe",(e,t)=>{wn.debug("Subscribe request",{channel:e.channel,handle:e.entityHandle});let r=Xi(e);t({success:r})}),RegisterNuiCallback("subscription:unsubscribe",(e,t)=>{wn.debug("Unsubscribe request",{channel:e.channel}),Ji(e.channel),t({success:!0})}),RegisterNuiCallback("subscription:unsubscribeAll",(e,t)=>{wn.debug("Unsubscribe all request"),_r(),t({success:!0})}),wn.debug("Subscription callbacks registered")}k();Ra();var Le=m("NUI:Scene");function Ma(){RegisterNuiCallback("scene:stopTasks",(e,t)=>{Le.debug("NUI scene:stopTasks request"),emitNet("respoon:scene:stopTasks"),t({success:!0})}),RegisterNuiCallback("scene:startTasks",(e,t)=>{Le.debug("NUI scene:startTasks request"),emitNet("respoon:scene:startTasks"),t({success:!0})}),RegisterNuiCallback("scene:playFromStart",(e,t)=>{Le.debug("NUI scene:playFromStart request"),emitNet("respoon:scene:playFromStart"),t({success:!0})}),RegisterNuiCallback("scene:resetPositions",(e,t)=>{Le.debug("NUI scene:resetPositions request"),emitNet("respoon:scene:resetPositions"),t({success:!0})}),RegisterNuiCallback("scene:assignSequence",(e,t)=>{Le.debug("NUI scene:assignSequence request",{sequenceName:e.sequence?.name}),emitNet("respoon:scene:assignSequence",{sequence:e.sequence}),t({success:!0})}),RegisterNuiCallback("scene:clearAllTasks",(e,t)=>{Le.debug("NUI scene:clearAllTasks request"),emitNet("respoon:scene:clearAllTasks"),t({success:!0})}),RegisterNuiCallback("scene:teleportHome",(e,t)=>{Le.debug("NUI scene:teleportHome request"),emitNet("respoon:scene:teleportHome"),t({success:!0})}),RegisterNuiCallback("scene:startRecording",(e,t)=>{Le.debug("NUI scene:startRecording request - closing editor first"),emit("respoon:client:startRecordingFlow"),t({success:!0})}),RegisterNuiCallback("scene:enterEditor",(e,t)=>{Le.debug("NUI scene:enterEditor request"),Na(),t({success:!0})}),Le.debug("Scene callbacks registered (stopTasks, startTasks, playFromStart, resetPositions, assignSequence, clearAllTasks, teleportHome, startRecording, enterEditor)")}k();var oe=m("NUI:TaskBuilder"),te=new Map,bu=0,Da=new Map,ku=300;function Pn(){return`tb-req-${++bu}-${Date.now()}`}function Va(){RegisterNuiCallback("taskBuilder:load",(e,t)=>{let{uuid:r,handle:n}=e;if(!r){t({success:!1,sequence:null,error:"No UUID provided"});return}if(n&&DoesEntityExist(n)){let l=Entity(n).state.ct_taskState;if(l?.sequence){oe.debug("Loaded sequence from state bag",{uuid:r.substring(0,8),mode:l.sequence.mode}),t({success:!0,sequence:l.sequence});return}}oe.debug("No state bag sequence, requesting from server",{uuid:r.substring(0,8)});let o=`load-${r}-${Date.now()}`,a=s=>{s.requestId===o&&(removeEventListener("respoon:task:loadResult",a),s.success?(oe.debug("Loaded sequence from database",{uuid:r.substring(0,8),hasSequence:!!s.sequence}),t({success:!0,sequence:s.sequence})):(oe.debug("No sequence in database",{uuid:r.substring(0,8),error:s.error}),t({success:!0,sequence:null})))},i=setTimeout(()=>{removeEventListener("respoon:task:loadResult",a),oe.warn("Load from server timed out",{uuid:r.substring(0,8)}),t({success:!0,sequence:null})},3e3);onNet("respoon:task:loadResult",s=>{s.requestId===o&&(clearTimeout(i),a(s))}),emitNet("respoon:task:load",{uuid:r,requestId:o})}),RegisterNuiCallback("taskBuilder:save",(e,t)=>{let{uuid:r,sequence:n}=e;if(!r){t({success:!1,error:"No UUID provided"});return}if(!n){t({success:!1,error:"No sequence provided"});return}if(!n.steps||n.steps.length===0){t({success:!1,error:"Sequence has no steps"});return}let o=Pn(),a=setTimeout(()=>{te.delete(o),t({success:!1,error:"Request timed out"})},5e3);te.set(o,{resolve:t,timeout:a}),emitNet("respoon:task:assign",{uuid:r,sequence:n,requestId:o}),oe.debug("Saving sequence via taskBuilder",{uuid:r.substring(0,8),sequenceName:n.name,stepCount:n.steps.length})}),onNet("respoon:task:assignResult",e=>{let t=te.get(e.requestId);t&&(clearTimeout(t.timeout),te.delete(e.requestId),t.resolve({success:e.success,error:e.error}),oe.debug("Task builder save result received",{requestId:e.requestId,success:e.success}))}),RegisterNuiCallback("taskBuilder:restart",(e,t)=>{let{uuid:r}=e;if(!r){t({success:!1,error:"No UUID provided"});return}let n=Pn(),o=setTimeout(()=>{te.delete(n),t({success:!1,error:"Request timed out"})},5e3);te.set(n,{resolve:t,timeout:o}),emitNet("respoon:task:restart",{uuid:r,requestId:n}),oe.debug("Restarting task sequence",{uuid:r.substring(0,8)})}),onNet("respoon:task:restartResult",e=>{let t=te.get(e.requestId);t&&(clearTimeout(t.timeout),te.delete(e.requestId),t.resolve({success:e.success,error:e.error}),oe.debug("Task restart result received",{requestId:e.requestId,success:e.success}))}),RegisterNuiCallback("taskBuilder:reset",(e,t)=>{let{uuid:r}=e;if(!r){t({success:!1,error:"No UUID provided"});return}let n=Pn(),o=setTimeout(()=>{te.delete(n),t({success:!1,error:"Request timed out"})},5e3);te.set(n,{resolve:t,timeout:o}),emitNet("respoon:task:reset",{uuid:r,requestId:n}),oe.debug("Resetting task sequence",{uuid:r.substring(0,8)})}),onNet("respoon:task:resetResult",e=>{let t=te.get(e.requestId);t&&(clearTimeout(t.timeout),te.delete(e.requestId),t.resolve({success:e.success,error:e.error}),oe.debug("Task reset result received",{requestId:e.requestId,success:e.success}))}),RegisterNuiCallback("taskBuilder:stop",(e,t)=>{let{uuid:r}=e;if(!r){t({success:!1,error:"No UUID provided"});return}let n=Pn(),o=setTimeout(()=>{te.delete(n),t({success:!1,error:"Request timed out"})},5e3);te.set(n,{resolve:t,timeout:o}),emitNet("respoon:task:stop",{uuid:r,requestId:n}),oe.debug("Stopping task sequence",{uuid:r.substring(0,8)})}),onNet("respoon:task:stopResult",e=>{let t=te.get(e.requestId);t&&(clearTimeout(t.timeout),te.delete(e.requestId),t.resolve({success:e.success,error:e.error}),oe.debug("Task stop result received",{requestId:e.requestId,success:e.success}))}),RegisterNuiCallback("config:persist",(e,t)=>{let{uuid:r,handle:n,properties:o}=e;if(!r){t({success:!1,error:"No UUID provided"});return}let a=Da.get(r);a&&clearTimeout(a);let i=setTimeout(()=>{Da.delete(r),oe.debug("Persisting config properties",{uuid:r.substring(0,8),hasProperties:!!o,keys:o?Object.keys(o):[]}),emitNet("respoon:config:persist",{uuid:r,properties:o}),t({success:!0})},ku);Da.set(r,i)}),oe.debug("Task builder callbacks registered")}k();var Ot=m("NUI:Tool"),Qt={activeTool:"none"};function Fa(){RegisterNuiCallback("tool:activate",(e,t)=>{let{type:r,filter:n,hideGizmo:o}=e;Ot.info("Tool activation request",{type:r,filter:n,hideGizmo:o}),Qt={activeTool:r,filter:n,hideGizmo:o},Ot.info("Tool activated",Qt),t({success:!0})}),RegisterNuiCallback("tool:deactivate",(e,t)=>{Ot.info("Tool deactivation request");let r=Qt.activeTool;Qt={activeTool:"none"},Ot.info("Tool deactivated",{previousTool:r}),t({success:!0})}),RegisterNuiCallback("tool:cancel",(e,t)=>{Ot.info("Tool cancel request");let r=Qt.activeTool;Qt={activeTool:"none"},Ot.info("Tool cancelled",{previousTool:r}),t({success:!0})}),Ot.debug("Tool callbacks registered")}k();var An=m("NUI:FactionManager");function Oa(){RegisterNuiCallback("factionManager:save",(e,t)=>{try{if(!e.relationships){An.error("Save failed: missing relationships"),t({success:!1,error:"Missing relationships data"});return}vr(e.relationships),emitNet("respoon:factions:update",e.relationships),An.info("Faction relationships saved and applied"),t({success:!0})}catch(r){let n=r instanceof Error?r.message:"Unknown error";An.error("Save failed",{error:n}),t({success:!1,error:n})}}),An.debug("Faction manager callbacks registered")}k();var Ae=m("NUI:Animations"),cl="respoon_animation_favorites",vu=50;function La(){let e=GetResourceKvpString(cl);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function ll(e){SetResourceKvp(cl,JSON.stringify(e))}function Ba(){RegisterNuiCallback("animations:search",(e,t)=>{Ae.debug("NUI animations:search",{query:e.query,limit:e.limit,offset:e.offset}),emitNet("ct:animations:search",e),t({success:!0})}),RegisterNuiCallback("animations:favorites:get",(e,t)=>{let r=La();Ae.debug("Favorites get",{count:r.length}),t({success:!0,favorites:r})}),RegisterNuiCallback("animations:favorites:add",(e,t)=>{let r=La();if(r.some(o=>o.dictName===e.dictName&&o.clipName===e.clipName)){Ae.debug("Favorite already exists",{dict:e.dictName,clip:e.clipName}),t({success:!0,favorites:r});return}r.length>=vu&&r.shift(),r.push({dictName:e.dictName,clipName:e.clipName,label:e.label,addedAt:Date.now()}),ll(r),Ae.info("Favorite added",{dict:e.dictName,clip:e.clipName}),t({success:!0,favorites:r})}),RegisterNuiCallback("animations:favorites:remove",(e,t)=>{let r=La();r=r.filter(n=>!(n.dictName===e.dictName&&n.clipName===e.clipName)),ll(r),Ae.info("Favorite removed",{dict:e.dictName,clip:e.clipName}),t({success:!0,favorites:r})}),RegisterNuiCallback("animations:preview",async(e,t)=>{let{dictName:r,clipName:n}=e,{handle:o}=an();if(!o||!DoesEntityExist(o)){Ae.warn("Preview failed - no entity selected"),t({success:!1,error:"No entity selected"});return}if(GetEntityType(o)!==1){Ae.warn("Preview failed - selected entity is not a ped"),t({success:!1,error:"Not a ped"});return}RequestAnimDict(r);let a=Date.now();for(;!HasAnimDictLoaded(r);){if(Date.now()-a>3e3){Ae.warn("Preview failed - dict load timeout",{dictName:r}),t({success:!1,error:"Dict load timeout"});return}await new Promise(i=>setTimeout(i,10))}ClearPedTasks(o),TaskPlayAnim(o,r,n,8,-8,-1,1,0,!1,!1,!1),RemoveAnimDict(r),Ae.info("Animation preview started",{dictName:r,clipName:n,handle:o}),t({success:!0})}),onNet("ct:animations:searchResult",e=>{Ae.debug("Search result received",{requestId:e.requestId,count:e.results.length}),g("animations:searchResult",e)}),Ae.debug("Animation callbacks registered")}k();k();var Sr=m("BoneUtils");function Ga(e,t){try{let[r,n,o]=GetWorldPositionOfEntityBone(e,t);return{x:r,y:n,z:o}}catch(r){return Sr.error("GetWorldPositionOfEntityBone failed",{handle:e,boneIndex:t},r),{x:0,y:0,z:0}}}function _l(e,t){let r=[];try{if(t==="ped"){for(let n of Si){let o=GetPedBoneIndex(e,n.boneId);o!==-1&&r.push({boneIndex:o,name:n.name,label:n.label,category:n.category,position:Ga(e,o)})}Sr.debug("Resolved ped bones",{count:r.length})}else if(t==="vehicle"){for(let n of wi){let o=GetEntityBoneIndexByName(e,n.boneName);o!==-1&&r.push({boneIndex:o,name:n.boneName,label:n.label,category:n.category,position:Ga(e,o)})}Sr.debug("Resolved vehicle bones",{count:r.length})}else{let n=Ga(e,0);r.push({boneIndex:0,name:"root",label:"Root",category:"root",position:n}),Sr.debug("Resolved prop bones (root only)")}}catch(n){Sr.error("Failed to resolve entity bones",{handle:e,entityType:t},n)}return r}var In=m("NUI:Bone");function Ha(){RegisterNuiCallback("entity:getBones",(e,t)=>{let{uuid:r}=e;if(!r){In.warn("getBones called without uuid"),t({success:!1,error:"Missing uuid"});return}let n=E(r);if(!n){In.warn("getBones: entity not found",{uuid:r}),t({success:!1,error:"Entity not found"});return}if(!n.handle||!n.isSpawned){In.warn("getBones: entity not spawned",{uuid:r}),t({success:!1,error:"Entity not spawned"});return}let o=_l(n.handle,n.type);In.info("getBones result",{uuid:r,type:n.type,boneCount:o.length}),t({success:!0,bones:o})})}k();var dl=m("EnvCallbacks");function Ua(){RegisterNuiCallback("environment:update",(e,t)=>{dl.debug("NUI environment:update",{key:e.key,value:e.value}),emitNet("respoon:environment:update",e),t({success:!0})}),dl.debug("Environment NUI callbacks registered")}var Cu=m("NUI");function ul(){fa(),ca(),ba(),ka(),Ca(),xa(),Pa(),Aa(),Ia(),Ma(),Va(),Fa(),Oa(),Ba(),ga(),Ha(),vo(),Ua(),Cu.debug("All NUI callbacks registered")}k();var tr=m("CameraSync"),ml={updateInterval:16,debug:!1,debugLogInterval:120},wr=!1,er=null,Wa=0,Nn=0;function pl(e,t){SendNUIMessage({action:"camera:sync",payload:{position:e,rotation:t},timestamp:Date.now()})}function gl(){let e=GetFinalRenderedCamCoord(),t=GetFinalRenderedCamRot(2);return{position:{x:e[0],y:e[1],z:e[2]},rotation:{x:t[0],y:t[1],z:t[2]}}}function xu(){if(!wr)return;let e=Date.now();if(e-Wa<ml.updateInterval)return;Wa=e,Nn++;let{position:t,rotation:r}=gl();pl(t,r)}function za(){if(wr){tr.debug("Already active, skipping start");return}wr=!0,Wa=0,Nn=0,tr.debug("Starting camera sync..."),er=setTick(xu),tr.debug("Camera sync started",{tickId:er,intervalMs:ml.updateInterval})}function qa(){if(!wr){tr.debug("Already stopped, skipping stop");return}wr=!1,er!==null&&(clearTick(er),tr.debug("Camera sync stopped",{tickId:er,totalUpdates:Nn}),er=null),Nn=0}function ja(){let{position:e,rotation:t}=gl();tr.debug("Forced camera update",{position:`(${e.x.toFixed(2)}, ${e.y.toFixed(2)}, ${e.z.toFixed(2)})`,rotation:`(${t.x.toFixed(2)}, ${t.y.toFixed(2)}, ${t.z.toFixed(2)})`}),pl(e,t)}var ae=m("Client"),yl=!1,$a=!1;function Ka(e){yl=e,SetNuiFocus(e,e),SetNuiFocusKeepInput(e),g("state:sync",{isNuiFocused:e}),ae.debug("NUI focus changed",{focused:e})}function Tu(){if(kt())return;Or(!0),g("state:sync",{isOpen:!0}),Ka(!0);let e=st(),t=lr();if(e){g("room:joined",{room:e,playerIdentifier:t});let r=oo();g("entities:sync",{entities:r});let n=Ui();g("particles:sync",{particles:n})}Is(),ps(),ts(),za(),emitNet("respoon:editorOpened"),ae.debug("Editor opened")}function Rn(){kt()&&(Or(!1),mt()&&(Pe(),g("preview:cancelled",{})),qa(),gs(),xo(),Ns(),At(),Ka(!1),g("state:sync",{isOpen:!1}),emitNet("respoon:editorClosed"),ae.debug("Editor closed"))}function Su(){if(!kt()){ae.warn("Cannot start recording - editor not open");return}ae.info("Starting recording flow - closing editor"),Rn(),setTimeout(()=>{ae.info("Starting recording");let{startRecording:e}=(Ra(),xl(sl));e()},1e3)}function wu(){if(kt())Rn();else{if($a)return;$a=!0,emitNet("respoon:checkPermission")}}onNet("respoon:permissionResult",e=>{$a=!1,e.allowed?Tu():(SetNotificationTextEntry("STRING"),AddTextComponentString(`~r~Permission Denied~s~
You don't have permission to use Respoon`),DrawNotification(!1,!0),ae.warn("Permission denied - cannot open editor"))});on("respoon:client:startRecordingFlow",()=>{Su()});RegisterKeyMapping("+respoon_toggle","Toggle Respoon Editor","keyboard","F7");RegisterCommand("testcoords",()=>{ae.debug("Running coordinate conversion tests"),g("debug:runCoordinateTests",{})},!1);RegisterCommand("testcamera",()=>{ae.debug("Testing camera sync"),ja()},!1);RegisterCommand("+respoon_toggle",()=>{wu()},!1);RegisterCommand("-respoon_toggle",()=>{},!1);RegisterNuiCallback("editor:close",(e,t)=>{Rn(),t({success:!0})});RegisterNuiCallback("ui:setFocus",(e,t)=>{kt()&&Ka(e.focused),t({success:!0})});ae.info("Client loaded",{version:di});Zs();Ys();ae.debug("Network listeners registered");ul();ae.debug("NUI callbacks registered");Ki();ae.debug("Network module initialized");on("onResourceStart",e=>{e===GetCurrentResourceName()&&(ae.debug("Resource started"),Or(!1),yl=!1,g("resource:restarted",{}))});on("onResourceStop",e=>{e===GetCurrentResourceName()&&(mt()&&Pe(),kt()&&Rn(),wt(),so(),kr(),Jt(),ae.debug("Resource stopping"))});})();
